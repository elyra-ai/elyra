"use strict";(self.webpackChunk_jupyterlab_git=self.webpackChunk_jupyterlab_git||[]).push([[656],{5350:(e,t,s)=>{s.r(t),s.d(t,{DiffModel:()=>Qt,Git:()=>ke,IGitExtension:()=>Ee,NotebookDiff:()=>ri,PlainTextDiff:()=>Xt,default:()=>Hn});var i=s(5930),a=s(9560),n=s(3963),r=s(2424),o=s(6313),l=s(5577),c=s(1767),d=s(1542),h=s(3506),p=s(4918),m=s(3345),u=s.n(m),g=s(1689),_=s(484),f=s(4053),b=s(7262),y=s(5256);class v extends Error{constructor(...e){super(...e),this.name="CancelledError"}}var w=s(7977),C=s(247),x=s(1755),E=s(2092),k=s(8021),S=s(2822);const R=new _.LabIcon({name:"git",svgstr:'<svg\n  xmlns="http://www.w3.org/2000/svg"\n  viewBox="0 0 20 20"\n  width="16"\n>\n  <path\n    class="jp-icon3 jp-icon-selectable"\n    d="M19.6 9.1 10.9 0.4c-0.5-0.5-1.3-0.5-1.8 0l-1.8 1.8 2.3 2.3c0.5-0.2 1.1-0.1 1.6 0.4 0.4 0.4 0.5 1 0.4 1.6l2.2 2.2c0.5-0.2 1.2-0.1 1.6 0.4 0.6 0.6 0.6 1.6 0 2.2-0.6 0.6-1.6 0.6-2.2 0C12.7 10.7 12.6 10.1 12.8 9.5l-2.1-2.1v5.4c0.1 0.1 0.3 0.2 0.4 0.3 0.6 0.6 0.6 1.6 0 2.2-0.6 0.6-1.6 0.6-2.2 0-0.6-0.6-0.6-1.6 0-2.2 0.1-0.1 0.3-0.3 0.5-0.3V7.4C9.3 7.3 9.1 7.2 9 7 8.5 6.6 8.4 5.9 8.6 5.3L6.4 3.1 0.4 9.1c-0.5 0.5-0.5 1.3 0 1.8l8.7 8.7c0.5 0.5 1.3 0.5 1.8 0l8.7-8.7c0.5-0.5 0.5-1.3 0-1.8"\n    fill="#616161"\n  />\n</svg>\n'}),F=new _.LabIcon({name:"git:add",svgstr:'<svg\n   xmlns="http://www.w3.org/2000/svg"\n   width="16"\n   viewBox="0 0 24 24"\n   version="1.1">\n  <g\n     class="jp-icon3 jp-icon-selectable"\n     fill="#4F4F4F">\n    <path\n       d="m 22,13 h -9 v 9 H 11 V 13 H 2 v -2 h 9 V 2 h 2 v 9 h 9 z"/>\n  </g>\n</svg>\n'}),N=new _.LabIcon({name:"git:branch",svgstr:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 18 18">\n<path class="jp-icon3 jp-icon-selectable" d="M12.499,3.177 C11.205,3.177 10.166,4.216 10.166,5.51 C10.166,6.366 10.64,7.114 11.333,7.515 L11.333,7.843 C11.333,9.009 10.166,10.176 9,10.176 C8.034,10.176 7.269,10.376 6.667,10.704 L6.667,5.182 C7.36,4.781 7.834,4.034 7.834,3.177 C7.834,1.883 6.795,0.844 5.501,0.844 C4.207,0.844 3.168,1.883 3.168,3.177 C3.168,4.034 3.642,4.781 4.334,5.182 L4.334,12.818 C3.642,13.219 3.168,13.966 3.168,14.823 C3.168,16.117 4.207,17.156 5.501,17.156 C6.795,17.156 7.834,16.117 7.834,14.823 C7.834,14.203 7.597,13.656 7.214,13.237 C7.56,12.818 8.107,12.49 9,12.49 C11.333,12.49 13.666,10.157 13.666,7.824 L13.666,7.496 C14.358,7.095 14.832,6.348 14.832,5.492 C14.832,4.198 13.793,3.159 12.499,3.159 z M5.501,2.011 C6.139,2.011 6.667,2.539 6.667,3.177 C6.667,3.815 6.139,4.344 5.501,4.344 C4.863,4.344 4.334,3.815 4.334,3.177 C4.334,2.539 4.863,2.011 5.501,2.011 z M5.501,16.008 C4.863,16.008 4.334,15.479 4.334,14.841 C4.334,14.203 4.863,13.675 5.501,13.675 C6.139,13.675 6.667,14.203 6.667,14.841 C6.667,15.479 6.139,16.008 5.501,16.008 z M12.499,6.676 C11.861,6.676 11.333,6.148 11.333,5.51 C11.333,4.872 11.861,4.344 12.499,4.344 C13.137,4.344 13.666,4.872 13.666,5.51 C13.666,6.148 13.137,6.676 12.499,6.676 z" fill="#4F4F4F"/>\n</svg>\n'}),D=new _.LabIcon({name:"git:clone",svgstr:'<svg width="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g class="jp-icon3" fill="#616161">\n<path d="M18.3438 13.2365L10.7648 5.65849C10.3311 5.22492 9.61471 5.22492 9.18108 5.65849L7.61625 7.22311L9.61471 9.2213C10.086 9.07049 10.6139 9.16474 10.9721 9.54176C11.3492 9.91878 11.4435 10.4466 11.2927 10.9179L13.2157 12.8407C13.687 12.6898 14.2149 12.7841 14.592 13.1611C15.1199 13.6701 15.1199 14.5184 14.592 15.0462C14.0641 15.574 13.2345 15.574 12.7067 15.0462C12.3107 14.6503 12.2165 14.0848 12.4239 13.5947L10.6328 11.8039V16.5166C10.7648 16.5731 10.8779 16.6674 10.991 16.7616C11.5189 17.2894 11.5189 18.1189 10.991 18.6467C10.4631 19.1557 9.63356 19.1557 9.10567 18.6467C8.57777 18.1189 8.57777 17.2894 9.10567 16.7616C9.23764 16.6297 9.38847 16.5354 9.53929 16.4789V11.7096C9.38847 11.6531 9.23764 11.5399 9.10567 11.4268C8.70975 11.031 8.61548 10.4654 8.82287 9.97533L6.84326 8.01484L1.65859 13.1988C1.22497 13.6324 1.22497 14.3487 1.65859 14.7823L9.21879 22.3415C9.65241 22.775 10.3688 22.775 10.8025 22.3415L18.325 14.82C18.7774 14.3676 18.7774 13.6701 18.3438 13.2365Z"/>\n<rect x="14.6666" y="5.33331" width="6.66667" height="1.33333"/>\n<rect x="18.6666" y="2.66669" width="6.66667" height="1.33333" transform="rotate(90 18.6666 2.66669)"/>\n</g>\n</svg>\n'}),j=new _.LabIcon({name:"git:compare-with-selected",svgstr:'<svg width="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path d="M9.5 1H3.5C2.675 1 2.0075 1.63 2.0075 2.4L2 13.6C2 14.37 2.6675 15 3.4925 15H12.5C13.325 15 14 14.37 14 13.6V5.2L9.5 1ZM3.5 13.6V2.4H8.75L12.5 5.9V13.6H3.5Z" />\n    <path d="M5,8 L5,9 L7,9 L7,11 L11,8 L7,5 L7,7 L5,7 z" transform="rotate(180 7.75 8)" />\n  </g>\n</svg>'}),P=new _.LabIcon({name:"git:deletions",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <path class="jp-icon3" fill="white" d="M7 11v2h10v-2H7zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>\n</svg>\n'}),B=new _.LabIcon({name:"git:desktop",svgstr:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n  <path class="jp-icon3" d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 12H3V4h18v10z" fill="#4F4F4F">\n  </path>\n</svg>'}),I=new _.LabIcon({name:"git:diff",svgstr:'<svg width="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path d="M9.5 1H3.5C2.675 1 2.0075 1.63 2.0075 2.4L2 13.6C2 14.37 2.6675 15 3.4925 15H12.5C13.325 15 14 14.37 14 13.6V5.2L9.5 1ZM3.5 13.6V2.4H8.75L12.5 5.9V13.6H3.5Z"/>\n    <rect x="7" y="10.5" width="4" height="0.999998"/>\n    <rect x="5" y="5.49988" width="4" height="0.999998"/>\n    <rect x="7.5" y="4" width="4" height="1" transform="rotate(90 7.5 4)"/>\n  </g>\n</svg>\n'}),A=new _.LabIcon({name:"git:discard",svgstr:'<svg\n   xmlns="http://www.w3.org/2000/svg"\n   width="16"\n   viewBox="0 0 24 24"\n   version="1.1">\n  <g class="jp-icon3 jp-icon-selectable" stroke="#4F4F4F" stroke-width="2px">\n    <path\n       fill="none"\n       d="m 8.9223529,22.334118 c 0,0 8.2027491,-6.710405 10.3905881,-10.164706 C 21.50078,8.7151116 20.317794,5.8252391 17.957647,3.5011764 15.597501,1.1771138 12.452863,1.6307769 9.8541176,2.1458824 7.2553727,2.6609879 3.1905882,5.8164706 3.1905882,5.8164706" \n      />\n    <path\n       fill="none"\n       d="M 5.3082353,0.90352943 3.1905882,5.8164706 8.0752941,6.6070589"\n      />\n  </g>\n</svg>\n'}),T=new _.LabIcon({name:"git:insertions",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <path class="jp-icon3" fill="white" d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>\n</svg>\n'}),L=new _.LabIcon({name:"git:history",svgstr:'<svg\n  aria-hidden="true"\n  role="img"\n  xmlns="http://www.w3.org/2000/svg"\n  width="16"\n  viewBox="0 0 512 512"\n>\n  <path\n    class="jp-icon3"\n    fill="currentColor"\n    d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"\n  ></path>\n</svg>\n'}),M=new _.LabIcon({name:"git:merge",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16">\n  <path class="jp-icon3" fill="#4F4F4F"\n    d="M5.59 1.5c-2.041.023-3.607 2.277-2.958 4.202.346 1.087 1.299 1.946 2.404 2.211-.062 2.722-.036 5.448-.02 8.171-2.08.393-3.226 3.07-2.055 4.836.898 1.555 3.134 2.098 4.604 1.033 1.56-1.024 1.945-3.427.656-4.82-.47-.58-.783-.861-1.722-1.102-.004-1.233-.008-3.364-.007-4.596 1.281 1.648 3.342 2.65 5.436 2.555 1.052.03 2.105.015 3.157.011.414 1.848 2.597 3.043 4.361 2.285 1.804-.682 2.655-3.088 1.594-4.725-.99-1.698-3.596-2.12-5-.692-.538.426-.664 1.019-.86 1.63-1.68-.055-4.554.254-6.053-.702-1.39-.825-2.392-2.3-2.576-3.913 1.963-.439 3.092-2.914 2.074-4.669C8.053 2.124 6.81 1.458 5.59 1.5zm.026 1.515c1.26-.18 2.305 1.278 1.736 2.413-.446 1.301-2.442 1.454-3.081.237-.73-1.057.058-2.619 1.345-2.65zm12.501 8.502c1.26-.182 2.301 1.276 1.735 2.41-.445 1.301-2.442 1.455-3.082.238-.727-1.056.062-2.617 1.347-2.648zm-12.5 6c1.26-.183 2.304 1.275 1.735 2.41-.446 1.3-2.44 1.454-3.081.238-.73-1.055.06-2.617 1.345-2.648z" />\n</svg>'}),H=new _.LabIcon({name:"git:open-file",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 15 15">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path\n       d="m 6.5,1 h 6 c 0.825,0 1.4925,0.63 1.4925,1.4 L 14,13.6 C 14,14.37 13.3325,15 12.5075,15 H 3.5 C 2.675,15 2,14.37 2,13.6 V 5.2 Z m 6,12.6 V 2.4 H 7.25 L 3.5,5.9 v 7.7 z"/>\n    <path\n       d="M 7.5195314,11.679686 V 9.3359374 l -2.8320313,-1e-7 V 8.457031 7.5781248 h 2.8320313 v -2.34375 l 4.0527336,3.2226563 z"\n       style="stroke-width:2.66873717" />\n  </g>\n</svg>\n'}),$=new _.LabIcon({name:"git:pull",svgstr:'<svg width="16" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n  <path class="jp-icon3" \n    d="M14.5125 7.53C14.0025 4.9425 11.73 3 9 3C6.8325 3 4.95 4.23 4.0125 6.03C1.755 6.27 0 8.1825 0 10.5C0 12.9825 2.0175 15 4.5 15H14.25C16.32 15 18 13.32 18 11.25C18 9.27 16.4625 7.665 14.5125 7.53ZM14.25 13.5H4.5C2.8425 13.5 1.5 12.1575 1.5 10.5C1.5 8.9625 2.6475 7.68 4.17 7.5225L4.9725 7.44L5.3475 6.7275C6.06 5.355 7.455 4.5 9 4.5C10.965 4.5 12.66 5.895 13.0425 7.8225L13.2675 8.9475L14.415 9.03C15.585 9.105 16.5 10.0875 16.5 11.25C16.5 12.4875 15.4875 13.5 14.25 13.5ZM10.0875 7.5H7.9125V9.75H6L9 12.75L12 9.75H10.0875V7.5Z" \n    fill="#4F4F4F"/>\n</svg>\n'}),O=new _.LabIcon({name:"git:push",svgstr:'<svg width="16" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n<path class="jp-icon3" d="M14.5125 7.53C14.0025 4.9425 11.73 3 9 3C6.8325 3 4.95 4.23 4.0125 6.03C1.755 6.27 0 8.1825 0 10.5C0 12.9825 2.0175 15 4.5 15H14.25C16.32 15 18 13.32 18 11.25C18 9.27 16.4625 7.665 14.5125 7.53ZM14.25 13.5H4.5C2.8425 13.5 1.5 12.1575 1.5 10.5C1.5 8.9625 2.6475 7.68 4.17 7.5225L4.9725 7.44L5.3475 6.7275C6.06 5.355 7.455 4.5 9 4.5C10.965 4.5 12.66 5.895 13.0425 7.8225L13.2675 8.9475L14.415 9.03C15.585 9.105 16.5 10.0875 16.5 11.25C16.5 12.4875 15.4875 13.5 14.25 13.5ZM6 9.75H7.9125V12H10.0875V9.75H12L9 6.75L6 9.75Z" fill="#4F4F4F"/>\n</svg>\n'}),z=new _.LabIcon({name:"git:remove",svgstr:'<svg\n   xmlns="http://www.w3.org/2000/svg"\n   width="16"\n   viewBox="0 0 24 24"\n   version="1.1">\n  <g class="jp-icon3 jp-icon-selectable" stroke="#4F4F4F" stroke-width="2px">\n  <path\n     fill="none"\n     d="M 2,12 H 22" />\n   </g>\n</svg>\n'}),U=new _.LabIcon({name:"git:rewind",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path class="jp-icon3" fill="#4F4F4F" d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>\n</svg>\n'}),W=new _.LabIcon({name:"git:select-for-compare",svgstr:'<svg width="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3 jp-icon-selectable" fill="#4F4F4F">\n    <path d="M9.5 1H3.5C2.675 1 2.0075 1.63 2.0075 2.4L2 13.6C2 14.37 2.6675 15 3.4925 15H12.5C13.325 15 14 14.37 14 13.6V5.2L9.5 1ZM3.5 13.6V2.4H8.75L12.5 5.9V13.6H3.5Z" />\n    <path d="M5,8 L5,9 L7,9 L7,11 L11,8 L7,5 L7,7 L5,7 z" />\n  </g>\n</svg>'}),G=new _.LabIcon({name:"git:tag",svgstr:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 512.001 512.001" width="16">\n\t<path class="jp-icon3" fill="#4F4F4F" d="M506.513,311.066L253.87,58.423c-2.024-2.026-4.486-3.559-7.195-4.483L140.15,17.593\n\t\t\tc-6.758-2.305-14.242-0.568-19.294,4.483L84.709,58.222L31.977,5.491c-7.314-7.315-19.176-7.315-26.49,0\n\t\t\tc-7.315,7.315-7.315,19.175,0,26.49l52.732,52.731l-36.14,36.141c-5.051,5.05-6.79,12.534-4.483,19.294L53.943,246.67\n\t\t\tc0.924,2.71,2.458,5.172,4.483,7.197L311.071,506.51c7.314,7.315,19.175,7.315,26.49,0l168.954-168.954\n\t\t\tC513.83,330.241,513.83,318.382,506.513,311.066z M227.241,227.238c-21.817,21.819-57.132,21.82-78.952,0\n\t\t\tc-21.768-21.768-21.768-57.185,0.001-78.953c21.817-21.819,57.132-21.82,78.953,0C249.009,170.053,249.009,205.47,227.241,227.238\n\t\t\tz"/>\n</svg>\n'}),V=new _.LabIcon({name:"git:trash",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24">\n    <path class="jp-icon3" fill="#4F4F4F" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>\n    <path d="M0 0h24v24H0z" fill="none"/>\n</svg>\n'}),q=new _.LabIcon({name:"git:vertical-more",svgstr:'<svg width="16" height="16" version="1.1" viewBox="0 0 6.35 6.35" xmlns="http://www.w3.org/2000/svg">\n  <path class="jp-icon3" transform="scale(.26458)"\n    d="m11.939 1.7676a2.1655 2.1655 0 0 0-2.1055 2.1641 2.1655 2.1655 0 0 0 2.166 2.166 2.1655 2.1655 0 0 0 2.166-2.166 2.1655 2.1655 0 0 0-2.166-2.1641 2.1655 2.1655 0 0 0-0.060547 0zm0.060547 7.6172a2.1655 2.1655 0 0 0-2.166 2.166 2.1655 2.1655 0 0 0 2.166 2.166 2.1655 2.1655 0 0 0 2.166-2.166 2.1655 2.1655 0 0 0-2.166-2.166zm0 7.6191a2.1655 2.1655 0 0 0-2.166 2.166 2.1655 2.1655 0 0 0 2.166 2.166 2.1655 2.1655 0 0 0 2.166-2.166 2.1655 2.1655 0 0 0-2.166-2.166z"\n    fill="#4F4F4F" />\n</svg>'}),K=(0,S.style)({width:"400px",color:"var(--jp-ui-font-color1)!important",borderRadius:"3px!important",backgroundColor:"var(--jp-layout-color1)!important"}),X=(0,S.style)({position:"absolute",top:"10px",right:"12px",height:"30px",width:"30px",padding:0,border:"none",borderRadius:"50%",backgroundColor:"var(--jp-layout-color1)",$nest:{svg:{fill:"var(--jp-ui-font-color1)"},"&:hover":{backgroundColor:"var(--jp-border-color2)"},"&:active":{backgroundColor:"var(--jp-border-color2)"}}}),Y=(0,S.style)({boxSizing:"border-box",position:"relative",padding:"15px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)",$nest:{"& > p":{margin:0}}}),Z=(0,S.style)({fontWeight:700}),J=(0,S.style)({padding:"15px",$nest:{"> p":{marginBottom:"7px"}}}),Q=(0,S.style)({boxSizing:"border-box",width:"100%",height:"2em",marginBottom:"16px",padding:"1px 18px 2px 7px",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),ee=(0,S.style)({padding:0,paddingBottom:"4px"}),te=(0,S.style)({boxSizing:"border-box",display:"inline-block",position:"relative",width:"100%",marginRight:"11px",fontSize:"var(--jp-ui-font-size1)"}),se=(0,S.style)({boxSizing:"border-box",width:"100%",height:"2em",padding:"1px 18px 2px 7px",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),ie=(0,S.style)({position:"absolute",right:"5px",top:"0.6em",height:"1.1em",width:"1.1em",padding:0,backgroundColor:"var(--jp-inverse-layout-color4)",border:"none",borderRadius:"50%",$nest:{svg:{width:"0.5em!important",height:"0.5em!important",fill:"var(--jp-ui-inverse-font-color0)"},"&:hover":{backgroundColor:"var(--jp-inverse-layout-color3)"},"&:active":{backgroundColor:"var(--jp-inverse-layout-color2)"}}}),ae=(0,S.style)({boxSizing:"border-box",display:"block",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",paddingTop:0,paddingBottom:0}),ne=(0,S.style)({flexDirection:"row",flexWrap:"wrap",width:"100%",padding:"4px 11px 4px 11px!important",fontSize:"var(--jp-ui-font-size1)",lineHeight:"1.5em"}),re=(0,S.style)({color:"white!important",backgroundColor:"var(--jp-brand-color1)!important",$nest:{"& .jp-icon-selectable[fill]":{fill:"white"}}}),oe=(0,S.style)({flexBasis:0,flexGrow:1,marginTop:"auto",marginBottom:"auto",marginRight:"auto",$nest:{"& > p":{margin:0}}}),le=(0,S.style)({marginBottom:"auto",whiteSpace:"break-spaces"}),ce=(0,S.style)({width:"16px",height:"16px",margin:"auto 8px auto 0"}),de=(0,S.style)({}),he=(0,S.style)({fontWeight:700}),pe=(0,S.style)({color:"#ff0000"}),me=(0,S.style)({padding:"15px!important",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),ue=(0,S.style)({boxSizing:"border-box",width:"9em",height:"2em",color:"white",fontSize:"var(--jp-ui-font-size1)",border:"0",borderRadius:"3px"}),ge=(0,S.style)({backgroundColor:"var(--md-grey-500)",$nest:{"&:hover":{backgroundColor:"var(--md-grey-600)"},"&:active":{backgroundColor:"var(--md-grey-700)"}}}),_e=(0,S.style)({backgroundColor:"var(--md-blue-500)",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"},"&:disabled":{cursor:"default",color:"var(--jp-ui-inverse-font-color0)",backgroundColor:"var(--jp-layout-color3)"},"&:disabled:hover":{backgroundColor:"var(--jp-layout-color3)"},"&:disabled:active":{backgroundColor:"var(--jp-layout-color3)"}}});function fe(e){const[t,s]=u().useState(""),[i,a]=u().useState(null),n=e.branches.filter((e=>!t||e.name.includes(t))),{action:r,trans:o}=e,l=null!=r?r:"merge";return u().createElement(w.A,{classes:{paper:K},open:!0,onClose:()=>{e.onClose()}},u().createElement("div",{className:Y},u().createElement("p",{className:Z},"merge"===l?o.__("Merge Branch"):o.__("Rebase Branch")),u().createElement("button",{className:X},u().createElement(E.A,{titleAccess:o.__("Close this dialog"),fontSize:"small",onClick:()=>{e.onClose()}}))),u().createElement("div",{className:J},u().createElement("p",null,"merge"===l?o.__("Select the branch to merge in %1",e.currentBranch):o.__("Select the branch to rebase %1 onto",e.currentBranch)),u().createElement("div",{className:ee},u().createElement("div",{className:te},u().createElement("input",{className:se,type:"text",onChange:e=>{s(e.target.value)},value:t,placeholder:o.__("Filter"),title:o.__("Filter branch list")}),t?u().createElement("button",{className:ie},u().createElement(E.A,{titleAccess:o.__("Clear the current filter"),fontSize:"small",onClick:()=>{s("")}})):null)),u().createElement(k.FixedSizeList,{className:ae,height:200,itemSize:27.5,itemCount:n.length,itemData:n,itemKey:(e,t)=>t[e].name,style:{overflowX:"hidden"},width:"auto"},(function(e){const{data:t,index:s,style:n}=e,r=t[s],c=r.name===i;return u().createElement(x.Ay,{button:!0,title:"merge"===l?o.__("Merge branch %1",r.name):o.__("Rebase branch %1",r.name),className:(0,S.classes)(ne,c?re:null),onClick:()=>{a(r.name)},style:n},u().createElement(N.react,{className:ce,tag:"span"}),u().createElement("div",{className:oe},u().createElement("p",{className:de},r.name)))}))),u().createElement(C.A,{className:me},u().createElement("input",{className:(0,S.classes)(ue,ge),type:"button",title:"merge"===l?o.__("Close this dialog without merging a branch"):o.__("Close this dialog without rebasing the branch"),value:o.__("Cancel"),onClick:()=>{e.onClose()}}),u().createElement("input",{className:(0,S.classes)(ue,_e),type:"button",title:"merge"===l?o.__("Merge branch"):o.__("Rebase branch"),value:"merge"===l?o.__("Merge"):o.__("Rebase"),onClick:()=>{e.onClose(null!=i?i:void 0)},disabled:null===i})))}var be=s(4602),ye=s(1112),ve=s.n(ye),we=s(4375),Ce=s(4583),xe=s(186);const Ee=new b.Token("jupyter.extensions.git_plugin");var ke,Se,Re;!function(e){let t,s;!function(e){let t;!function(e){e[e.WORKING=0]="WORKING",e[e.INDEX=1]="INDEX",e[e.BASE=2]="BASE"}(t=e.SpecialRef||(e.SpecialRef={}))}(t=e.Diff||(e.Diff={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.DETACHED=1]="DETACHED",e[e.MERGING=2]="MERGING",e[e.REBASING=3]="REBASING",e[e.CHERRY_PICKING=4]="CHERRY_PICKING"}(s=e.State||(e.State={}));class i extends xe.ServerConnection.ResponseError{constructor(e,t=`Invalid response: ${e.status} ${e.statusText}`,s="",i={}){super(e,t),this.traceback=s,this._json=null!=i?i:{}}get json(){return this._json}}e.GitResponseError=i;class a extends Error{constructor(){super("Not in a Git Repository")}}e.NotInRepository=a;class n extends Error{constructor(){super("File is hidden"),this.name="hiddenFile",this.message="File is hidden and cannot be accessed."}}e.HiddenFile=n}(ke||(ke={})),function(e){e.gitCommitAmendStaged="git:context-commitAmendStaged",e.gitFileAdd="git:context-add",e.gitFileDiff="git:context-diff",e.gitFileDiscard="git:context-discard",e.gitFileDelete="git:context-delete",e.gitFileOpen="git:context-open",e.gitFileUnstage="git:context-unstage",e.gitFileStage="git:context-stage",e.gitFileTrack="git:context-track",e.gitFileHistory="git:context-history",e.gitIgnore="git:context-ignore",e.gitIgnoreExtension="git:context-ignoreExtension",e.gitNoAction="git:no-action",e.openFileFromDiff="git:open-file-from-diff",e.gitFileStashPop="git:context-stash-pop",e.gitTagAdd="git:context-tag-add"}(Se||(Se={})),function(e){e.gitUI="git:ui",e.gitTerminalCommand="git:terminal-command",e.gitInit="git:init",e.gitOpenUrl="git:open-url",e.gitToggleSimpleStaging="git:toggle-simple-staging",e.gitToggleDoubleClickDiff="git:toggle-double-click-diff",e.gitManageRemote="git:manage-remote",e.gitClone="git:clone",e.gitMerge="git:merge",e.gitOpenGitignore="git:open-gitignore",e.gitPush="git:push",e.gitPull="git:pull",e.gitRebase="git:rebase",e.gitResolveRebase="git:resolve-rebase",e.gitResetToRemote="git:reset-to-remote",e.gitSubmitCommand="git:submit-commit",e.gitShowDiff="git:show-diff",e.gitStash="git:stash",e.gitStashPop="git:stash-pop",e.gitStashList="git:stash-list"}(Re||(Re={}));const Fe=["Invalid username or password","could not read Username","could not read Password","Authentication error"];async function Ne(e="",t="GET",s=null,i="git"){const a=xe.ServerConnection.makeSettings(),n=g.URLExt.join(a.baseUrl,i,e),r={method:t,body:s?JSON.stringify(s):void 0};let o;try{o=await xe.ServerConnection.makeRequest(n,r,a)}catch(e){throw new xe.ServerConnection.NetworkError(e)}let l=await o.text(),c=!1;if(l.length>0)try{l=JSON.parse(l),c=!0}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok){if(c){const{message:e,traceback:t,...s}=l;throw new ke.GitResponseError(o,e||`Invalid response: ${o.status} ${o.statusText}`,t||"",s)}throw new ke.GitResponseError(o,l)}return l}var De=s(3758);class je{constructor(e){this._isDisposed=!1,this._taskList=new De.LinkedList,this._taskChanged=new be.Signal(e)}get isDisposed(){return this._isDisposed}get taskChanged(){return this._taskChanged}add(e){const t=this._generateTaskID();return this._taskList.addLast({id:t,task:e}),1===this._taskList.length&&this._taskChanged.emit(e),t}dispose(){this.isDisposed||(this._isDisposed=!0,be.Signal.clearData(this))}async execute(e,t){const s=this.add(e);try{return await t()}finally{this.remove(s)}}remove(e){let t=this._taskList.firstNode;if((null==t?void 0:t.value.id)===e)this._taskList.removeNode(t);else for(;null==t?void 0:t.next;)if(t=null==t?void 0:t.next,t.value&&t.value.id===e){this._taskList.removeNode(t);break}0===this._taskList.length?this._taskChanged.emit("empty"):this._taskChanged.emit(this._taskList.first.task)}_generateTaskID(){return b.UUID.uuid4()}}function Pe(e){return t=>{null==t||t.stopPropagation(),e(t)}}function Be(e,t){var s;return(null!==(s={D:["D","U"],A:["U","A"],U:["D","A","U"]}[e])&&void 0!==s?s:[]).includes(t)?"unmerged":"?"===e&&"?"===t?"untracked":" "!==e?" "!==t?"partially-staged":"staged":" "!==t?"unstaged":null}const Ie=e=>(t,s)=>(i,a,n)=>async r=>{var o;if(null==r||r.stopPropagation(),a)try{e.execute(Se.gitFileDiff,{files:[{filePath:i,previousFilePath:n,isText:a,context:{previousRef:null!==(o=null==s?void 0:s.commit)&&void 0!==o?o:t.pre_commits[0],currentRef:t.commit}}]})}catch(e){console.error(`Failed to open diff view for ${i}.\n${e}`)}},Ae={};function Te(e){var t,s,i;return null===(i=Ae[null!==(s=null===(t=g.PathExt.extname(e))||void 0===t?void 0:t.toLocaleLowerCase())&&void 0!==s?s:""])||void 0===i?void 0:i.factory}class Le{constructor(e=null,t=null,s){this._fetchRemotes=async()=>{if(!this.credentialsRequired)try{await this.fetch()}catch(e){console.error("Failed to fetch remotes",e),Fe.some((t=>e.message.indexOf(t)>-1))&&(this.credentialsRequired=!0)}},this._refreshModel=async()=>{await this._taskHandler.execute("git:refresh",(async()=>{try{await this.refreshBranch(),await this.refreshTag(),await this.refreshStatus(),await this.refreshStash(),await this.checkRemoteChangeNotified()}catch(e){console.error("Failed to refresh git status",e)}}))},this._refreshStandby=()=>!(null!==this.pathRepository&&!this._standbyCondition())||"when-hidden",this._status={branch:null,remote:null,ahead:0,behind:0,state:ke.State.DEFAULT,files:[]},this._stash=[],this._pathRepository=null,this._branches=[],this._tagsList=[],this._currentBranch=null,this._isDisposed=!1,this._markerCache=new He((()=>this._markChanged.emit())),this.__currentMarker=new Me((()=>{})),this._readyPromise=Promise.resolve(),this._pendingReadyPromise=0,this._standbyCondition=()=>!1,this._remoteChangedFiles=[],this._changeUpstreamNotified=[],this._selectedHistoryFile=null,this._hasDirtyFiles=!1,this._credentialsRequired=!1,this._lastAuthor=null,this._submodules=[],this._statusForDirtyState=["staged","partially-staged"],this._branchesChanged=new be.Signal(this),this._tagsChanged=new be.Signal(this),this._headChanged=new be.Signal(this),this._markChanged=new be.Signal(this),this._selectedHistoryFileChanged=new be.Signal(this),this._repositoryChanged=new be.Signal(this),this._stashChanged=new be.Signal(this),this._statusChanged=new be.Signal(this),this._remoteChanged=new be.Signal(this),this._dirtyFilesStatusChanged=new be.Signal(this),this._credentialsRequiredChanged=new be.Signal(this),this._docmanager=e,this._docRegistry=t,this._settings=s||null,this._taskHandler=new je(this),this._clearStatus(),this._statusPoll=new Ce.Poll({factory:this._refreshModel,frequency:{interval:3e3,backoff:!0,max:3e5},standby:this._refreshStandby}),this._fetchPoll=new Ce.Poll({auto:!1,factory:this._fetchRemotes,frequency:{interval:3e3,backoff:!0,max:3e5},standby:this._refreshStandby}),s&&(s.changed.connect(this._onSettingsChange,this),this._onSettingsChange(s))}get branches(){return this._branches}get submodules(){return this._submodules}get tagsList(){return this._tagsList}get currentBranch(){return this._currentBranch}get isDisposed(){return this._isDisposed}get isReady(){return 0===this._pendingReadyPromise}get ready(){return this._readyPromise}get pathRepository(){return this._pathRepository}set pathRepository(e){const t={name:"pathRepository",newValue:null,oldValue:this._pathRepository};if(null===e)this._pendingReadyPromise+=1,this._readyPromise.then((()=>{this._pathRepository=null,this._pendingReadyPromise-=1,t.newValue!==t.oldValue&&this.refresh().then((()=>this._repositoryChanged.emit(t)))}));else{const s=this._readyPromise;this._pendingReadyPromise+=1;const i=e;this._readyPromise=Promise.all([s,this.showPrefix(i)]).then((([e,s])=>{null!==s&&(s=i.slice(0,Math.max(0,i.length-s.length))),t.newValue=this._pathRepository=s,t.newValue!==t.oldValue&&this.refresh().then((()=>this._repositoryChanged.emit(t))),this._pendingReadyPromise-=1})).catch((e=>{this._pendingReadyPromise-=1,console.error(`Fail to find Git top level for path ${i}.\n${e}`)}))}}get refreshStandbyCondition(){return this._standbyCondition}set refreshStandbyCondition(e){this._standbyCondition=e}get selectedHistoryFile(){return this._selectedHistoryFile}set selectedHistoryFile(e){this._selectedHistoryFile!==e&&(this._selectedHistoryFile=e,this._selectedHistoryFileChanged.emit(e))}get lastAuthor(){return this._lastAuthor}set lastAuthor(e){this._lastAuthor=e}get status(){return this._status}get branchesChanged(){return this._branchesChanged}get headChanged(){return this._headChanged}get tagsChanged(){return this._tagsChanged}get markChanged(){return this._markChanged}get selectedHistoryFileChanged(){return this._selectedHistoryFileChanged}get stashChanged(){return this._stashChanged}get stash(){return this._stash}get repositoryChanged(){return this._repositoryChanged}get statusChanged(){return this._statusChanged}get taskChanged(){return this._taskHandler.taskChanged}get remoteChanged(){return this._remoteChanged}get hasDirtyFiles(){return this._hasDirtyFiles}set hasDirtyFiles(e){this._hasDirtyFiles!==e&&(this._hasDirtyFiles=e,this._dirtyFilesStatusChanged.emit(e))}get dirtyFilesStatusChanged(){return this._dirtyFilesStatusChanged}get credentialsRequired(){return this._credentialsRequired}set credentialsRequired(e){this._credentialsRequired!==e&&(this._credentialsRequired=e,this._credentialsRequiredChanged.emit(e))}get credentialsRequiredChanged(){return this._credentialsRequiredChanged}get _currentMarker(){return null===this.pathRepository?new Me((()=>{})):(this.__currentMarker||this._setMarker(this.pathRepository,this._currentBranch?this._currentBranch.name:""),this.__currentMarker)}async add(...e){const t=await this._getPathRepository();await this._taskHandler.execute("git:add:files",(async()=>{await Ne(g.URLExt.join(t,"add"),"POST",{add_all:!e,filename:e||""})})),await this.refreshStatus()}getFile(e){var t;if(null===this.pathRepository)return null;const s=(null===(t=this._status)||void 0===t?void 0:t.files)?this._status.files.find((t=>this.getRelativeFilePath(t.to)===e)):null;if(s)return s;{const t=g.PathExt.relative("/"+this.pathRepository,"/"+e);return t.startsWith("../")?null:{x:"",y:"",to:t,from:"",is_binary:null,status:"unmodified",type:this._resolveFileType(e)}}}async addAllUnstaged(){const e=await this._getPathRepository();await this._taskHandler.execute("git:add:files:all_unstaged",(async()=>{await Ne(g.URLExt.join(e,"add_all_unstaged"),"POST")})),await this.refreshStatus()}async addAllUntracked(){const e=await this._getPathRepository();await this._taskHandler.execute("git:add:files:all_untracked",(async()=>{await Ne(g.URLExt.join(e,"add_all_untracked"),"POST")})),await this.refreshStatus()}async addRemote(e,t){const s=await this._getPathRepository();await this._taskHandler.execute("git:add:remote",(async()=>{await Ne(g.URLExt.join(s,"remote","add"),"POST",{url:e,name:t})}))}async getRemotes(){const e=await this._getPathRepository();return(await this._taskHandler.execute("git:show:remote",(async()=>await Ne(g.URLExt.join(e,"remote","show"),"GET")))).remotes}async removeRemote(e){const t=await this._getPathRepository();await this._taskHandler.execute("git:remove:remote",(async()=>{await Ne(g.URLExt.join(t,"remote",e),"DELETE")}))}async allHistory(e=25){const t=await this._getPathRepository();return await this._taskHandler.execute("git:fetch:history",(async()=>await Ne(g.URLExt.join(t,"all_history"),"POST",{history_count:e})))}async checkout(e){const t=await this._getPathRepository(),s={checkout_branch:!1,new_check:!1,branchname:"",startpoint:"",checkout_all:!0,filename:""};void 0!==e&&(e.branchname?(s.branchname=e.branchname,s.checkout_branch=!0,s.new_check=!0===e.newBranch,e.newBranch&&(s.startpoint=e.startpoint||this._currentBranch.name)):e.filename&&(s.filename=e.filename,s.checkout_all=!1));const i=await this._taskHandler.execute("git:checkout",(async()=>{var e;let i;s.new_check||(i=s.checkout_branch&&!s.new_check?await this._changedFiles(this._currentBranch.name,s.branchname):s.filename?{files:[s.filename]}:await this._changedFiles("WORKING","HEAD"));const a=await Ne(g.URLExt.join(t,"checkout"),"POST",s);return null===(e=null==i?void 0:i.files)||void 0===e||e.forEach((e=>this._revertFile(e))),a}));return s.checkout_branch?await this.refreshBranch():await this.refreshStatus(),i}async merge(e){const t=await this._getPathRepository();return this._taskHandler.execute("git:merge",(()=>Ne(g.URLExt.join(t,"merge"),"POST",{branch:e})))}async clone(e,t,s,i=!0,a=!1){return await this._taskHandler.execute("git:clone",(async()=>await Ne(g.URLExt.join(e,"clone"),"POST",{clone_url:t,versioning:i,submodules:a,auth:s})))}async commit(e=null,t=!1,s=null){const i=await this._getPathRepository();await this._taskHandler.execute("git:commit:create",(async()=>{await Ne(g.URLExt.join(i,"commit"),"POST",{commit_msg:e,amend:t,author:null!=s?s:null})})),await this.refresh()}async config(e){const t=await this._getPathRepository();return await this._taskHandler.execute("git:config:"+(e?"set":"get"),(async()=>{if(!e)return await Ne(g.URLExt.join(t,"config"),"POST");await Ne(g.URLExt.join(t,"config"),"POST",{options:e})}))}async deleteBranch(e){const t=await this._getPathRepository();await this._taskHandler.execute("git:branch:delete",(async()=>await Ne(g.URLExt.join(t,"branch","delete"),"POST",{branch:e})))}async detailedLog(e){var t;const s=await this._getPathRepository(),i=await this._taskHandler.execute("git:fetch:commit_log",(async()=>await Ne(g.URLExt.join(s,"detailed_log"),"POST",{selected_hash:e})));return i.modified_files=(null!==(t=i.modified_files)&&void 0!==t?t:[]).map((e=>(e.type=this._resolveFileType(e.modified_file_path),e))),i}async diff(e,t){var s;const i=await this._getPathRepository(),a=await this._taskHandler.execute("git:diff",(async()=>await Ne(g.URLExt.join(i,"diff"),"POST",{previous:e,current:t})));return a.result=(null!==(s=a.result)&&void 0!==s?s:[]).map((e=>(e.filetype=this._resolveFileType(e.filename),e))),a}dispose(){var e;this.isDisposed||(this._isDisposed=!0,this._fetchPoll.dispose(),this._statusPoll.dispose(),this._taskHandler.dispose(),null===(e=this._settings)||void 0===e||e.changed.disconnect(this._onSettingsChange,this),be.Signal.clearData(this))}async ensureGitignore(){var e,t;const s=await this._getPathRepository();await Ne(g.URLExt.join(s,"ignore"),"POST",{});try{await(null===(e=this._docmanager)||void 0===e?void 0:e.services.contents.get(`${s}/.gitignore`,{content:!1}))}catch(e){if(404===(null===(t=e.response)||void 0===t?void 0:t.status))throw new ke.HiddenFile}this._openGitignore(),await this.refreshStatus()}async readGitIgnore(){const e=await this._getPathRepository();return(await Ne(g.URLExt.join(e,"ignore"),"GET")).content}async writeGitIgnore(e){const t=await this._getPathRepository();await Ne(g.URLExt.join(t,"ignore"),"POST",{content:e}),await this.refreshStatus()}async fetch(e){const t=await this._getPathRepository();return this._taskHandler.execute("git:fetch:remote",(async()=>await Ne(g.URLExt.join(t,"remote","fetch"),"POST",{auth:e})))}getRelativeFilePath(e){return null===this.pathRepository?null:g.PathExt.join(this.pathRepository,null!=e?e:"")}async ignore(e,t){var s,i;const a=await this._getPathRepository();await Ne(g.URLExt.join(a,"ignore"),"POST",{file_path:e,use_extension:t});try{await(null===(s=this._docmanager)||void 0===s?void 0:s.services.contents.get(`${a}/.gitignore`,{content:!1}))}catch(e){if(404===(null===(i=e.response)||void 0===i?void 0:i.status))throw new ke.HiddenFile}this._openGitignore(),await this.refreshStatus()}async init(e){await this._taskHandler.execute("git:init",(async()=>{await Ne(g.URLExt.join(e,"init"),"POST")}))}async log(e=25){const t=await this._getPathRepository();return await this._taskHandler.execute("git:fetch:log",(async()=>{var s;try{return await Ne(g.URLExt.join(t,"log"),"POST",{history_count:e,follow_path:null===(s=this.selectedHistoryFile)||void 0===s?void 0:s.to})}catch(e){return{code:1}}}))}async pull(e){var t,s;const i=await this._getPathRepository(),a=null===(t=this._currentBranch)||void 0===t?void 0:t.top_commit,n=await this._taskHandler.execute("git:pull",(async()=>{var t;return await Ne(g.URLExt.join(i,"pull"),"POST",{auth:e,cancel_on_conflict:(null===(t=this._settings)||void 0===t?void 0:t.composite.cancelPullMergeConflict)||!1})})),r=await this._changedFiles(a,"HEAD");return null===(s=null==r?void 0:r.files)||void 0===s||s.forEach((e=>this._revertFile(e))),await this.refreshBranch(),n}async push(e,t=!1,s){const i=await this._getPathRepository(),a=this._taskHandler.execute("git:push",(async()=>await Ne(g.URLExt.join(i,"push"),"POST",{auth:e,force:t,remote:s})));return this.refreshBranch(),a}async rebase(e){const t=await this._getPathRepository();return this._taskHandler.execute("git:rebase",(()=>Ne(g.URLExt.join(t,"rebase"),"POST",{branch:e})))}async resolveRebase(e){const t=await this._getPathRepository();return this._taskHandler.execute("git:rebase:resolve",(()=>Ne(g.URLExt.join(t,"rebase"),"POST",{action:e})))}async refresh(){await this._statusPoll.refresh(),await this._statusPoll.tick}async refreshBranch(){var e,t,s,i,a;try{const n=await this._taskHandler.execute("git:refresh:branches",(async()=>await this._branch()));let r=!1;r=this._currentBranch&&n?this._currentBranch.name!==(null===(e=n.current_branch)||void 0===e?void 0:e.name)||this._currentBranch.top_commit!==(null===(t=n.current_branch)||void 0===t?void 0:t.top_commit):this._currentBranch!==n.current_branch;const o=!b.JSONExt.deepEqual(this._branches,null!==(s=n.branches)&&void 0!==s?s:[]);this._branches=null!==(i=n.branches)&&void 0!==i?i:[],this._currentBranch=null!==(a=n.current_branch)&&void 0!==a?a:null,this._currentBranch&&this._pathRepository&&this._setMarker(this.pathRepository,this._currentBranch.name),r&&this._headChanged.emit(),o&&this._branchesChanged.emit(),this._branches.some((e=>e.is_remote_branch))?this._fetchPoll.start():this._fetchPoll.stop()}catch(e){const t=this._branches.length>0,s=null!==this._currentBranch;if(this._branches=[],this._currentBranch=null,this._fetchPoll.stop(),s&&this._headChanged.emit(),t&&this._branchesChanged.emit(),!(e instanceof ke.NotInRepository))throw e}}async refreshTag(){var e;try{const t=null!==(e=(await this._taskHandler.execute("git:refresh:tags",(async()=>await this.tags()))).tags)&&void 0!==e?e:[],s=!b.JSONExt.deepEqual(this._tagsList,t);this._tagsList=t,s&&this._tagsChanged.emit(),this._fetchPoll.stop()}catch(e){const t=this._tagsList.length>0;if(this._tagsList=[],this._fetchPoll.stop(),t&&this._tagsChanged.emit(),!(e instanceof ke.NotInRepository))throw e}}async refreshStatus(){var e,t,s,i,a,n;let r;try{r=await this._getPathRepository()}catch(e){if(this._clearStatus(),!(e instanceof ke.NotInRepository))throw e;return}try{const o=await this._taskHandler.execute("git:refresh:status",(async()=>await Ne(g.URLExt.join(r,"status"),"POST"))),l=null===(e=o.files)||void 0===e?void 0:e.map((e=>({...e,status:Be(e.x,e.y),type:this._resolveFileType(e.to)})));this._setStatus({branch:null!==(t=o.branch)&&void 0!==t?t:null,remote:null!==(s=o.remote)&&void 0!==s?s:null,ahead:null!==(i=o.ahead)&&void 0!==i?i:0,behind:null!==(a=o.behind)&&void 0!==a?a:0,state:null!==(n=o.state)&&void 0!==n?n:0,files:null!=l?l:[]}),await this.refreshDirtyStatus()}catch(e){return this._clearStatus(),void console.error(e)}}async remoteChangedFiles(){var e;this._remoteChangedFiles.length=0;try{this.status.remote&&this.status.behind>0&&this._remoteChangedFiles.concat((null!==(e=(await this._changedFiles("WORKING",this.status.remote)).files)&&void 0!==e?e:[]).map((e=>({status:"remote-changed",type:this._resolveFileType(e),x:"?",y:"B",to:e,from:"?",is_binary:!1}))))}catch(e){console.error(e)}return this._remoteChangedFiles}async checkRemoteChangeNotified(){var e,t;if(this.status.remote&&this.status.behind>0){const s=[],i=[];for(const t of this._remoteChangedFiles){const a=this.getRelativeFilePath(t.to);if(!a)continue;const n=null===(e=this._docmanager)||void 0===e?void 0:e.findWidget(a),r=this._changeUpstreamNotified.findIndex((e=>e.from===t.from&&e.to===t.to&&e.x===t.x&&e.y===t.y));void 0!==n?n.isAttached&&(-1===r?(this._changeUpstreamNotified.push(t),s.push(t)):i.push(t)):r>-1&&this._changeUpstreamNotified.splice(r,1)}(null===(t=this._settings)||void 0===t?void 0:t.composite.openFilesBehindWarning)&&s.length>0&&this._remoteChanged.emit({notNotified:s,notified:i})}else this._changeUpstreamNotified=[]}async refreshDirtyStatus(){var e,t;const s=this.status.files.filter((e=>this._statusForDirtyState.includes(e.status))).map((e=>e.to));let i=!1;for(const a of s){const s=this.getRelativeFilePath(a);if(!s)continue;const n=null===(e=this._docmanager)||void 0===e?void 0:e.findWidget(s);if(void 0!==n){const e=null===(t=this._docmanager)||void 0===t?void 0:t.contextForWidget(n);if(null==e?void 0:e.model.dirty){i=!0;break}}}this.hasDirtyFiles=i}async reset(e){const t=await this._getPathRepository();await this._taskHandler.execute("git:reset:changes",(async()=>{var s;const i=void 0===e;let a;a=i?null!==(s=(await this._changedFiles("INDEX","HEAD")).files)&&void 0!==s?s:[]:[e],await Ne(g.URLExt.join(t,"reset"),"POST",{reset_all:i,filename:null!=e?e:null}),a.forEach((e=>{this._revertFile(e)}))})),await this.refreshStatus()}async resetToCommit(e=""){const t=await this._getPathRepository();await this._taskHandler.execute("git:reset:hard",(async()=>{const s=(await this._changedFiles(void 0,void 0,e)).files;await Ne(g.URLExt.join(t,"reset_to_commit"),"POST",{commit_id:e}),null==s||s.forEach((e=>{this._revertFile(e)}))})),await this.refreshBranch()}async showPrefix(e){var t;try{return null!==(t=(await this._taskHandler.execute("git:fetch:prefix_path",(async()=>await Ne(g.URLExt.join(e,"show_prefix"),"POST")))).path)&&void 0!==t?t:null}catch(e){if(e instanceof ke.GitResponseError&&500===e.response.status&&128===e.json.code)return null;throw e}}async showTopLevel(e){var t;try{return null!==(t=(await this._taskHandler.execute("git:fetch:top_level_path",(async()=>await Ne(g.URLExt.join(e,"show_top_level"),"POST")))).path)&&void 0!==t?t:null}catch(e){if(e instanceof ke.GitResponseError&&500===e.response.status&&128===e.json.code)return null;throw e}}async applyStash(e){const t=await this._getPathRepository();try{const s=e?this._stash[e].files:this._stash[0].files;await this._taskHandler.execute("git:stash:apply",(async()=>{await Ne(g.URLExt.join(t,"stash_apply"),"POST",void 0!==e?{index:e}:{index:0})})),await this.refresh(),s.forEach((e=>{this._revertFile(e)}))}catch(e){console.error("Failed to apply stash",e)}await this.refreshStash()}async dropStash(e){let t;try{t=await this._getPathRepository(),await this._taskHandler.execute("git:stash:drop",(async()=>{const s=(null!=e?e:-1)>=0?g.URLExt.join(t,`stash?stash_index=${e}`):g.URLExt.join(t,"stash");await Ne(s,"DELETE")})),await this.refreshStash(),await this._refreshModel()}catch(e){if(this._clearStatus(),!(e instanceof ke.NotInRepository))throw e;return}}async popStash(e){try{const t=await this._getPathRepository(),s=(null!=e?e:-1)>=0?this._stash[e].files:[];await this._taskHandler.execute("git:stash:pop",(async()=>{await Ne(g.URLExt.join(t,"stash_pop"),"POST",void 0!==e?{index:e}:void 0)})),await this.refresh(),s.forEach((e=>{this._revertFile(e)}))}catch(e){console.error("Failed to pop stash",e)}await this.refreshStash()}async refreshStash(){let e;try{e=await this._getPathRepository()}catch(e){if(this._clearStatus(),!(e instanceof ke.NotInRepository))throw e;return}try{const t=await this._taskHandler.execute("git:refresh:stash",(async()=>await Ne(g.URLExt.join(e,"stash"),"GET"))),s=await this._taskHandler.execute("git:refresh:stash",(()=>Promise.all(t.stashes.map((({index:t})=>Ne(g.URLExt.join(e,"stash")+`?index=${t}`,"GET")))))),i=t.stashes.map(((e,t)=>Object.assign(e,{files:s[t].files})));if(!this.isStashDeepEqual(i,this._stash)){const e={name:"stash",newValue:i,oldValue:this._stash};this._stash=i,this._stashChanged.emit(e)}}catch(e){return void console.error(e)}}async stashChanges(e){var t;try{const s=await this._getPathRepository();await this._taskHandler.execute("git:stash",(async()=>{await Ne(g.URLExt.join(s,"stash"),"POST",void 0!==e?{stashMsg:e}:void 0)})),await this.refreshStash(),(null===(t=this._stash)||void 0===t?void 0:t.length)>0?this._stash[0].files.forEach((e=>{this._revertFile(e)})):console.error("Failed to retrieve stashed files")}catch(e){console.error("Error stashing changes:",e)}}isStashDeepEqual(e,t){return(null==e?void 0:e.length)===(null==t?void 0:t.length)&&e.every(((e,s)=>{const i=t[s];return e.index===i.index&&e.branch===i.branch&&e.message===i.message&&JSON.stringify(e.files)===JSON.stringify(i.files)}))}async tags(){const e=await this._getPathRepository();return await this._taskHandler.execute("git:tag:list",(async()=>await Ne(g.URLExt.join(e,"tags"),"POST")))}async checkoutTag(e){const t=await this._getPathRepository();return await this._taskHandler.execute("git:tag:checkout",(async()=>await Ne(g.URLExt.join(t,"tag_checkout"),"POST",{tag_id:e})))}async setTag(e,t){const s=await this._getPathRepository();await this._taskHandler.execute("git:tag:create",(async()=>await Ne(g.URLExt.join(s,"tag"),"POST",{tag_id:e,commit_id:t}))),await this.refreshTag()}addMark(e,t){var s;null===(s=this._currentMarker)||void 0===s||s.add(e,t)}setMark(e,t){var s;null===(s=this._currentMarker)||void 0===s||s.set(e,t)}getMark(e){var t,s;return null!==(s=null===(t=this._currentMarker)||void 0===t?void 0:t.get(e))&&void 0!==s&&s}toggleMark(e){var t;null===(t=this._currentMarker)||void 0===t||t.toggle(e)}get markedFiles(){return this._currentMarker.markedFilePaths.filter((e=>this.status.files.some((t=>t.to===e)))).map((e=>this.status.files.find((t=>t.to===e))))}registerDiffProvider(e,t,s){t.forEach((t=>{Ae[t]={name:e,factory:s}}))}async revertCommit(e,t){const s=await this._getPathRepository();await this._taskHandler.execute("git:commit:revert",(async()=>{const e=(await this._changedFiles(void 0,void 0,t+"^!")).files;await Ne(g.URLExt.join(s,"delete_commit"),"POST",{commit_id:t}),null==e||e.forEach((e=>{this._revertFile(e)}))})),await this.commit(e)}async listSubmodules(){try{const e=await this._getPathRepository(),t=(await this._taskHandler.execute("git:submodules:list",(async()=>await Ne(g.URLExt.join(e,"submodules"),"GET")))).submodules;this._submodules=t}catch(e){console.error("Failed to retrieve submodules")}}async _branch(){const e=await this._getPathRepository();return await this._taskHandler.execute("git:fetch:branches",(async()=>await Ne(g.URLExt.join(e,"branch"),"POST")))}async _changedFiles(e,t,s){return await Ne(g.URLExt.join(this.pathRepository,"changed_files"),"POST",{base:e,remote:t,single_commit:s})}_clearStatus(){this._status={branch:null,remote:null,ahead:0,behind:0,state:ke.State.DEFAULT,files:[]}}async _getPathRepository(){await this.ready;const e=this.pathRepository;if(null===e)throw new ke.NotInRepository;return e}_resolveFileType(e){var t,s;return e.endsWith("/")?we.DocumentRegistry.getDefaultDirectoryFileType():null!==(s=null===(t=this._docRegistry)||void 0===t?void 0:t.getFileTypesForPath(e)[0])&&void 0!==s?s:we.DocumentRegistry.getDefaultTextFileType()}_setStatus(e){let t=this._status.ahead===e.ahead&&this._status.behind===e.behind&&this._status.branch===e.branch&&this._status.state===e.state&&this._status.files.length===e.files.length;if(t)for(const s of e.files)if(this._status.files.findIndex((e=>e.from===s.from&&e.to===s.to&&e.x===s.x&&e.y===s.y))){t=!1;break}t||(this._status=e,this._statusChanged.emit(this._status))}_onSettingsChange(e){this._fetchPoll.frequency={...this._fetchPoll.frequency,interval:e.composite.refreshInterval},this._statusPoll.frequency={...this._statusPoll.frequency,interval:e.composite.refreshInterval},this._statusForDirtyState=e.composite.simpleStaging?["staged","partially-staged","unstaged"]:["staged","partially-staged"],this.refreshDirtyStatus()}_openGitignore(){const e=this.getRelativeFilePath(".gitignore");if(this._docmanager&&e){const t=this._docmanager.openOrReveal(e);t&&!t.context.model.dirty&&t.context.revert()}}_revertFile(e){var t;const s=this.getRelativeFilePath(e);if(!s)return;const i=null===(t=this._docmanager)||void 0===t?void 0:t.findWidget(s);i&&!i.context.model.dirty&&i.context.revert()}_setMarker(e,t){this.__currentMarker=this._markerCache.get(e,t)}}class Me{constructor(e){this._refresh=e,this._marks={}}add(e,t=!0){e in this._marks||this.set(e,t)}get(e){return this._marks[e]}set(e,t){this._marks[e]=t,this._refresh()}toggle(e){this.set(e,!this._marks[e])}get markedFilePaths(){const e=[];for(const t in this._marks)this._marks[t]&&e.push(t);return e}}class He{constructor(e){this._refresh=e,this._branchMarkers={}}get(e,t){const s=He.markerKey(e,t);if(s in this._branchMarkers)return this._branchMarkers[s];const i=new Me(this._refresh);return this._branchMarkers[s]=i,i}static markerKey(e,t){return[e,t].join(":")}}const $e=(0,S.style)({flex:"0 0 auto",background:"none",lineHeight:"0px",padding:"0px 0px",width:"16px",border:"none",outline:"none",cursor:"pointer",margin:"0 4px",$nest:{"&:active":{transform:"scale(1.272019649)",overflow:"hidden",backgroundColor:"var(--jp-layout-color3)"},"&:disabled":{opacity:.4,background:"none",cursor:"not-allowed"},"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}}),Oe=(0,S.style)({display:"none"}),ze=(()=>{const e={$nest:{}},t=`&:hover .${Oe}`;return e.$nest[t]={display:"block"},e})(),Ue=(0,S.style)({flex:"1 1 auto",minHeight:"150px",overflow:"hidden",overflowY:"auto"}),We=e=>{const{disabled:t,className:s,title:i,onClick:a,icon:n}=e;return m.createElement("button",{disabled:t,className:(0,S.classes)($e,s),title:i,onClick:a},m.createElement(n.react,{elementPosition:"center",tag:"span"}))},Ge=(0,S.style)({userSelect:"none",display:"flex",flexDirection:"row",alignItems:"center",boxSizing:"border-box",color:"var(--jp-ui-font-color1)",lineHeight:"var(--jp-private-running-item-height)",padding:"0px 4px",listStyleType:"none",$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}},ze),Ve=(0,S.style)((()=>{const e={color:"white",background:"var(--jp-brand-color1)",$nest:{"&:hover":{color:"white",background:"var(--jp-brand-color1) !important"},"&:hover .jp-icon-selectable[fill]":{fill:"white"},"&:hover .jp-icon-selectable[stroke]":{stroke:"white"},"& .jp-icon-selectable[fill]":{fill:"white"},"& .jp-icon-selectable-inverse[fill]":{fill:"var(--jp-brand-color1)"}}};return e.$nest[`& .${$e}:active`]={backgroundColor:"var(--jp-brand-color1)"},e.$nest[`& .${$e}:hover`]={backgroundColor:"var(--jp-brand-color1)"},e})()),qe=(0,S.style)({fontSize:"10px",marginLeft:"5px"}),Ke=(0,S.style)({color:"white !important"}),Xe=(0,S.style)({color:"var(--jp-brand-color0)"}),Ye=(0,S.style)({color:"var(--jp-warn-color0)",fontWeight:"bold"}),Ze=(0,S.style)({color:"var(--jp-info-color0)"}),Je=((0,S.style)({display:"none"}),(0,S.style)({marginTop:"5px"}),(0,S.style)({flex:"0 0 auto"})),Qe=(0,S.style)({display:"flex",alignItems:"center"}),et=(0,S.style)({display:"flex",width:"100%"}),tt=(0,S.style)({display:"flex",marginLeft:"auto",overflow:"hidden"}),st=(0,S.style)({flex:"0 0 auto",height:"16px",width:"16px",marginRight:"4px"}),it=(0,S.style)({flex:"1 1 auto",fontSize:"var(--jp-ui-font-size1)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),at=(0,S.style)({color:"var(--jp-ui-font-color2)",fontSize:"var(--jp-ui-font-size0)",margin:"0px 4px"}),nt=e=>{var t;const s="/"===(i=e.filepath)[i.length-1]?i:g.PathExt.basename(i);var i;const a=e.filepath.slice(0,e.filepath.length-s.length).replace(/^\/|\/$/g,""),n=(null===(t=e.filetype)||void 0===t?void 0:t.icon)||_.fileIcon;return m.createElement(m.Fragment,null,m.createElement(n.react,{className:st,elementPosition:"center",tag:"span"}),m.createElement("span",{className:it},s,m.createElement("span",{className:at},a)))};class rt extends m.PureComponent{constructor(){super(...arguments),this._onDoubleClick=e=>{e.stopPropagation()}}render(){return this.props.model.addMark(this.props.fname,"untracked"!==this.props.stage),m.createElement("input",{name:"gitMark",className:Je,type:"checkbox",checked:this.props.checked,onDoubleClick:this._onDoubleClick})}}class ot extends m.PureComponent{constructor(e){super(e),this._onClick=e=>{this.props.markBox?e.shiftKey?this.props.markUntilFile(this.props.file):(this.props.model.toggleMark(this.props.file.to),this.props.setSelection(this.props.file,{singleton:!0})):e.ctrlKey||e.metaKey?this.props.setSelection(this.props.file):e.shiftKey?this.props.setSelection(this.props.file,{group:!0}):this.props.setSelection(this.props.file,{singleton:!0})}}_getFileChangedLabel(e,t){return lt.get_status(e,t)||t.__("Unmodified")}_getFileChangedLabelClass(e){return"M"===e?this.props.selected?(0,S.classes)(qe,Xe,Ke):(0,S.classes)(qe,Xe):"!"===e?this.props.selected?(0,S.classes)(qe,Ye,Ke):(0,S.classes)(qe,Ye):this.props.selected?(0,S.classes)(qe,Ze,Ke):(0,S.classes)(qe,Ze)}_getFileClass(){const e=this.props.selected?(0,S.classes)(Ge,Ve):Ge;return this.props.className?`${e} ${this.props.className}`:e}render(){var e;const{file:t}=this.props,s="staged"===t.status?t.x:t.y,i="unmerged"===t.status?this.props.trans.__("Conflicted"):this._getFileChangedLabel(s,this.props.trans);return m.createElement("div",{"data-test-selected":this.props.selected,"data-test-checked":this.props.checked,className:this._getFileClass(),onClick:this._onClick,onContextMenu:this.props.contextMenu&&(e=>{this.props.contextMenu(this.props.file,e)}),onDoubleClick:this.props.onDoubleClick,style:this.props.style,title:this.props.trans.__(`%1  ${i}`,this.props.file.to)},m.createElement("div",{className:et},m.createElement("div",{className:Qe+" "+it},this.props.markBox&&m.createElement(rt,{fname:this.props.file.to,stage:this.props.file.status,model:this.props.model,checked:null!==(e=this.props.checked)&&void 0!==e&&e}),m.createElement(nt,{filepath:this.props.file.to,filetype:this.props.file.type})),m.createElement("div",{className:tt},this.props.actions,m.createElement("span",{className:this._getFileChangedLabelClass("unmerged"===this.props.file.status?"!":this.props.file.y)},"unmerged"===this.props.file.status?"!":"?"===this.props.file.y?"U":s))))}}var lt;!function(e){let t=null;e.get_status=function(e,s){return t||(t={M:s.__("Modified"),A:s.__("Added"),D:s.__("Deleted"),R:s.__("Renamed"),C:s.__("Copied"),U:s.__("Updated"),B:s.__("Behind"),"?":s.__("Untracked"),"!":s.__("Ignored")}),t[e]}}(lt||(lt={}));const ct=(0,S.style)({display:"flex",flexDirection:"row",alignItems:"center",padding:"4px",fontWeight:600,borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)",letterSpacing:"1px",fontSize:"12px",overflowY:"hidden",height:"16px",$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}},ze),dt=(0,S.style)((()=>{const e={margin:"0",padding:"0",overflow:"auto",$nest:{}},t=`&:focus-within .${ct} .${Oe}`;e.$nest[t]={display:"block"};const s=`&:hover .${ct} .${Oe}`;return e.$nest[s]={display:"block"},e})()),ht=(0,S.style)({fontSize:"var(--jp-ui-font-size1)",flex:"1 1 auto",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}),pt=(0,S.style)({fontSize:"var(--jp-ui-font-size1)",flex:"0 0 auto",whiteSpace:"nowrap",borderRadius:"2px"}),mt=(0,S.style)({flex:"0 0 auto",backgroundColor:"transparent",height:"13px",border:"none",outline:"none",paddingLeft:"0px"}),ut=e=>{const[t,s]=m.useState(!0),i=e.files.length;return m.createElement("div",{className:dt},m.createElement("div",{className:ct,onClick:()=>{e.collapsible&&i>0&&s(!t)}},e.selectAllButton&&e.selectAllButton,e.collapsible&&m.createElement("button",{className:mt},t&&i>0?m.createElement(_.caretDownIcon.react,{tag:"span"}):m.createElement(_.caretRightIcon.react,{tag:"span"})),m.createElement("span",{className:ht},e.heading),e.actions,m.createElement("span",{className:pt},"(",i,")")),t&&i>0&&m.createElement(k.FixedSizeList,{height:Math.max(Math.min(e.height-34,25*i),25),itemCount:i,itemData:e.files,itemKey:(e,t)=>t[e].to,itemSize:25,style:{overflowX:"hidden"},width:"auto"},e.rowRenderer))};async function gt(e,t,s){if((await(0,a.showDialog)({title:t.__("Discard all changes"),body:s?t.__("Your current changes forbid pulling the latest changes. Do you want to permanently discard those changes? This action cannot be undone."):t.__("Are you sure you want to permanently discard changes to all files? This action cannot be undone."),buttons:[a.Dialog.cancelButton({label:t.__("Cancel")}),a.Dialog.warnButton({label:t.__("Discard")})]})).button.accept)try{return e.resetToCommit("HEAD")}catch(e){return(0,a.showErrorMessage)(t.__("Discard all changes failed."),e),Promise.reject(e)}return Promise.reject({cancelled:!0,message:"The user refused to discard all changes"})}const _t=e=>{const{className:t,onChange:s,checked:i}=e;return m.createElement("input",{type:"checkbox",className:t,onChange:s,style:{marginRight:"10px"},checked:i,"data-test-id":"SelectAllButton"})},ft={"partially-staged":[Se.gitFileOpen,Se.gitFileUnstage,Se.gitFileDiff,Se.gitFileHistory],"remote-changed":[Se.gitFileOpen],unstaged:[Se.gitFileOpen,Se.gitFileStage,Se.gitFileDiscard,Se.gitFileDiff,Se.gitFileHistory],untracked:[Se.gitFileOpen,Se.gitFileTrack,Se.gitIgnore,Se.gitIgnoreExtension,Se.gitFileDelete],staged:[Se.gitFileOpen,Se.gitFileUnstage,Se.gitFileDiff,Se.gitCommitAmendStaged,Se.gitFileHistory],unmodified:[Se.gitFileHistory],unmerged:[Se.gitFileDiff],stashed:[Se.gitFileStashPop]},bt={"partially-staged":[Se.gitFileOpen,Se.gitFileDiscard,Se.gitFileDiff,Se.gitFileHistory],"remote-changed":[Se.gitFileOpen],staged:[Se.gitFileOpen,Se.gitFileDiscard,Se.gitFileDiff,Se.gitFileHistory],unstaged:[Se.gitFileOpen,Se.gitFileDiscard,Se.gitFileDiff,Se.gitFileHistory],untracked:[Se.gitFileOpen,Se.gitIgnore,Se.gitIgnoreExtension,Se.gitFileDelete],unmodified:[Se.gitFileHistory],unmerged:[Se.gitFileDiff],stashed:[Se.gitFileStashPop]},yt=(e,t)=>e.x===t.x&&e.y===t.y&&e.from===t.from&&e.to===t.to&&e.status===t.status;class vt extends m.Component{constructor(e){super(e),this.openContextMenu=(e,t)=>{let s;t.preventDefault(),this._isSelectedFile(e)?s=this.state.selectedFiles:(this._selectOnlyOneFile(e),s=[e]);const i=new y.Menu({commands:this.props.commands});os(ft[s[0].status],i,s),i.open(t.clientX,t.clientY)},this.openSimpleContextMenu=(e,t)=>{t.preventDefault();const s=new y.Menu({commands:this.props.commands});os(bt[e.status],s,[e]),s.open(t.clientX,t.clientY)},this.resetAllStagedFiles=async e=>{null==e||e.stopPropagation(),await this.props.model.reset()},this.resetSelectedFiles=e=>{this._isSelectedFile(e)?this.state.selectedFiles.forEach((e=>this.props.model.reset(e.to))):this.props.model.reset(e.to)},this.openSelectedFiles=e=>{this._isSelectedFile(e)?this.props.commands.execute(Se.gitFileOpen,{files:this.state.selectedFiles}):this.props.commands.execute(Se.gitFileOpen,{files:[e]})},this.addAllUnstagedFiles=async e=>{null==e||e.stopPropagation(),await this.props.model.addAllUnstaged()},this.discardAllUnstagedFiles=async e=>{if(null==e||e.stopPropagation(),(await(0,a.showDialog)({title:this.props.trans.__("Discard all changes"),body:this.props.trans.__("Are you sure you want to permanently discard changes to all unstaged files? This action cannot be undone."),buttons:[a.Dialog.cancelButton({label:this.props.trans.__("Cancel")}),a.Dialog.warnButton({label:this.props.trans.__("Discard")})]})).button.accept)try{await this.props.model.checkout()}catch(e){(0,a.showErrorMessage)(this.props.trans.__("Discard all unstaged changes failed."),e)}},this.discardAllChanges=async e=>{null==e||e.stopPropagation(),await gt(this.props.model,this.props.trans)},this.addFile=async(...e)=>{await this.props.model.add(...e)},this.discardChanges=e=>{this._isSelectedFile(e)?this.props.commands.execute(Se.gitFileDiscard,{files:this.state.selectedFiles}):this.props.commands.execute(Se.gitFileDiscard,{files:[e]})},this.addAllUntrackedFiles=async e=>{null==e||e.stopPropagation(),await this.props.model.addAllUntracked()},this.addAllMarkedFiles=async()=>{await this.addFile(...this.markedFiles.map((e=>e.to)))},this.setSelection=(e,t)=>{t&&t.singleton&&this._selectOnlyOneFile(e),t&&t.group&&this._selectUntilFile(e),t||this._toggleFile(e)},this.markUntilFile=e=>{if(!this.state.lastClickedFile)return void this.props.model.setMark(e.to,!0);const t=this.props.files.filter((e=>!["unmerged","remote-changed"].includes(e.status))),s=t.findIndex((e=>{var t;return yt(e,null!==(t=this.state.lastClickedFile)&&void 0!==t?t:{})})),i=t.findIndex((t=>yt(t,e)));i>s?t.slice(s,i+1).forEach((e=>this.props.model.setMark(e.to,!0))):t.slice(i,s+1).forEach((e=>this.props.model.setMark(e.to,!0)))},this.toggleAllFiles=e=>{const t=this._areFilesAllMarked();e.forEach((e=>this.props.model.setMark(e.to,!t)))},this._selectOnlyOneFile=e=>{this.setState({selectedFiles:[e],lastClickedFile:e})},this._toggleFile=e=>{var t;e.status===(null===(t=this.state.lastClickedFile)||void 0===t?void 0:t.status)?this.state.selectedFiles.find((t=>yt(t,e)))?this.setState({selectedFiles:this.state.selectedFiles.filter((t=>!yt(t,e))),lastClickedFile:e}):this.setState({selectedFiles:[...this.state.selectedFiles,e],lastClickedFile:e}):this._selectOnlyOneFile(e)},this._selectFiles=e=>{this.setState((t=>({selectedFiles:[...t.selectedFiles,...e.filter((e=>!t.selectedFiles.some((t=>yt(t,e)))))]})))},this._deselectFiles=e=>{this.setState((t=>({selectedFiles:t.selectedFiles.filter((t=>!e.some((e=>yt(t,e)))))})))},this._selectUntilFile=e=>{if(!this.state.lastClickedFile||e.status!==this.state.lastClickedFile.status)return void this._selectOnlyOneFile(e);const t=this.state.lastClickedFile.status,s=this.props.files.filter((e=>e.status===t)),i=this.props.files.filter((e=>"partially-staged"===e.status));switch(t){case"staged":s.push(...i.map((e=>({...e,status:"staged"}))));break;case"unstaged":s.push(...i.map((e=>({...e,status:"unstaged"}))))}s.sort(((e,t)=>e.to.localeCompare(t.to)));const a=s.findIndex((e=>{var t;return yt(e,null!==(t=this.state.lastClickedFile)&&void 0!==t?t:{})})),n=s.findIndex((t=>yt(t,e)));if(n>a){const e=s.findIndex(((e,t)=>t>a&&!this._isSelectedFile(e)));-1===e?this._deselectFiles(s.slice(n+1)):n<e?this._deselectFiles(s.slice(n+1,e)):this._selectFiles(s.slice(e,n+1))}else if(n<a){const e=s.findIndex(((e,t)=>t<a&&this._isSelectedFile(e)));-1===e?this._selectFiles(s.slice(n,a)):n<e?this._selectFiles(s.slice(n,e)):this._deselectFiles(s.slice(e,n))}else this._selectOnlyOneFile(e)},this.pullFromRemote=async e=>{await this.props.commands.execute(Re.gitPull,{})},this._renderUnmergedRow=e=>{const{data:t,index:s,style:i}=e,a=t[s],n=this._createDiffButton(a);return m.createElement(ot,{trans:this.props.trans,actions:a.is_binary?null:n,contextMenu:this.openContextMenu,file:a,model:this.props.model,selected:this._isSelectedFile(a),setSelection:this.setSelection,onDoubleClick:()=>this._openDiffViews([a]),style:{...i}})},this._renderStagedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:a}=e,n=s[i],r=this._createDiffButton(n);return m.createElement(ot,{trans:this.props.trans,actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:H,title:this.props.trans.__("Open this file"),onClick:Pe((()=>this.openSelectedFiles(n)))}),r,m.createElement(We,{className:Oe,icon:z,title:this.props.trans.__("Unstage this change"),onClick:Pe((()=>{this.resetSelectedFiles(n)}))})),file:n,contextMenu:this.openContextMenu,model:this.props.model,selected:this._isSelectedFile(n),setSelection:this.setSelection,onDoubleClick:t?r?()=>this._openDiffViews([n]):()=>{}:()=>this.openSelectedFiles(n),style:a})},this._renderChangedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:a}=e,n=s[i],r=this._createDiffButton(n);return m.createElement(ot,{trans:this.props.trans,actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:H,title:this.props.trans.__("Open this file"),onClick:Pe((()=>this.openSelectedFiles(n)))}),r,m.createElement(We,{className:Oe,icon:A,title:this.props.trans.__("Discard changes"),onClick:Pe((()=>{this.discardChanges(n)}))}),m.createElement(We,{className:Oe,icon:F,title:this.props.trans.__("Stage this change"),onClick:Pe((()=>{this._isSelectedFile(n)?this.addFile(...this.state.selectedFiles.map((e=>e.to))):this.addFile(n.to)}))})),file:n,contextMenu:this.openContextMenu,model:this.props.model,selected:this._isSelectedFile(n),setSelection:this.setSelection,onDoubleClick:t?r?()=>this._openDiffViews([n]):()=>{}:()=>this.openSelectedFiles(n),style:a})},this._renderUntrackedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:a}=e,n=s[i];return m.createElement(ot,{trans:this.props.trans,actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:H,title:this.props.trans.__("Open this file"),onClick:Pe((()=>this.openSelectedFiles(n)))}),m.createElement(We,{className:Oe,icon:F,title:this.props.trans.__("Track this file"),onClick:Pe((()=>{this._isSelectedFile(n)?this.addFile(...this.state.selectedFiles.map((e=>e.to))):this.addFile(n.to)}))})),file:n,contextMenu:this.openContextMenu,model:this.props.model,onDoubleClick:()=>{t||this.props.commands.execute(Se.gitFileOpen,{files:[n]})},selected:this._isSelectedFile(n),setSelection:this.setSelection,style:a})},this._renderRemoteChangedRow=e=>{const t=this.props.settings.get("doubleClickDiff").composite,{data:s,index:i,style:a}=e,n=s[i];return m.createElement(ot,{trans:this.props.trans,actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:H,title:this.props.trans.__("Open this file"),onClick:Pe((()=>this.openSelectedFiles(n)))})),file:n,contextMenu:this.openContextMenu,model:this.props.model,onDoubleClick:()=>{t||this.props.commands.execute(Se.gitFileOpen,{files:[n]})},selected:this._isSelectedFile(n),setSelection:this.setSelection,style:a})},this._renderSimpleStageRow=e=>{const{data:t,index:s,style:i}=e,a=t[s],n=this.props.settings.get("doubleClickDiff").composite,r=()=>{this.props.commands.execute(Se.gitFileOpen,{files:[a]})};let o=m.createElement(We,{className:Oe,icon:H,title:this.props.trans.__("Open this file"),onClick:Pe(r)}),l=n?()=>{}:r;if("unstaged"===a.status||"partially-staged"===a.status){const e=this._createDiffButton(a);o=m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:H,title:this.props.trans.__("Open this file"),onClick:Pe(r)}),e,m.createElement(We,{className:Oe,icon:A,title:this.props.trans.__("Discard changes"),onClick:Pe((()=>{this.discardChanges(a)}))})),l=n?e?()=>this._openDiffViews([a]):()=>{}:r}else if("staged"===a.status){const e=this._createDiffButton(a);o=m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:H,title:this.props.trans.__("Open this file"),onClick:Pe(r)}),e,m.createElement(We,{className:Oe,icon:A,title:this.props.trans.__("Discard changes"),onClick:Pe((()=>{this.discardChanges(a)}))})),l=n?e?()=>this._openDiffViews([a]):()=>{}:r}const c=this.markedFiles.some((e=>yt(e,a)));return m.createElement(ot,{trans:this.props.trans,actions:o,file:a,markBox:!0,model:this.props.model,onDoubleClick:l,contextMenu:this.openSimpleContextMenu,setSelection:this.setSelection,style:i,markUntilFile:this.markUntilFile,checked:c})},this._onStashClick=async()=>{await this.props.commands.execute(Re.gitStash)},this.state={selectedFiles:[],lastClickedFile:null,markedFiles:e.model.markedFiles}}componentDidMount(){const{model:e}=this.props;e.markChanged.connect((()=>{this.setState({markedFiles:e.markedFiles})}),this),e.repositoryChanged.connect((()=>{this.setState({markedFiles:e.markedFiles})}),this)}componentWillUnmount(){be.Signal.clearData(this)}get markedFiles(){return this.props.model.markedFiles}render(){const e=[],t=[];if(this.props.settings.composite.simpleStaging){const s=[];return this.props.files.forEach((i=>{switch(i.status){case"remote-changed":e.push(i);break;case"unmerged":t.push(i);break;default:s.push(i)}})),m.createElement("div",{className:Ue},m.createElement(ve(),{disableWidth:!0},(({height:i})=>m.createElement(m.Fragment,null,this._renderUnmerged(t,i,!1),this._renderRemoteChanged(e,i),this._renderSimpleStage(s,i)))))}{const s=[],i=[],a=[];return this.props.files.forEach((n=>{switch(n.status){case"staged":s.push(n);break;case"unstaged":i.push(n);break;case"untracked":a.push(n);break;case"partially-staged":s.push({...n,status:"staged"}),i.push({...n,status:"unstaged"});break;case"unmerged":t.push(n);break;case"remote-changed":e.push(n)}})),m.createElement("div",{className:Ue,onContextMenu:e=>e.preventDefault()},m.createElement(ve(),{disableWidth:!0},(({height:n})=>m.createElement(m.Fragment,null,this._renderUnmerged(t,n),this._renderRemoteChanged(e,n),this._renderStaged(s,n),this._renderChanged(i,n),this._renderUntracked(a,n)))))}}_isSelectedFile(e){return this.state.selectedFiles.some((t=>yt(t,e)))}_renderUnmerged(e,t,s=!0){return e.length>0?m.createElement(ut,{collapsible:s,files:e,heading:this.props.trans.__("Conflicted"),height:t,rowRenderer:this._renderUnmergedRow}):null}_renderStaged(e,t){return m.createElement(ut,{actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:U,onClick:this._onStashClick,title:this.props.trans.__("Stash latest changes")}),m.createElement(We,{className:Oe,disabled:0===e.length,icon:z,title:this.props.trans.__("Unstage all changes"),onClick:this.resetAllStagedFiles})),collapsible:!0,files:e,heading:this.props.trans.__("Staged"),height:t,rowRenderer:this._renderStagedRow})}_renderChanged(e,t){const s=0===e.length;return m.createElement(ut,{actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:U,onClick:this._onStashClick,title:this.props.trans.__("Stash latest changes")}),m.createElement(We,{className:Oe,disabled:s,icon:A,title:this.props.trans.__("Discard All Changes"),onClick:this.discardAllUnstagedFiles}),m.createElement(We,{className:Oe,disabled:s,icon:F,title:this.props.trans.__("Stage all changes"),onClick:this.addAllUnstagedFiles})),collapsible:!0,heading:this.props.trans.__("Changed"),height:t,files:e,rowRenderer:this._renderChangedRow})}_renderUntracked(e,t){return m.createElement(ut,{actions:m.createElement(We,{className:Oe,disabled:0===e.length,icon:F,title:this.props.trans.__("Track all untracked files"),onClick:this.addAllUntrackedFiles}),collapsible:!0,heading:this.props.trans.__("Untracked"),height:t,files:e,rowRenderer:this._renderUntrackedRow})}_renderRemoteChanged(e,t){return e.length>0&&m.createElement(ut,{actions:m.createElement(We,{className:Oe,disabled:0===e.length,icon:F,title:this.props.trans.__("Pull from remote branch"),onClick:this.pullFromRemote}),collapsible:!0,heading:this.props.trans.__("Remote Changes"),height:t,files:e,rowRenderer:this._renderRemoteChangedRow})}_renderSimpleStage(e,t){return m.createElement(ut,{selectAllButton:m.createElement(_t,{onChange:()=>{this.toggleAllFiles(e)},checked:this._areFilesAllMarked()}),actions:m.createElement(We,{className:Oe,disabled:0===e.length,icon:A,title:this.props.trans.__("Discard All Changes"),onClick:this.discardAllChanges}),heading:this.props.trans.__("Changed"),height:t,files:e,rowRenderer:this._renderSimpleStageRow})}_createDiffButton(e){let t;return t=this.props.settings.composite.simpleStaging?()=>this._openDiffViews([e]):()=>{this._isSelectedFile(e)?this._openDiffViews(this.state.selectedFiles):this._openDiffViews([e])},(Te(e.to)||!e.is_binary)&&m.createElement(We,{className:Oe,icon:I,title:this.props.trans.__("Diff this file"),onClick:Pe(t)})}async _openDiffViews(e){try{await this.props.commands.execute(Se.gitFileDiff,{files:e.map((e=>({filePath:e.to,isText:!e.is_binary,status:e.status})))})}catch(e){console.error(`Failed to open diff views.\n${e}`)}}_areFilesAllMarked(){const e=this.props.files.filter((e=>!["unmerged","remote-changed"].includes(e.status)));return 0!==e.length&&e.every((e=>this.state.markedFiles.some((t=>yt(e,t)))))}}const wt=(0,S.style)({color:"var(--jp-ui-font-color1)!important",borderRadius:"3px!important",backgroundColor:"var(--jp-layout-color1)!important"}),Ct=(0,S.style)({display:"flex",flexDirection:"column",$nest:{"& > input":{marginTop:"10px",lineHeight:"20px"}}}),xt=(0,S.style)({padding:"15px 0px !important",justifyContent:"space-around !important"}),Et=(0,S.style)({margin:"1.5rem 0rem 1rem",padding:"0px"}),kt=(0,S.style)({marginTop:"2px",display:"grid",rowGap:"5px",columnGap:"10px",gridTemplateColumns:"auto auto auto"});class St extends m.Component{constructor(e){super(e),this._nameInput=null,this._urlInput=null,this._addRemoteButton=null,this.state={newRemote:{name:"",url:""},existingRemotes:null}}async componentDidMount(){try{const e=await this.props.model.getRemotes();this.setState({existingRemotes:e})}catch(e){console.error(e)}}render(){return m.createElement(w.A,{classes:{paper:wt},open:!0,onClose:this.props.onClose},m.createElement("div",{className:Y},m.createElement("p",{className:Z},this.props.trans.__("Manage Remotes")),m.createElement("button",{className:X},m.createElement(E.A,{titleAccess:this.props.trans.__("Close this dialog"),fontSize:"small",onClick:()=>this.props.onClose()}))),m.createElement("div",{className:J},m.createElement("label",{className:Ct},m.createElement("span",null,this.props.trans.__("Enter a new remote repository name and URL")),m.createElement("input",{ref:e=>{this._nameInput=e},type:"text",placeholder:this.props.trans.__("name"),onChange:e=>this.setState({newRemote:{...this.state.newRemote,name:e.target.value}})}),m.createElement("input",{ref:e=>{this._urlInput=e},type:"text",placeholder:this.props.trans.__("Remote Git repository URL"),onChange:e=>this.setState({newRemote:{...this.state.newRemote,url:e.target.value}}),onKeyPress:e=>{var t;"Enter"===e.key&&(null===(t=this._addRemoteButton)||void 0===t||t.click())}})),this.props.warningContent&&m.createElement("div",{className:"jp-RemoteDialog-warning"},this.props.warningContent),m.createElement(C.A,{className:xt},m.createElement("input",{ref:e=>{this._addRemoteButton=e},className:(0,S.classes)(ue,_e),type:"button",title:this.props.trans.__("Add Remote"),value:this.props.trans.__("Add"),onClick:async()=>{const{name:e,url:t}=this.state.newRemote;try{await this.props.model.addRemote(t,e),this._nameInput.value="",this._urlInput.value="",this.setState((e=>{var t;return{existingRemotes:[...null!==(t=e.existingRemotes)&&void 0!==t?t:[],e.newRemote],newRemote:{name:"",url:""}}}))}catch(e){console.error(e),(0,a.showErrorMessage)(this.props.trans.__("Error when adding remote repository"),e)}},disabled:!this.state.newRemote.name||!this.state.newRemote.url})),m.createElement("div",{className:Et},m.createElement("p",null,this.props.trans.__("Existing Remotes:")),null===this.state.existingRemotes?m.createElement("p",null,"Loading remote repositories..."):this.state.existingRemotes.length>0?m.createElement("div",{className:kt},this.state.existingRemotes.map(((e,t)=>m.createElement(m.Fragment,{key:`remote-${t}`},m.createElement("span",null,e.name),m.createElement("span",null,e.url),m.createElement(We,{icon:V,title:this.props.trans.__("Remove this remote"),onClick:async()=>{var t;await this.props.model.removeRemote(e.name),this.setState({existingRemotes:(null!==(t=this.state.existingRemotes)&&void 0!==t?t:[]).filter((t=>t.name!==e.name))})}}))))):m.createElement("p",null," This repository does not have any remote. "))))}}const Rt=(0,S.style)({flex:"1 1 auto",display:"flex",flexDirection:"column",minHeight:"200px",marginBlockStart:0,marginBlockEnd:0,paddingLeft:0,listStyleType:"none"}),Ft=(0,S.style)({display:"flex",height:"200px",overflowY:"auto"}),Nt=(0,S.style)({backgroundColor:"var(--jp-brand-color1)!important",$nest:{"& .jp-icon-selectable[fill]":{fill:"white"}}}),Dt=(0,S.style)({color:"white!important",fontWeight:"700"}),jt=(0,S.style)({color:"white!important"}),Pt=(0,S.style)({flexGrow:0,display:"flex",flexShrink:0,flexDirection:"column",padding:"5px 0px 5px 10px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),Bt=(0,S.style)({display:"flex",color:"var(--jp-ui-font-color2)",paddingBottom:"5px"}),It=(0,S.style)({width:"30%",paddingLeft:"0.5em",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",textAlign:"left",$nest:{"&:first-child":{paddingLeft:0}}}),At=(0,S.style)({flex:"auto"});class Tt{constructor(){this._SVGPath=[]}toString(){return this._SVGPath.join(" ")}moveTo(e,t){this._SVGPath.push(`M ${e},${t}`)}lineTo(e,t){this._SVGPath.push(`L ${e},${t}`)}closePath(){this._SVGPath.push("Z")}bezierCurveTo(e,t,s,i,a,n){this._SVGPath.push(`C ${e}, ${t}, ${s}, ${i}, ${a}, ${n}`)}}const Lt=["#e11d21","#fbca04","#009800","#006b75","#207de5","#0052cc","#5319e7","#f7c6c7","#fad8c7","#fef2c0","#bfe5bf","#c7def8","#bfdadc","#bfd4f2","#d4c5f9","#cccccc","#84b6eb","#e6e6e6","#cc317c"],Mt=function(e){return Lt[e%Lt.length]};class Ht extends m.Component{constructor(e){super(e),this._graphData=[],this._x_step=10,this._dotRadius=this.props.dotRadius||3,this._lineWidth=this.props.lineWidth||2}getGraphData(){return this._graphData=function(e,t){const s=[],i=[0],a=[],n={};function r(e){return null!==n[e]&&void 0!==n[e]||(n[e]=i[0],a.push(i[0]),i[0]++),n[e]}let o=25;return e.forEach(((i,l)=>{let c,d;const h=r(i.sha),p=i.parents.length,m=a.indexOf(h),u=[];if(1===p)if(n[i.parents[0]]||0===n[i.parents[0]]){const e=a.slice(m+1);for(d=0;d<e.length;d++)c=e[d],u.push({from:d+m+1,to:d+m+1-1,branch:c});const t=a.slice(0,m);for(d=0;d<t.length;d++)c=t[d],u.push({from:d,to:d,branch:c});_=h,(g=a).splice(g.indexOf(_),1),u.push({from:m,to:a.indexOf(n[i.parents[0]]),branch:h})}else{for(d=0;d<a.length;d++)c=a[d],u.push({from:d,to:d,branch:c});n[i.parents[0]]=h}else if(2===p){for(n[i.parents[0]]=h,d=0;d<a.length;d++)c=a[d],u.push({from:d,to:d,branch:c});const e=r(i.parents[1]);u.push({from:m,to:a.indexOf(e),branch:e})}var g,_;l-1>=0&&(o+=t(e[l-1].sha));const f=((e,t,s,i,a)=>({sha:e,dot:{lateralOffset:t,branch:s},routes:i,yOffset:a}))(i.sha,m,h,u,o);s.push(f)})),s}(this.props.commits,this.props.getNodeHeight),this._graphData}getBranchCount(){return(e=>{let t=-1;return e.forEach((e=>{t=e.routes.reduce(((e,t)=>Math.max(e,t.from,t.to)),t)})),t+1})(this.getGraphData())}getWidth(){return(this.getBranchCount()+.5)*this._x_step}getHeight(){const e=this.props.commits.length,t=0===e?0:this.props.getNodeHeight(this.props.commits[e-1].sha);return(0===this._graphData.length?0:this._graphData[this._graphData.length-1].yOffset)+t}renderRouteNode(e,t){const s={stroke:Mt(t),strokeWidth:this._lineWidth,fill:"none"},i=`commits-graph-branch-${t}`;return m.createElement("path",{d:e,style:s,className:i})}renderRoute(e,t,s){const{from:i,to:a,branch:n}=t,r=this._x_step,o=new Tt,l=(i+1)*r,c=e,d=(a+1)*r,h=e+s;return o.moveTo(l,c),l===d?o.lineTo(d,h):o.bezierCurveTo(l-r/4,c+s/2,d+r/4,h-s/2,d,h),this.renderRouteNode(o.toString(),n)}renderCommitNode(e,t,s,i){const a=this._dotRadius,n=Mt(i),r={stroke:n,strokeWidth:1,fill:n},o=`commits-graph-branch-${i}`;return m.createElement("circle",{cx:e,cy:t,r:a,style:r,"data-sha":s,className:o},m.createElement("title",null,s.slice(0,7)))}renderCommit(e){const{sha:t,dot:s,routes:i,yOffset:a}=e,{lateralOffset:n,branch:r}=s,o=(n+1)*this._x_step,l=a;return[this.renderCommitNode(o,l,t,r),i.map((t=>this.renderRoute(e.yOffset,t,this.props.getNodeHeight(e.sha))))]}render(){const e=[],t=[];this.getGraphData().forEach((s=>{const i=s,[a,n]=this.renderCommit(i);e.push(a),t.push(...n)}));const s=[...t,...e],i=this.getHeight(),a=this.getWidth(),n={height:i,width:a,flexShrink:0};return m.createElement("svg",{height:i,width:a,style:n},...s)}}const $t=e=>{const{filter:t,baseCommitId:s,updateBaseCommitId:i}=e,a=e.pastCommits.filter((e=>!t||e.commit_msg.toLowerCase().includes(t.toLowerCase()))).slice(),[n,r]=m.useState({}),o=m.useRef({});let l;return m.useEffect((()=>{const e=new ResizeObserver((e=>{for(const t of e){const e=(Array.isArray(t.borderBoxSize)?t.borderBoxSize[0]:t.borderBoxSize).blockSize,s=t.target.id;r((t=>({...t,[s]:e})))}}));return a.forEach((t=>{const s=o.current[t.commit];e.observe(s,{box:"border-box"})})),()=>e.disconnect()}),[a]),""===t&&(l=!0),!0===e.isSingleCommit&&(l=!1),m.createElement("div",{className:Ft},l&&m.createElement(Ht,{commits:a.map((e=>({sha:e.commit,parents:e.pre_commits}))),getNodeHeight:e=>{var t;return null!==(t=n[e])&&void 0!==t?t:55}}),m.createElement("ol",{className:Rt},a.map(((t,a)=>m.createElement(Ot,{key:a,commit:t,baseCommitId:s,trans:e.trans,setRef:e=>{o.current[t.commit]=e},updateBaseCommitId:i})))))},Ot=e=>{const{baseCommitId:t,updateBaseCommitId:s}=e,i=e.commit.commit===t;let a;i&&(a=!0);const n=m.useCallback((e=>function(){s(e)}),[t]);return m.createElement("li",{id:e.commit.commit,ref:e.setRef,className:(0,S.classes)(Pt,i?Nt:null),title:e.trans.__("Create a new tag pointing to commit %1: %2 by %3",e.commit.commit in ke.Diff.SpecialRef?ke.Diff.SpecialRef[+e.commit.commit]:e.commit.commit.slice(0,7),e.commit.commit_msg,e.commit.author),onClick:n(e.commit.commit)},m.createElement("div",{className:Bt},m.createElement("span",{className:(0,S.classes)(It,a?jt:null)},e.commit.author),m.createElement("span",{className:(0,S.classes)(It,a?jt:null)},+e.commit.commit in ke.Diff.SpecialRef?ke.Diff.SpecialRef[+e.commit.commit]:e.commit.commit.slice(0,7)),m.createElement("span",{className:(0,S.classes)(It,a?jt:null)},e.commit.date)),m.createElement("div",{className:(0,S.classes)(At,a?Dt:null)},e.commit.commit_msg))},zt=e=>{var t,s;const[i,n]=m.useState(""),[r,o]=m.useState(null!==(s=null===(t=e.pastCommits[0])||void 0===t?void 0:t.commit)&&void 0!==s?s:null),[l,c]=m.useState(""),[d,h]=m.useState(""),p=()=>{e.onClose(),n(""),c(""),h("")},u=m.useCallback((e=>{c(e.target.value)}),[l]),g=m.useCallback((e=>{n(e.target.value),h("")}),[i]);return m.createElement(w.A,{classes:{paper:K},open:e.open,onClose:p},m.createElement("div",{className:Y},m.createElement("p",{className:Z},e.trans.__("Create a Tag")),m.createElement("button",{className:X},m.createElement(E.A,{titleAccess:e.trans.__("Close this dialog"),fontSize:"small",onClick:p}))),m.createElement("div",{className:J},d?m.createElement("p",{className:pe},d):null,m.createElement("p",null,e.trans.__("Name")),m.createElement("input",{className:Q,type:"text",onChange:g,value:i,placeholder:"",title:e.trans.__("Enter a tag name")}),m.createElement("p",null,e.trans.__("Create tag pointing to")),e.isSingleCommit?null:m.createElement("div",{className:ee},m.createElement("div",{className:te},m.createElement("input",{className:se,type:"text",onChange:u,value:l,placeholder:e.trans.__("Filter by commit message"),title:e.trans.__("Filter history of commits menu")}),l?m.createElement("button",{className:ie},m.createElement(E.A,{titleAccess:e.trans.__("Clear the current filter"),fontSize:"small",onClick:()=>{c("")}})):null)),m.createElement($t,{pastCommits:e.pastCommits,model:e.model,trans:e.trans,filter:l,baseCommitId:r,updateBaseCommitId:o,isSingleCommit:e.isSingleCommit})),m.createElement(C.A,{className:me},m.createElement("input",{className:(0,S.classes)(ue,ge),type:"button",title:e.trans.__("Close this dialog without creating a new tag"),value:e.trans.__("Cancel"),onClick:p}),m.createElement("input",{className:(0,S.classes)(ue,_e),type:"button",title:e.trans.__("Create a new tag"),value:e.trans.__("Create Tag"),onClick:()=>{(async()=>{const t=i,s=r,o=a.Notification.emit(e.trans.__("Creating tag"),"in-progress",{autoClose:!1});try{await e.model.setTag(t,s)}catch(t){return h(t.message.replace(/^fatal:/,"")),void a.Notification.update({id:o,message:e.trans.__("Failed to create tag."),type:"error",autoClose:!1})}a.Notification.update({id:o,message:e.trans.__("Tag created."),type:"success",autoClose:5e3}),e.onClose(),n(""),c("")})()},disabled:""===i||""!==d})))};var Ut,Wt=s(3993),Gt=s(6662),Vt=s(2638),qt=s(689),Kt=s(8663);class Xt extends y.Panel{constructor({model:e,languageRegistry:t,trans:s,editorFactory:i}){var a,n,r;super(),this._reference=null,this._challenger=null,this._base=null,this.addClass("jp-git-diff-root"),this.addClass("nbdime-root"),this.addWidget(new y.Widget({node:Xt.createHeader(e.reference.label,null===(a=e.base)||void 0===a?void 0:a.label,e.challenger.label)}));const o=new b.PromiseDelegate;this._isReady=o.promise,this._languageRegistry=null!=t?t:new Wt.EditorLanguageRegistry,this._editorFactory=null!=i?i:function(e){const t=new Wt.CodeMirrorEditorFactory({extensions:new Wt.EditorExtensionRegistry,languages:e});return t.newInlineEditor.bind(t)}(this._languageRegistry),this._model=e,this._trans=null!=s?s:p.nullTranslator.load("jupyterlab_git"),Promise.all([this._model.reference.content(),this._model.challenger.content(),null!==(r=null===(n=this._model.base)||void 0===n?void 0:n.content())&&void 0!==r?r:Promise.resolve(null)]).then((([e,t,s])=>{this._reference=e,this._challenger=t,this._base=s,o.resolve()})).catch((e=>{this.showError(e),o.resolve()}))}get _hasConflict(){var e;return null!==(e=this._model.hasConflict)&&void 0!==e&&e}get isFileResolved(){return!0}get model(){return this._model}get ready(){return this._isReady}getResolvedFile(){var e,t;const s=null!==(t=null===(e=this._mergeView)||void 0===e?void 0:e.getMergedValue())&&void 0!==t?t:null;return null!==s?Promise.resolve({type:"file",format:"text",content:s}):Promise.reject(this._trans.__("Failed to get a valid file value."))}onAfterAttach(){this.ready.then((()=>{null!==this._challenger&&null!==this._reference&&this.createDiffView(this._challenger,this._reference,this._hasConflict?this._base:null)})).catch((e=>{this.showError(e)}))}async refresh(){var e,t;await this.ready;try{this._mergeView.dispose(),null!==this._reference&&(this._reference=await this._model.reference.content()),null!==this._challenger&&(this._challenger=await this._model.challenger.content()),null!==this._base&&(this._base=null!==(t=await(null===(e=this._model.base)||void 0===e?void 0:e.content()))&&void 0!==t?t:null),this.createDiffView(this._challenger,this._reference,this._hasConflict?this._base:null),this._challenger=null,this._reference=null,this._base=null}catch(e){this.showError(e)}}static createHeader(...e){const t=void 0!==e[1]?"jp-git-merge-banner":"jp-git-diff-banner",s=document.createElement("div");return s.classList.add(t),s.innerHTML=e.filter((e=>!!e)).map((e=>`<span>${e}</span>`)).join(""),s}async createDiffView(e,t,s=null){var i,a,r,o;if(!this._mergeView){const l=null!==(o=null!==(a=null===(i=this._languageRegistry.findByFileName(this._model.filename))||void 0===i?void 0:i.mime)&&void 0!==a?a:null===(r=this._languageRegistry.findBest(this._model.filename))||void 0===r?void 0:r.mime)&&void 0!==o?o:n.IEditorMimeTypeService.defaultMimeType,c=Array.isArray(l)?l[0]:l;let d,h,p;null!==s?(d=Zt(s,t),h=Zt(s,e),h.mimetype=c,p=(0,qt.bM)(s,s),p.mimetype=c):d=Zt(t,e),d.mimetype=c,this._mergeView=(0,Vt.VK)({remote:d,local:h,merged:p,showBase:!1}),this._mergeView.addClass("jp-git-PlainText-diff"),this.addWidget(this._mergeView)}return Promise.resolve()}showError(e){var t;console.error(this._trans.__("Failed to load file diff."),e,null==e?void 0:e.traceback);const s=(e.message||e).replace("\n","<br />");for(;this.widgets.length>0;){const e=this.widgets[0];null===(t=this.layout)||void 0===t||t.removeWidget(e),e.dispose()}this.node.innerHTML=`<p class="jp-git-diff-error">\n      <span>${this._trans.__("Error Loading File Diff:")}</span>\n      <span class="jp-git-diff-error-message">${s}</span>\n    </p>`}}let Yt;function Zt(e,t,s){const i=function(e,t,s){Yt||(Yt=new Gt.diff_match_patch);const i=Yt.diff_main(e,t);Yt.diff_cleanupSemantic(i);for(let e=0;e<i.length;++e){const t=i[e];(s?/[^ \t]/.test(t[1]):t[1])?e&&i[e-1][0]===t[0]&&(i.splice(e--,1),i[e][1]+=t[1]):i.splice(e--,1)}return i}(e,t,s),a=[],n=[];let r=0,o=0;return i.forEach((([e,t])=>{switch(e){case Ut.Delete:n.push(new Kt.nC(r,t.length)),r+=t.length;break;case Ut.Insert:a.push(new Kt.nC(o,t.length)),o+=t.length;break;case Ut.Equal:r+=t.length,o+=t.length}})),new qt.Os(e,t,a,n)}!function(e){e[e.Equal=Gt.DIFF_EQUAL]="Equal",e[e.Delete=Gt.DIFF_DELETE]="Delete",e[e.Insert=Gt.DIFF_INSERT]="Insert"}(Ut||(Ut={}));class Jt extends a.MainAreaWidget{constructor(e){var t;super(e),(null===(t=e.isPreview)||void 0===t||t)&&(Jt.disposePreviewWidget(Jt.previewWidget),Jt.previewWidget=this)}static disposePreviewWidget(e){var t;return e&&(null===(t=Jt.previewWidget)||void 0===t?void 0:t.dispose())}static pinWidget(e,t,s){setTimeout((()=>{const i=e>=0?t.contentNode.children[e]:null,a=null==i?void 0:i.querySelector(".lm-TabBar-tabLabel");if(!a)return;a.classList.add("jp-git-tab-mod-preview");const n=()=>{a.classList.remove("jp-git-tab-mod-preview"),a.removeEventListener("click",n,!0),Jt.previewWidget===s&&(Jt.previewWidget=null)};a.addEventListener("click",n,!0),s.disposed.connect((()=>{a.removeEventListener("click",n,!0)}))}),0)}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("click",this._onClick.bind(this),!1)}onBeforeDetach(e){this.node.removeEventListener("click",this._onClick.bind(this),!1),super.onBeforeAttach(e)}_onClick(){Jt.previewWidget=null}}Jt.previewWidget=null;class Qt{constructor(e){this._isDisposed=!1,this._challenger=e.challenger,this._filename=e.filename,this._reference=e.reference,this._repositoryPath=e.repositoryPath,this._base=e.base,this._changed=new be.Signal(this)}get changed(){return this._changed}_didContentChange(e,t){return e.label!==t.label||e.source!==t.source||e.updateAt!==t.updateAt}get challenger(){return this._challenger}set challenger(e){this._didContentChange(this._challenger,e)&&(this._challenger=e,this._changed.emit({type:"challenger"}))}get filename(){return this._filename}get reference(){return this._reference}set reference(e){this._didContentChange(this._reference,e)&&(this._reference=e,this._changed.emit({type:"reference"}))}get repositoryPath(){return this._repositoryPath}get base(){return this._base}get hasConflict(){return void 0!==this._base}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,be.Signal.clearData(this))}}function es(e,t){return{autoClose:!1,actions:[{label:t.__("Show"),callback:()=>{(0,a.showErrorMessage)(t.__("Error"),{message:m.createElement("pre",{style:{whiteSpace:"pre-wrap",fontSize:"7pt"}},e.message||e.stack||String(e))},[a.Dialog.warnButton({label:t.__("Dismiss")})])},displayType:"warn"}]}}function ts(e,t){return e?{autoClose:5e3,actions:[{label:t.__("Details"),callback:()=>{(0,a.showErrorMessage)(t.__("Detailed message"),e,[a.Dialog.okButton({label:t.__("Dismiss")})])},displayType:"warn"}]}:{}}class ss extends y.Widget{constructor(e,t){super(),this._trans=e,this._model=t,this._radioButtons=[],this.node.appendChild(this.createBody()),this.addRemoteOptions()}createBody(){const e=document.createElement("div"),t=document.createElement("div");t.className="jp-remote-text",t.textContent=this._trans.__("Choose a remote to push to.");const s=document.createElement("div");s.className="jp-remote-options-wrapper";const i=document.createElement("div");i.textContent=this._trans.__("Loading remote repositories..."),s.appendChild(i),this._remoteOptionsContainer=s;const a=document.createElement("label");a.className="jp-force-box-container",this._forceCheckbox=document.createElement("input"),this._forceCheckbox.type="checkbox",this._forceCheckbox.checked=!1;const n=document.createElement("span");return n.textContent=this._trans.__("Force Push"),a.appendChild(this._forceCheckbox),a.appendChild(n),e.appendChild(t),e.appendChild(s),e.appendChild(a),e}async addRemoteOptions(){const e=await this._model.getRemotes();if(this._remoteOptionsContainer.innerHTML="",e.length>0)e.forEach((e=>{const t=document.createElement("div");t.className="jp-button-wrapper";const s=document.createElement("input");s.type="radio",s.id=e.name,s.value=e.name,s.name="option",s.className="jp-option","origin"===e.name&&(s.checked=!0),this._radioButtons.push(s);const i=document.createElement("label");i.htmlFor=e.name,i.textContent=`${e.name}: ${e.url}`,t.appendChild(s),t.appendChild(i),this._remoteOptionsContainer.appendChild(t)}));else{const e=document.createElement("div");e.textContent=this._trans.__("This repository has no known remotes."),this._remoteOptionsContainer.appendChild(e)}}getValue(){var e,t;return{remoteName:null!==(t=null===(e=this._radioButtons.find((e=>e.checked)))||void 0===e?void 0:e.value)&&void 0!==t?t:"",force:this._forceCheckbox.checked}}}class is extends y.Widget{constructor(e,t=e.__("Enter credentials for remote repository"),s="",i=e.__("password / personal access token")){super(),this._trans=e,this._passwordPlaceholder=i,this.node.appendChild(this.createBody(t,s))}createBody(e,t){const s=document.createElement("div"),i=document.createElement("label"),a=document.createElement("label");this._checkboxCacheCredentials=document.createElement("input");const n=document.createElement("span");this._user=document.createElement("input"),this._user.type="text",this._password=document.createElement("input"),this._password.type="password";const r=document.createElement("span"),o=document.createElement("div");return s.className="jp-CredentialsBox",o.className="jp-CredentialsBox-warning",r.textContent=e,o.textContent=t,this._user.placeholder=this._trans.__("username"),this._password.placeholder=this._passwordPlaceholder,a.className="jp-CredentialsBox-label-checkbox",this._checkboxCacheCredentials.type="checkbox",n.textContent=this._trans.__("Save my login temporarily"),i.appendChild(r),i.appendChild(this._user),i.appendChild(this._password),s.appendChild(i),s.appendChild(o),a.appendChild(this._checkboxCacheCredentials),a.appendChild(n),s.appendChild(a),s}getValue(){return{username:this._user.value,password:this._password.value,cache_credentials:this._checkboxCacheCredentials.checked}}}class as extends y.Widget{constructor(e,t){super(),this.node.appendChild(this.createBody(e,t))}createBody(e,t){const s=document.createElement("div"),i=document.createElement("div");i.textContent=e;const a=document.createElement("label");this._checkbox=document.createElement("input"),this._checkbox.type="checkbox",this._checkbox.checked=!0;const n=document.createElement("span");return n.textContent=t,a.appendChild(this._checkbox),a.appendChild(n),s.appendChild(i),s.appendChild(a),s}getValue(){return{checked:this._checkbox.checked}}}var ns;function rs(e,t){return s=>{const{files:i}=s;return i.length>1?t:e}}function os(e,t,s){e.forEach((e=>{e===Se.gitFileDiff?t.addItem({command:e,args:{files:s.map((e=>({filePath:e.to,isText:!e.is_binary,status:e.status})))}}):t.addItem({command:e,args:{files:s}})}))}function ls(e,t,s,i,a){let n,r,o=null;function l(i){const a=i.isVisible,o=i.parentMenu,l=Array.from(t.selectedItems()),c=new Set(l.map((t=>{var i;const a=s.localPath(t.path);return null===e.pathRepository||null===(i=e.getFile(a))||void 0===i?void 0:i.status})).filter((e=>void 0!==e))),d=new Set([].concat(...[...c].map((e=>ft[e]))).filter((e=>e!==Se.gitFileOpen&&e!==Se.gitFileDelete&&void 0!==e)).map((e=>e===Se.gitFileStage||e===Se.gitFileTrack?Se.gitFileAdd:e))),h=!n||n.length!==d.size||!n.every((e=>d.has(e))),p=l.map((e=>e.path)),m=!r||!f.ArrayExt.shallowEqual(r,p);if(h||m){const t=[...d];i.clearItems(),os(t,i,(null!=p?p:[]).map((t=>e.getFile(t))).filter((e=>!["null","undefined"].includes(typeof e)))),a&&o.triggerActiveItem(),n=t,r=p}}function c(t){var s,i;if(o||(o=null!==(i=null===(s=t.menu.items.find((e=>{var t;return"submenu"===e.type&&"jp-contextmenu-git"===(null===(t=e.submenu)||void 0===t?void 0:t.id)})))||void 0===s?void 0:s.submenu)&&void 0!==i?i:null),!o)return;l(o);const a=e.status;e.refreshStatus().then((()=>{e.status!==a&&l(o)})).catch((e=>{console.error("Fail to refresh model when displaying git context menu.",e)}))}if(i.opened)i.opened.connect(c);else{class e extends y.Menu{onBeforeAttach(e){c(i),super.onBeforeAttach(e)}}const t='.jp-DirListing-item[data-isdir="false"]';o=new e({commands:i.menu.commands}),o.title.label=a.__("Git"),o.title.icon=R.bindprops({stylesheet:"menuItem"}),i.addItem({type:"submenu",submenu:o,selector:t,rank:5})}}async function cs(e,t,s,i,n,r=!1){var o,l,c;function d(e){var t;return(null!==(t=e.match(/https:\/\/([^.]+)\./))&&void 0!==t?t:[])[1]}try{let s;switch(t){case ns.Clone:const{path:t,url:a,versioning:r,submodules:o}=i;s=await e.clone(t,a,n,null==r||r,null!=o&&o);break;case ns.Pull:s=await e.pull(n);break;case ns.Push:s=await e.push(n,!1,i.remote);break;case ns.ForcePush:s=await e.push(n,!0,i.remote);break;case ns.Fetch:s=await e.fetch(n),e.credentialsRequired=!1;break;default:s={code:-1,message:"Unknown git command"}}return s.message}catch(n){if(Fe.some((e=>n.message.indexOf(e)>-1))){let n=s.__("password / personal access token"),h="";switch(t){case ns.Clone:const{url:t}=i;h=d(decodeURIComponent(t));break;case ns.Push:case ns.ForcePush:case ns.Pull:if(null===(o=e.currentBranch)||void 0===o?void 0:o.upstream){const t=e.currentBranch.upstream.split("/")[0],s=await async function(t){const s=(await e.getRemotes().then((e=>e))).find((e=>e.name===t));return s?null==s?void 0:s.url:""}(t);h=s?d(s):""}else h=d(null===(l=(await e.getRemotes().then((e=>e)))[0])||void 0===l?void 0:l.url);break;case ns.Fetch:h=await e.getRemotes().then((e=>{var t;return null===(t=e[0])||void 0===t?void 0:t.url}))}h&&"github"===h.toLowerCase()&&(n=s.__("personal access token"));const p=await(0,a.showDialog)({title:s.__("Git credentials required"),body:new is(s,s.__("Enter credentials for remote repository"),r?s.__("Incorrect username or password."):"",n)});if(p.button.accept)return await cs(e,t,s,i,null!==(c=p.value)&&void 0!==c?c:void 0,!0);throw new v}throw n}}!function(e){e.Clone="Clone",e.Pull="Pull",e.Push="Push",e.ForcePush="ForcePush",e.Fetch="Fetch"}(ns||(ns={}));class ds extends y.Widget{constructor(e){super({node:ds.createFormNode(e)})}getValue(){return{url:encodeURIComponent(this.node.querySelector("#input-link").value.trim()),versioning:Boolean(encodeURIComponent(this.node.querySelector("#download").checked)),submodules:Boolean(encodeURIComponent(this.node.querySelector("#submodules").checked))}}static createFormNode(e){const t=document.createElement("div"),s=document.createElement("div"),i=document.createElement("label"),a=document.createElement("input"),n=document.createElement("span"),r=document.createElement("div"),o=document.createElement("label"),l=document.createElement("input"),c=document.createElement("label"),d=document.createElement("input");return t.className="jp-CredentialsBox",s.className="jp-RedirectForm",r.className="jp-CredentialsBox-wrapper",o.className="jp-CredentialsBox-label-checkbox",c.className="jp-CredentialsBox-label-checkbox",l.id="submodules",d.id="download",a.id="input-link",n.textContent=e.__("Enter the URI of the remote Git repository"),a.placeholder="https://host.com/org/repo.git",o.textContent=e.__("Include submodules"),o.title=e.__("If checked, the remote submodules in the repository will be cloned recursively"),l.setAttribute("type","checkbox"),l.setAttribute("checked","checked"),c.textContent=e.__("Download the repository"),c.title=e.__("If checked, the remote repository default branch will be downloaded instead of cloned"),d.setAttribute("type","checkbox"),i.appendChild(n),i.appendChild(a),s.append(i),o.prepend(l),r.appendChild(o),c.prepend(d),r.appendChild(c),t.appendChild(s),t.appendChild(r),t}}const hs={id:"@jupyterlab/git:clone",requires:[Ee,o.IDefaultFileBrowser,a.IToolbarWidgetRegistry],optional:[a.ICommandPalette,p.ITranslator],activate:(e,t,s,i,n,r)=>{const o=(r=null!=r?r:p.nullTranslator).load("jupyterlab_git"),l=s.model;if(e.commands.addCommand(Re.gitClone,{label:o.__("Clone a Repository"),caption:o.__("Clone a repository from a URL"),isEnabled:()=>null===t.pathRepository,execute:async()=>{var s;const i=await(0,a.showDialog)({title:o.__("Clone a repo"),body:new ds(o),focusNodeSelector:"input",buttons:[a.Dialog.cancelButton({label:o.__("Cancel")}),a.Dialog.okButton({label:o.__("Clone")})]});if(i.button.accept&&(null===(s=i.value)||void 0===s?void 0:s.url)){const s=a.Notification.emit(o.__("Cloning"),"in-progress",{autoClose:!1});try{const n=await cs(t,ns.Clone,o,{path:e.serviceManager.contents.localPath(l.path),url:i.value.url,versioning:i.value.versioning,submodules:i.value.submodules});a.Notification.update({id:s,message:o.__("Successfully cloned"),type:"success",...ts(n,o)}),await l.refresh()}catch(e){throw console.error("Encountered an error when cloning the repository. Error: ",e),a.Notification.update({id:s,message:o.__("Failed to clone"),type:"error",...es(e,o)}),e}}}}),i.addFactory("FileBrowser","gitClone",(()=>a.ReactWidget.create(m.createElement(a.UseSignal,{signal:t.repositoryChanged,initialArgs:{name:"pathRepository",oldValue:null,newValue:t.pathRepository}},((t,s)=>m.createElement(a.ToolbarButtonComponent,{enabled:null===(null==s?void 0:s.newValue),icon:D,onClick:()=>{e.commands.execute(Re.gitClone)},tooltip:o.__("Git Clone")})))))),ls(t,s,e.serviceManager.contents,e.contextMenu,o),n){const e="Git Operations";n.addItem({command:Re.gitClone,category:e})}},autoStart:!0};var ps=s(4344),ms=s(8839),us=s(4332),gs=s(5609),_s=s(5408);const fs=(0,S.style)({overflow:"visible"}),bs=(0,S.style)({display:"flex",alignItems:"center"}),ys=(0,S.style)({color:"var(--jp-ui-font-color1)",fontWeight:"bold",backgroundColor:"var(--jp-diff-deleted-color0)",padding:"3px",paddingRight:"7px",flexGrow:1,maxWidth:"50%",overflow:"hidden"}),vs=(0,S.style)({color:"var(--jp-ui-font-color1)",fontWeight:"bold",backgroundColor:"var(--jp-diff-added-color0)",padding:"3px",paddingRight:"7px",flexGrow:1,maxWidth:"50%",overflow:"hidden"}),ws=(0,S.style)({borderTop:"1px solid var(--jp-border-color2)",color:"var(--jp-ui-font-color1)"}),Cs=(0,S.style)({minHeight:"15px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color3)!important",borderRight:"var(--jp-border-width) solid var(--jp-border-color3)!important",$nest:{span:{textTransform:"none"}}}),xs=(0,S.style)({height:"2px!important",top:"0!important",bottom:"unset!important",backgroundColor:"var(--jp-brand-color1)!important",transition:"none!important"}),Es=(0,S.style)({display:"flex",alignItems:"center",justifyContent:"space-evenly",gap:"5px",padding:"0px 8px!important",overflow:"scroll"}),ks=(0,S.style)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"5px",color:"var(--jp-ui-font-color2)"}),Ss=(0,S.style)({backgroundImage:"repeating-linear-gradient(-45deg, var(--jp-diff-deleted-color1), var(--jp-diff-deleted-color1) 3px, transparent 3px, transparent 10px)"}),Rs=(0,S.style)({backgroundImage:"repeating-linear-gradient(-45deg, var(--jp-diff-added-color1), var(--jp-diff-added-color1) 3px, transparent 3px, transparent 10px)"}),Fs=(0,S.style)({width:"auto",maxHeight:"500px!important",border:"5px solid var(--jp-diff-deleted-color0)",maxWidth:"400px!important"}),Ns=(0,S.style)({width:"auto",maxHeight:"500px",border:"5px solid var(--jp-diff-added-color0)",maxWidth:"400px"}),Ds=(0,S.style)({padding:"5px 0",margin:"0px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"}),js=(0,S.style)({color:"var(--jp-diff-deleted-color0)"}),Ps=(0,S.style)({color:"var(--jp-diff-added-color0)"}),Bs=(0,S.style)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",overflowX:"scroll",padding:"0px 40px"}),Is=(0,S.style)({position:"relative",width:"100%",height:"510px",display:"flex",alignItems:"center",justifyContent:"center"}),As=(0,S.style)({position:"absolute",top:0,bottom:0,left:0,right:0,opacity:1,margin:"auto",height:"500px",width:"auto",maxWidth:"800px",objectFit:"scale-down"}),Ts=(0,S.style)({border:"5px solid var(--jp-diff-deleted-color0)"}),Ls=(0,S.style)({border:"5px solid var(--jp-diff-added-color0)"}),Ms=(0,S.style)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",overflow:"scroll",padding:"0px 10px"}),Hs=(0,S.style)({position:"relative",height:"510px",width:"100%"}),$s=(0,S.style)({width:"auto",height:"500px",position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",maxWidth:"800px",objectFit:"scale-down",backgroundColor:"var(--jp-layout-color0)"}),Os=(0,S.style)({opacity:1,border:"5px solid var(--jp-diff-deleted-color0)"}),zs=(0,S.style)({opacity:0,border:"5px solid var(--jp-diff-added-color0)"}),Us=async({model:e,toolbar:t,translator:s})=>{const i=new Qs(e,(null!=s?s:p.nullTranslator).load("jupyterlab_git"));return await i.ready,i},Ws=["2-up","Swipe","Onion Skin"],Gs=["png","jpeg","jpg"],Vs=e=>{const t=.75*e.length;return(0,_s.filesize)(t)},qs=({reference:e,referenceLabel:t,challenger:s,challengerLabel:i,mode:a,trans:n,fileType:r})=>{const[o,l]=(0,m.useState)(a||"2-up"),c=(0,m.useCallback)(((e,t)=>{l(Ws[t])}),[o]),d=(e=>({"2-up":Ks,Swipe:Zs,"Onion Skin":Js}[e]))(o);return m.createElement("div",null,m.createElement("div",{className:bs},m.createElement("span",{className:ys},t),m.createElement("span",{className:vs},i)),m.createElement(gs.A,{classes:{root:ws,indicator:xs},value:Ws.indexOf(o),onChange:c,variant:"fullWidth"},m.createElement(us.A,{classes:{root:Cs},title:n.__("View Image Diff in 2-up Mode"),label:n.__("2-up"),disableFocusRipple:!0,disableRipple:!0}),m.createElement(us.A,{classes:{root:Cs},title:n.__("View Image Diff in Swipe Mode"),label:n.__("Swipe"),disableFocusRipple:!0,disableRipple:!0}),m.createElement(us.A,{classes:{root:Cs},title:n.__("View Image Diff in Onion Skin Mode"),label:n.__("Onion Skin"),disableFocusRipple:!0,disableRipple:!0})),m.createElement(d,{reference:e,challenger:s,fileType:r}))},Ks=({reference:e,challenger:t,fileType:s})=>{const[i,a]=(0,m.useState)([100,100]),[n,r]=(0,m.useState)([100,100]),[o,l]=(0,m.useState)([100,100]);return(0,m.useEffect)((()=>{e||a([...n])}),[n]),(0,m.useEffect)((()=>{t||r([...i])}),[i]),m.createElement("div",{className:Es},m.createElement("div",{className:ks},m.createElement("img",{className:`${Fs} ${e?"":Ss}`,src:`data:image/${s};base64,${e}`,alt:"Reference",onLoad:e=>{let t=e.currentTarget.naturalWidth,s=e.currentTarget.naturalHeight;a([t,s]),t=Math.min(e.currentTarget.width,400),s=Math.min(e.currentTarget.height,400),l([t,s])},style:e?{}:{width:`${o[0]}px`,height:`${o[1]}px`}}),m.createElement("label",{htmlFor:Fs},`W: ${i[0]}px | H: ${i[1]}px | ${Vs(e)}`)),m.createElement("div",{className:ks},m.createElement("img",{className:`${Ns} ${t?"":Rs}`,src:`data:image/${s};base64,${t}`,alt:"challenger",onLoad:e=>{let t=e.currentTarget.naturalWidth,s=e.currentTarget.naturalHeight;r([t,s]),t=Math.min(e.currentTarget.width,400),s=Math.min(e.currentTarget.height,400),l([t,s])},style:t?{}:{width:`${o[0]}px`,height:`${o[1]}px`}}),m.createElement("label",{htmlFor:Ns},`W: ${n[0]}px | H: ${n[1]}px | ${Vs(t)}`)))},Xs=(0,ms.Ay)(ps.Ay)({color:"var(--jp-brand-color1)","& .MuiSlider-thumb":{backgroundColor:"var(--jp-brand-color1)"}}),Ys=({value:e,onChange:t,width:s,reversed:i})=>{const a=i?[Ps,js]:[js,Ps];return m.createElement("div",{className:Ds},m.createElement("span",{className:a[0]},""),m.createElement(Xs,{style:{width:`${s+10}px`},value:e,onChange:t}),m.createElement("span",{className:a[1]},""))},Zs=({reference:e,challenger:t,fileType:s})=>{const[i,a]=(0,m.useState)(50),[n,r]=(0,m.useState)(0),o=(0,m.useRef)(null),l=(0,m.useRef)(null);return(0,m.useLayoutEffect)((()=>{const s=e?o.current.offsetWidth:0,i=t?l.current.offsetWidth:0;r(Math.max(s,i)-10)}),[]),m.createElement("div",{className:Bs},m.createElement(Ys,{value:i,onChange:(e,t)=>{"number"==typeof t&&a(t)},width:n,reversed:!0}),m.createElement("div",{className:Is},m.createElement("img",{ref:o,src:`data:image/${s};base64,${e}`,className:`${As} ${Ts} ${e?"":Ss}`,style:{clipPath:`polygon(0 0, ${i-.1}% 0, ${i-.1}% 100%, 0% 100%)`,width:n?`${n}px`:""},alt:"Reference"}),m.createElement("img",{ref:l,src:`data:image/${s};base64,${t}`,className:`${As} ${Ls} ${t?"":Rs}`,style:{clipPath:`polygon(${i+.1}% 0, 100% 0, 100% 100%, ${i+.1}% 100%)`,width:n?`${n}px`:""},alt:"Challenger"})))},Js=({reference:e,challenger:t,fileType:s})=>{const[i,a]=(0,m.useState)(50),[n,r]=(0,m.useState)(40),o=(0,m.useRef)(null),l=(0,m.useRef)(null);return(0,m.useLayoutEffect)((()=>{const s=e?o.current.offsetWidth:40,i=t?l.current.offsetWidth:40;r(Math.max(s,i)-10)}),[]),m.createElement("div",{className:Ms},m.createElement(Ys,{value:i,onChange:(e,t)=>{"number"==typeof t&&a(t)},width:n}),m.createElement("div",{className:Hs},m.createElement("img",{src:`data:image/${s};base64,${e}`,alt:"Reference",className:`${$s} ${Os} ${e?"":Ss}`,style:e?{}:{width:`${n}px`},ref:o}),m.createElement("img",{src:`data:image/${s};base64,${t}`,alt:"Challenger",className:`${$s} ${zs} ${t?"":Rs}`,style:{opacity:i/100},ref:l})))};class Qs extends y.Panel{constructor(e,t){super(),this.addClass("jp-git-image-diff");const s=new b.PromiseDelegate;this._container=this.node,this._isReady=s.promise,this._model=e,this._trans=null!=t?t:p.nullTranslator.load("jupyterlab_git"),this.refresh().then((()=>{s.resolve()})).catch((e=>{console.error(this._trans.__("Failed to refresh Image diff."),e,null==e?void 0:e.traceback)}))}get model(){return this._model}get ready(){return this._isReady}get isFileResolved(){return!0}async getResolvedFile(){return{}}async refresh(){try{const t=this._model.reference.label,s=this._model.challenger.label,[i,n]=await Promise.all([this._model.reference.content(),this._model.challenger.content()]),r=(e=this._model.filename).substring(e.lastIndexOf(".")+1,e.length)||e;if(!Gs.includes(r))throw Error(`Image file format ${r} not supported. Only ${Gs} file extensions are supported' by the image diff view.`);const o=a.ReactWidget.create(m.createElement(qs,{reference:i,referenceLabel:t,challenger:n,challengerLabel:s,mode:"2-up",trans:this._trans,fileType:r}));this.addClass(fs),this.addWidget(o)}catch(e){this.showError(e)}var e}showError(e){for(console.error(this._trans.__("Failed to load file diff."),e,null==e?void 0:e.traceback);this.widgets.length>0;)this.widgets[0].dispose();const t=(e.message||e).replace("\n","<br />");this.node.innerHTML=`<p style="color: unset" class="jp-git-diff-error">\n      <span>${this._trans.__("Error Loading Image Diff:")}</span>\n      <span class="jp-git-diff-error-message">${t}</span>\n    </p>`}}var ei=s(1347),ti=s(3542),si=s(3151),ii=s(7788),ai=s(2899);const ni="jp-mod-hideUnchanged";class ri extends y.Panel{constructor(e,t,s){super(),this._areUnchangedCellsHidden=!1,this._lastSerializeModel=null;const i=new b.PromiseDelegate;this._isReady=i.promise,this._model=e,this._renderMime=t,this._trans=null!=s?s:p.nullTranslator.load("jupyterlab_git"),this.addClass("nbdime-Widget"),this.refresh().then((()=>{i.resolve()})).catch((e=>{console.error(this._trans.__("Failed to refresh Notebook diff."),e,null==e?void 0:e.traceback)}))}get areUnchangedCellsHidden(){return this._areUnchangedCellsHidden}set areUnchangedCellsHidden(e){this._areUnchangedCellsHidden!==e&&(oi.toggleShowUnchanged(this._scroller,this._hasConflict,this._areUnchangedCellsHidden),this._areUnchangedCellsHidden=e)}get _hasConflict(){var e;return null!==(e=this._model.hasConflict)&&void 0!==e&&e}get model(){return this._model}get nbdimeWidget(){return this._nbdWidget}get ready(){return this._isReady}get isFileResolved(){const e=this.nbdimeWidget;this._lastSerializeModel=e.model.serialize();const t=e.validateMerged(this._lastSerializeModel);return JSON.stringify(this._lastSerializeModel)===JSON.stringify(t)}async getResolvedFile(){var e;return Promise.resolve({format:"json",type:"notebook",content:null!==(e=this._lastSerializeModel)&&void 0!==e?e:this.nbdimeWidget.model.serialize()})}async refresh(){var e,t;if(!(null===(e=this._scroller)||void 0===e?void 0:e.parent)){for(;this.widgets.length>0;)this.widgets[0].dispose();const e=oi.diffHeader(this._model.reference.label,this._model.challenger.label,this._hasConflict,this._trans.__("Common Ancestor"));this.addWidget(e),this._scroller=new y.Panel,this._scroller.addClass("nbdime-root"),this._scroller.node.tabIndex=-1,this.addWidget(this._scroller)}try{const e=await this._model.reference.content(),s=await this._model.challenger.content(),i=await(null===(t=this._model.base)||void 0===t?void 0:t.content()),a=i?this.createMergeView.bind(this):this.createDiffView.bind(this);for(this._nbdWidget=await a(s,e,null!=i?i:"");this._scroller.widgets.length>0;)this._scroller.widgets[0].dispose();this._scroller.addWidget(this._nbdWidget);try{await this._nbdWidget.init(),oi.markUnchangedRanges(this._scroller.node,this._hasConflict)}catch(e){console.debug(this._trans.__("Failed to init notebook diff view: %1",e)),oi.markUnchangedRanges(this._scroller.node,this._hasConflict)}}catch(e){this.showError(e)}}async createDiffView(e,t){const s=await Ne("diffnotebook","POST",{currentContent:e,previousContent:t}),i=new qt.Uv(s.base,s.diff);return new ei.Zx({model:i,rendermime:this._renderMime})}async createMergeView(e,t,s){const i=await Ne("diffnotebook","POST",{currentContent:e,previousContent:t,baseContent:s}),a=new si.zd(i.base,i.merge_decisions);return new ii.gV({model:a,rendermime:this._renderMime})}onActivateRequest(e){var t;(null===(t=this._scroller)||void 0===t?void 0:t.parent)&&this._scroller.node.focus()}showError(e){for(console.error(this._trans.__("Failed to load file diff."),e,null==e?void 0:e.traceback);this.widgets.length>0;)this.widgets[0].dispose();const t=(e.message||e).replace("\n","<br />");this.node.innerHTML=`<p class="jp-git-diff-error">\n      <span>${this._trans.__("Error Loading Notebook Diff:")}</span>\n      <span class="jp-git-diff-error-message">${t}</span>\n    </p>`}}var oi;!function(e){function t(e){if(!e.parentElement||!e.parentElement.parentElement)return e;const t=e.parentElement.parentElement;return t.classList.contains(ti.ii)?t:e}function s(e,s){var i;const a=s?ii.iK:ei.Pp,n=s?ai.av:ti.PQ,r=s?".jp-Notebook-merge":".jp-Notebook-diff",o=e.querySelectorAll(`.${a}`);let l=-1;for(let e=0;e<o.length;++e){const s=o[e];if(s.classList.contains(n))-1===l&&(l=e);else if(-1!==l){const i=e-l;t(s).setAttribute("data-nbdime-NCellsHiddenBefore",i.toString()),l=-1}}if(-1!==l){const s=o.length-l;if(0===l)return void(null!==(i=e.querySelector(r))&&void 0!==i?i:e).setAttribute("data-nbdime-AllCellsHidden",s.toString());t(o[l-1]).setAttribute("data-nbdime-NCellsHiddenAfter",s.toString())}}e.diffHeader=function(e,t,s,i){const a=s?"jp-git-merge-banner":"jp-git-diff-banner",n=document.createElement("div");return n.className="jp-git-diff-header",n.innerHTML=`<div class="${a}">\n        <span>${e}</span>\n        ${s?`<span>${i}</span>`:""}\n        <span>${t}</span>\n      </div>`,new y.Widget({node:n})},e.toggleShowUnchanged=function(e,t,i){const a=e.hasClass(ni);if(void 0===i)i=a;else if(a!==i)return;i?e.removeClass(ni):(s(e.node,t),e.addClass(ni)),e.update()},e.markUnchangedRanges=s}(oi||(oi={}));var li=s(1378);const ci=(0,S.keyframes)({to:{fillOpacity:1}}),di=(0,S.style)({$nest:{"& .jp-icon3":{animationName:ci,animationDuration:"1s"}}}),hi=(0,S.keyframes)({"0%":{fillOpacity:1},"50%":{fillOpacity:.6},"100%":{fillOpacity:1}}),pi=(0,S.style)({$nest:{"& .jp-icon3":{animationName:hi,animationDuration:"2s",animationIterationCount:"infinite"}}}),mi=(0,S.style)({$nest:{"& > .MuiBadge-badge":{top:6,right:15,backgroundColor:"var(--jp-warn-color1)"}}}),ui=(0,S.style)({fontSize:"var(--jp-ui-font-size1)",lineHeight:"100%"}),gi=(0,S.style)({display:"flex",flexDirection:"column",backgroundColor:"var(--jp-layout-color1)"}),_i=(0,S.style)({display:"flex",flexDirection:"row",flexWrap:"wrap",minHeight:"35px",lineHeight:"var(--jp-private-running-item-height)",backgroundColor:"var(--jp-layout-color1)",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),fi=(0,S.style)({background:"var(--jp-layout-color1)"}),bi=(0,S.style)({boxSizing:"border-box",display:"flex",flexDirection:"row",flexWrap:"wrap",width:"100%",minHeight:"50px",padding:"4px 11px 4px 11px",fontSize:"var(--jp-ui-font-size1)",lineHeight:"1.5em",color:"var(--jp-ui-font-color1)",textAlign:"left",border:"none",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:0,background:"var(--jp-layout-color1)"}),yi=(0,S.style)({$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"},"&:active":{backgroundColor:"var(--jp-layout-color3)"}}}),vi=(0,S.style)({width:"16px",height:"16px",margin:"auto 8px auto 0"}),wi=(0,S.style)({flexBasis:0,flexGrow:1,marginTop:"auto",marginBottom:"auto",marginRight:"auto",$nest:{"& > p":{marginTop:0,marginBottom:0}}}),Ci=(0,S.style)({}),xi=(0,S.style)({marginBottom:"auto",fontWeight:700}),Ei=(0,S.style)({boxSizing:"border-box",height:"24px",width:"var(--jp-private-running-button-width) !important",margin:"auto 0 auto 0",padding:"0px 6px !important",$nest:{"& span":{margin:"auto",width:"16px"}}}),ki=(0,S.style)({flex:"1 1 auto"}),Si=(0,S.style)({$nest:{"& > .MuiBadge-badge":{top:12,right:5,backgroundColor:"var(--jp-warn-color1)"}}});class Ri extends a.ReactWidget{constructor(e,t){super(),this._locked=!1,this._status="",this._model=e,this._trans=t,this.addClass("jp-git-StatusWidget")}set status(e){this._status=e,this._locked||this._animate()}render(){return u().createElement(u().Fragment,null,u().createElement(a.UseSignal,{signal:this._model.credentialsRequiredChanged,initialArgs:!1},((e,t)=>u().createElement(li.A,{className:mi,variant:"dot",invisible:!t,"data-test-id":"git-credential-badge"},u().createElement(We,{className:(0,S.classes)(Ei,"idle"!==this._status?pi:di),icon:R,onClick:t?async()=>this._showGitOperationDialog():void 0,title:t?`Git: ${this._trans.__("credentials required")}`:`Git: ${this._trans.__(this._status)}`})))),u().createElement(a.UseSignal,{signal:this._model.headChanged},(()=>this._model.currentBranch&&u().createElement("span",{className:ui},this._model.currentBranch.name))))}async _showGitOperationDialog(){try{await cs(this._model,ns.Fetch,this._trans)}catch(e){console.error("Encountered an error when fetching. Error:",e)}}async _animate(){this._locked=!0,this.update(),await new Promise((e=>setTimeout(e,500))),this._locked=!1,this.update()}}var Fi;!function(e){e.createEventCallback=function(e){return function(t,s){let i;switch(s){case"empty":i="idle";break;case"git:checkout":i="checking out";break;case"git:clone":i="cloning repository";break;case"git:commit:create":i="committing changes";break;case"git:commit:revert":i="reverting changes";break;case"git:init":i="initializing repository";break;case"git:merge":i="merging";break;case"git:pull":i="pulling changes";break;case"git:pushing":i="pushing changes";break;case"git:rebase":i="rebasing";break;case"git:rebase:resolve":i="resolving rebase";break;case"git:refresh":i="refreshing";break;case"git:reset:changes":i="resetting changes";break;case"git:reset:hard":i="discarding changes";break;default:i=/git:add:files/.test(s)?"adding files":"working"}e.status=i}},e.isStatusWidgetActive=function(e){return e?function(){var t;return null===(t=null==e?void 0:e.composite.displayStatus)||void 0===t||t}:function(){return!1}}}(Fi||(Fi={}));var Ni=s(6624);const Di=(0,S.style)({display:"flex",flexDirection:"column",height:"100%",overflowY:"auto"}),ji=(0,S.style)({fontSize:"var(--jp-ui-font-size1)",lineHeight:"var(--jp-content-line-height)",margin:"13px 11px 4px 11px",textAlign:"left"}),Pi=(0,S.style)({alignSelf:"center",boxSizing:"border-box",height:"28px",width:"200px",marginTop:"5px",border:"0",borderRadius:"3px",color:"white",fontSize:"var(--jp-ui-font-size1)",backgroundColor:"var(--md-blue-500)",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"}}}),Bi=(0,S.style)({minHeight:"36px!important",$nest:{"button:last-of-type":{borderRight:"none"}}}),Ii=(0,S.style)({width:"50%",minWidth:"0!important",maxWidth:"50%!important",minHeight:"36px!important",color:"var(--jp-ui-font-color1)!important",backgroundColor:"var(--jp-layout-color2)!important",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)!important",borderRight:"var(--jp-border-width) solid var(--jp-border-color2)!important",textTransform:"none !important"}),Ai=(0,S.style)({backgroundColor:"var(--jp-layout-color1)!important"}),Ti=(0,S.style)({height:"3px!important",backgroundColor:"var(--jp-brand-color1)!important",transition:"none!important"});class Li extends y.Widget{constructor({author:e,trans:t}){super(),this._populateForm(e,t)}_populateForm(e,t){null!=t||(t=p.nullTranslator.load("jupyterlab_git"));const s=document.createElement("label");s.textContent=t.__("Committer name:");const i=document.createElement("label");i.textContent=t.__("Committer email:"),this._name=s.appendChild(document.createElement("input")),this._email=i.appendChild(document.createElement("input")),this._name.placeholder="Name",this._email.type="text",this._email.placeholder="Email",this._email.type="email",this._name.value=e.name,this._email.value=e.email,this.node.appendChild(s),this.node.appendChild(i)}getValue(){return{name:this._name.value,email:this._email.value}}}var Mi=s(6167),Hi=s(3972),$i=s(5445),Oi=s(4475),zi=s(7467),Ui=s(4724),Wi=s(1207),Gi=s(8026),Vi=s(3189);const qi=(0,S.style)({flex:"1 1 auto",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}),Ki=(0,S.style)({marginTop:"6px",marginBottom:"0",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),Xi=(0,S.style)({padding:"4px 11px 4px",display:"flex"}),Yi=(0,S.style)({flex:"1 1 auto",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"var(--jp-ui-font-size1)"}),Zi=(0,S.style)({boxSizing:"border-box",width:"100%",height:"2em",padding:"1px 18px 2px 7px",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),Ji=(0,S.style)({position:"absolute",right:"5px",top:"0.6em",height:"1.1em",width:"1.1em",padding:0,backgroundColor:"var(--jp-inverse-layout-color4)",border:"none",borderRadius:"50%",$nest:{svg:{width:"0.5em!important",height:"0.5em!important",fill:"var(--jp-ui-inverse-font-color0)"},"&:hover":{backgroundColor:"var(--jp-inverse-layout-color3)"},"&:active":{backgroundColor:"var(--jp-inverse-layout-color2)"}}}),Qi=(0,S.style)({boxSizing:"border-box",width:"7.7em",height:"2em",flex:"0 0 auto",marginLeft:"5px",color:"white",fontSize:"var(--jp-ui-font-size1)",backgroundColor:"var(--md-blue-500)",border:"0",borderRadius:"3px",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"}}}),ea=(0,S.style)({padding:"4px 11px!important",userSelect:"none"},ze),ta=(0,S.style)({color:"white!important",backgroundColor:"var(--jp-brand-color1)!important",$nest:{"& .jp-icon-selectable[fill]":{fill:"white"}}}),sa=(0,S.style)({width:"16px",height:"16px",marginRight:"4px"}),ia=(0,S.style)({display:"flex",flexWrap:"wrap",marginTop:"auto",padding:"8px",paddingTop:"1em",alignItems:"flex-start",backgroundColor:"var(--jp-layout-color1)",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),aa=(0,S.style)({marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px"}),na=(0,S.style)({fontWeight:"bold",marginBottom:"0.5em",color:"var(--jp-warn-color1)",padding:0}),ra=(0,S.style)({color:"var(--jp-warn-color1)",padding:0,$nest:{"&:last-child":{paddingBottom:0}}}),oa=(0,S.style)({height:"2em",marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&.Mui-error":{border:"calc(2 * var(--jp-border-width)) solid var(--jp-error-color1)"}}}),la=(0,S.style)({marginBottom:"1em",padding:"var(--jp-code-padding) !important",outline:"none",overflowX:"auto",resize:"none",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&>*::placeholder":{color:"var(--jp-ui-font-color3)"},"&>*::-webkit-input-placeholder":{color:"var(--jp-ui-font-color3)"},"&>*::-moz-placeholder":{color:"var(--jp-ui-font-color3)"},"&>*::-ms-input-placeholder":{color:"var(--jp-ui-font-color3)"}}}),ca=(0,S.style)({color:"var(--jp-ui-inverse-font-color1) !important",backgroundColor:"var(--jp-brand-color1) !important",$nest:{"&:hover":{backgroundColor:"var(--jp-brand-color2) !important"}}}),da=(0,S.style)({flex:"0 0 20px",lineHeight:"initial !important",$nest:{"& span":{lineHeight:"0"},"& .jp-icon3[fill]":{fill:"var(--jp-ui-inverse-font-color1)"}}}),ha=((0,S.style)({width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"}),(0,S.style)({maxWidth:"250px"})),pa=((0,S.style)({fontSize:"var(--jp-ui-font-size1)",whiteSpace:"break-spaces"}),(0,S.style)({color:"var(--jp-ui-font-color1) !important",fontSize:"var(--jp-ui-font-size1) !important",fontFamily:"var(--jp-ui-font-family) !important",backgroundColor:"var(--jp-layout-color1) !important"})),ma=(0,S.style)({outline:"none",border:"var(--jp-border-width) solid var(--jp-brand-color1)"}),ua=(0,S.style)({cursor:"not-allowed !important",color:"var(--jp-ui-font-color2) !important",backgroundColor:"var(--jp-layout-color3) !important",pointerEvents:"auto !important"});var ga=s(4901);function _a(e){var t,s,i,a;const n=null!==(t=e.summaryPlaceholder)&&void 0!==t?t:e.trans.__("Summary");return m.createElement(m.Fragment,null,m.createElement(ga.A,{classes:{root:(0,S.classes)(pa,oa),focused:ma,disabled:ua},error:e.error,type:"text",placeholder:n,title:e.disabled?e.trans.__("Amending the commit will re-use the previous commit summary"):e.trans.__("Enter a commit message summary (a single line, preferably less than 50 characters)"),value:e.summary,onChange:function(t){e.setSummary(t.target.value)},onKeyPress:function(e){"Enter"===e.key&&e.preventDefault()},disabled:null!==(s=e.disabled)&&void 0!==s&&s,disableUnderline:!0,fullWidth:!0}),m.createElement(ga.A,{classes:{root:(0,S.classes)(pa,la),focused:ma,disabled:ua},multiline:!0,minRows:5,maxRows:10,placeholder:null!==(i=e.descriptionPlaceholder)&&void 0!==i?i:e.trans.__("Description (optional)"),title:e.disabled?e.trans.__("Amending the commit will re-use the previous commit summary"):e.trans.__("Enter a commit message description"),value:e.description,onChange:function(t){e.setDescription(t.target.value)},disabled:null!==(a=e.disabled)&&void 0!==a&&a,disableUnderline:!0,fullWidth:!0}))}class fa extends m.Component{constructor(e){super(e),this._getSubmitKeystroke=()=>{var e;const t=this.props.commands.keyBindings.find((e=>e.command===Re.gitSubmitCommand));return null!==(e=null==t?void 0:t.keys.join(" "))&&void 0!==e?e:""},this._handleClose=e=>{this._anchorRef.current&&this._anchorRef.current.contains(e.target)||this.setState({open:!1})},this._handleMenuItemClick=(e,t)=>{this.setState({open:!1}),this.props.setAmend(1===t)},this._handleToggle=()=>{this.setState({open:!this.state.open})},this._handleCommand=(e,t)=>{t.id===Re.gitSubmitCommand&&this._canCommit()&&this.props.onCommit()},this._options=[],this._options.push({title:this.props.trans.__("Create a new commit"),description:this.props.trans.__("New commit will be created and show up as a next one after the previous commit (default).")},{title:this.props.trans.__("Amend previous commit"),description:this.props.trans.__("Staged changes will be added to the previous commit and its date will be updated.")}),this._anchorRef=m.createRef(),this.state={open:!1}}componentDidMount(){this.props.commands.commandExecuted.connect(this._handleCommand)}componentWillUnmount(){this.props.commands.commandExecuted.disconnect(this._handleCommand)}render(){var e;const t=!this._canCommit(),s=this.props.hasFiles?this.props.summary||this.props.amend?this.props.label:this.props.trans.__("Disabled: No commit message summary"):this.props.trans.__("Disabled: No files are staged for commit"),i=Mi.CommandRegistry.formatKeystroke(this._getSubmitKeystroke()),a=this.props.trans.__("Summary (%1 to commit)",i);return m.createElement("div",{className:(0,S.classes)(ia,"jp-git-CommitBox")},null!==(e=this.props.warning)&&void 0!==e?e:null,!this.props.amend&&m.createElement(_a,{error:this.props.hasFiles&&!this.props.amend&&0===this.props.summary.length,trans:this.props.trans,summary:this.props.summary,summaryPlaceholder:a,description:this.props.description,setSummary:this.props.setSummary,setDescription:this.props.setDescription}),m.createElement($i.A,{ref:this._anchorRef,fullWidth:!0,size:"small"},m.createElement(Hi.A,{classes:{root:ca,disabled:ua},title:s,disabled:t,onClick:this.props.onCommit},this.props.label),m.createElement(Hi.A,{classes:{root:(0,S.classes)(ca,da)},size:"small","aria-controls":this.state.open?"split-button-menu":void 0,"aria-expanded":this.state.open?"true":void 0,"aria-label":"select commit variant","aria-haspopup":"menu",onClick:this._handleToggle},m.createElement(q.react,{tag:"span"}))),m.createElement(Vi.A,{open:this.state.open,anchorEl:this._anchorRef.current,role:void 0,transition:!0,disablePortal:!0},(({TransitionProps:e})=>m.createElement(zi.A,{...e},m.createElement(Gi.A,{classes:{root:(0,S.classes)(pa,ha)}},m.createElement(Oi.x,{onClickAway:this._handleClose},m.createElement(Wi.A,{id:"split-button-menu"},this._options.map(((e,t)=>m.createElement(Ui.A,{key:e.title,classes:{root:pa},selected:this.props.amend?1===t:0===t,onClick:e=>this._handleMenuItemClick(e,t)},(this.props.amend?1===t:0===t)?m.createElement(_.checkIcon.react,{className:sa,tag:"span"}):m.createElement("span",{className:sa}),m.createElement("div",{className:oe},m.createElement("p",{className:he},e.title),m.createElement("p",{className:le},e.description))))))))))))}_canCommit(){return this.props.amend?this.props.hasFiles:!(!this.props.hasFiles||!this.props.summary)}}const ba=(0,S.style)({flex:"0 0 auto",display:"flex",flexDirection:"column",marginBlockStart:0,marginBlockEnd:0,paddingLeft:0,overflowY:"auto",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),ya=(0,S.style)({paddingLeft:10}),va=(0,S.style)({flex:"0 0 auto",width:"100%",fontSize:"12px",marginBottom:"10px",marginTop:"5px",paddingTop:"5px"}),wa=(0,S.style)({fontSize:"13px",fontWeight:"bold",paddingTop:"5px",$nest:{"& span":{alignItems:"center",display:"inline-flex",marginLeft:"5px"},"& span:nth-of-type(1)":{marginLeft:"0px"}}}),Ca=(0,S.style)({flex:"1 1 auto",margin:"0"}),xa=(0,S.style)({paddingBottom:"0.5em",fontSize:"13px",fontWeight:"bold"}),Ea=(0,S.style)({userSelect:"none",display:"flex",flexDirection:"row",alignItems:"center",color:"var(--jp-ui-font-color1)",height:"var(--jp-private-running-item-height)",lineHeight:"var(--jp-private-running-item-height)",whiteSpace:"nowrap",overflow:"hidden",$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"},"&:active":{backgroundColor:"var(--jp-layout-color3)"}}}),ka=(0,S.style)({display:"inline-block",width:"13px",height:"13px",right:"10px"}),Sa=(0,S.style)({$nest:{".jp-icon3":{fill:"var(--md-green-500)"}}}),Ra=(0,S.style)({$nest:{".jp-icon3":{fill:"var(--md-red-500)"}}}),Fa=(0,S.style)({$nest:{ul:{paddingLeft:0,margin:0}}}),Na=(0,S.style)({float:"right"}),Da=(0,S.style)({paddingTop:"5px",whiteSpace:"pre-wrap",wordWrap:"break-word",margin:"0"});class ja extends m.PureComponent{constructor(){super(...arguments),this._renderFile=e=>{const{data:t,index:s,style:i}=e,a=t[s],n=a.modified_file_path,r=a.previous_file_path,o=!!Te(n)||!a.is_binary;return m.createElement("li",{className:Ea,onClick:this.props.onOpenDiff(n,o,r),style:i,title:n},m.createElement(nt,{filepath:n,filetype:a.type}),o?m.createElement(We,{icon:I,title:this.props.trans.__("View file changes")}):null)}}render(){var e;return m.createElement("div",{className:this.props.className},m.createElement("div",{className:va},m.createElement("div",{className:wa},m.createElement("span",{title:this.props.trans.__("# Files Changed")},m.createElement(_.fileIcon.react,{className:ka,tag:"span"}),this.props.numFiles),m.createElement("span",{title:this.props.trans.__("# Insertions")},m.createElement(T.react,{className:(0,S.classes)(ka,Sa),tag:"span"}),this.props.insertions),m.createElement("span",{title:this.props.trans.__("# Deletions")},m.createElement(P.react,{className:(0,S.classes)(ka,Ra),tag:"span"}),this.props.deletions))),m.createElement("div",{className:Ca},m.createElement("div",{className:xa},this.props.trans.__("Changed"),null!==(e=this.props.actions)&&void 0!==e?e:null),this.props.files.length>0&&m.createElement(k.FixedSizeList,{className:Fa,height:24*Math.min(5,this.props.files.length),innerElementType:"ul",itemCount:this.props.files.length,itemData:this.props.files,itemKey:(e,t)=>t[e].modified_file_path,itemSize:24,style:{overflowX:"hidden"},width:"auto"},this._renderFile)))}}function Pa(e){var t;const[s,i]=m.useState(!1),[n,r]=m.useState([]),{referenceCommit:o,challengerCommit:l,model:c}=e,d=null!==o&&null!==l,h=n.reduce(((e,t)=>{const s=Number.parseInt(t.insertion,10);return e+(Number.isNaN(s)?0:s)}),0),p=n.reduce(((e,t)=>{const s=Number.parseInt(t.deletion,10);return e+(Number.isNaN(s)?0:s)}),0);return m.useEffect((()=>{(async()=>{var t;if(null===o||null===l)return void r([]);let s=null;try{if(s=await c.diff(o.commit,l.commit),0!==s.code)throw new Error(s.message)}catch(t){const s=`Failed to get the diff for ${o.commit} and ${l.commit}.`;return console.error(s,t),void a.Notification.error(s,es(t,e.trans))}r(s?(null!==(t=s.result)&&void 0!==t?t:[]).map((e=>{const t=e.filename.split("/"),s=t[t.length-1],i=e.filename;return{deletion:e.deletions,insertion:e.insertions,is_binary:"-"===e.deletions||"-"===e.insertions,modified_file_name:s,modified_file_path:i,type:e.filetype}})):[])})()}),[o,l]),m.createElement("div",{className:ba},m.createElement("div",{className:ct,onClick:()=>i(!s)},m.createElement("button",{className:mt},s?m.createElement(_.caretRightIcon.react,{tag:"span"}):m.createElement(_.caretDownIcon.react,{tag:"span"})),m.createElement("span",{className:ht},e.header),m.createElement(We,{title:e.trans.__("Close"),icon:_.closeIcon,onClick:t=>{e.onClose(t)}})),!s&&(n.length?m.createElement(ja,{className:ya,deletions:`${p}`,files:n,insertions:`${h}`,numFiles:`${n.length}`,onOpenDiff:null!==(t=e.onOpenDiff)&&void 0!==t?t:()=>()=>{},trans:e.trans}):m.createElement("p",null,d?e.trans.__("No changes"):e.trans.__("No challenger commit selected."))))}const Ba=(0,S.style)((()=>{const e={$nest:{}};return e.$nest[`& > .${ct}`]={margin:0},e})()),Ia=(0,S.style)({fontSize:"var(--jp-ui-font-size1)",flex:"1 1 auto",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between",alignSelf:"flex-start"}),Aa=(0,S.style)({display:"flex"}),Ta=(0,S.style)({display:"flex",padding:"0 4px"}),La=(0,S.style)({overflowX:"hidden",$nest:{"&>*":{margin:0,padding:0}}}),Ma=(0,S.style)({textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",display:"inline-block"}),Ha=e=>{const[t,s]=m.useState(!1),i=e.files.length;return m.createElement("div",{className:dt},m.createElement("div",{className:ct,onClick:()=>{e.collapsible&&(null==e?void 0:e.files.length)>0&&s(!t)}},e.collapsible&&m.createElement("button",{className:mt},t&&(null==e?void 0:e.files.length)>0?m.createElement(_.caretDownIcon.react,{tag:"span"}):m.createElement(_.caretRightIcon.react,{tag:"span"})),m.createElement("span",{className:Ia},m.createElement("span",{className:Ma},e.trans.__("%1 (on %2)",e.message,e.branch)),m.createElement("span",{className:Aa},e.actions))),t&&m.createElement(k.FixedSizeList,{className:La,height:Math.max(Math.min(e.height-34,25*i),25),itemCount:i,innerElementType:"ul",itemData:null==e?void 0:e.files,itemKey:(e,t)=>t[e],itemSize:25,width:"auto",style:{margin:0,paddingLeft:0}},(({index:t})=>{const s=e.files[t];return m.createElement("li",{className:Ta},m.createElement(nt,{filepath:s}))})))},$a=e=>{var t,s;const[i,n]=m.useState(!1),[r,o]=m.useState(!0),l=null!==(s=null===(t=e.stash)||void 0===t?void 0:t.length)&&void 0!==s?s:0,c=m.useCallback((async t=>{try{await e.model.popStash(t)}catch(e){console.error(e)}}),[e.model]),d=m.useCallback((async t=>{try{await e.model.dropStash(t)}catch(e){console.error(e)}}),[e.model]),h=m.useCallback((async t=>{try{await e.model.applyStash(t)}catch(e){console.error(e)}}),[e.model]);return m.createElement("div",{className:(0,S.classes)(dt,Ba)},m.createElement("div",{className:ct,onClick:()=>{e.collapsible&&l>0&&n(!i)}},e.selectAllButton&&e.selectAllButton,e.collapsible&&m.createElement("button",{className:mt},i&&l>0?m.createElement(_.caretDownIcon.react,{tag:"span"}):m.createElement(_.caretRightIcon.react,{tag:"span"})),m.createElement("span",{className:Ia},m.createElement("span",null,e.trans.__("Stash")),m.createElement("span",{className:Aa},e.actions,m.createElement("span",{"data-test-id":"num-stashes","data-loading":r?"true":"false"},"(",l,")")))),m.createElement(a.UseSignal,{signal:e.model.stashChanged},(()=>{if(!e.stash||!Array.isArray(e.stash))return null;const t=e.stash.length;return o(!1),e.model.stashChanged&&i&&t>0&&m.createElement(m.Fragment,null,e.stash.map((t=>m.createElement(Ha,{key:t.index,files:t.files,model:e.model,index:t.index,branch:t.branch,trans:e.trans,message:t.message,height:100,collapsible:!0,actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:A,title:e.trans.__("Pop stash entry"),onClick:Pe((()=>{c(t.index)}))}),m.createElement(We,{className:Oe,icon:F,title:e.trans.__("Apply stash entry"),onClick:Pe((()=>{h(t.index)}))}),m.createElement(We,{className:Oe,icon:V,title:e.trans.__("Drop stash entry"),onClick:Pe((()=>{d(t.index)}))}))}))))})))},Oa=(0,S.style)({minHeight:"48px",top:0,position:"sticky",flexGrow:0,flexShrink:0,overflowX:"hidden",backgroundColor:"var(--jp-toolbar-active-background)"}),za=(0,S.style)({display:"flex",justifyContent:"center",padding:"10px 0",color:"var(--jp-ui-font-color2)"}),Ua=(0,S.style)({flex:"1 1 auto",display:"flex",flexDirection:"column",minHeight:"200px",marginBlockStart:0,marginBlockEnd:0,paddingLeft:0,paddingRight:"8px",overflowY:"auto"}),Wa=(0,S.style)({display:"flex"}),Ga=(0,S.style)({flexGrow:0,display:"flex",flexShrink:0,flexDirection:"column",padding:"5px 0px 5px 10px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)"}),Va=(0,S.style)({display:"flex",color:"var(--jp-ui-font-color2)",paddingBottom:"5px"}),qa=(0,S.style)({width:"30%",paddingLeft:"0.5em",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",textAlign:"left",$nest:{"&:first-child":{paddingLeft:0}}}),Ka=(0,S.style)({display:"flex",fontSize:"0.8em",marginLeft:"-5px"}),Xa=(0,S.style)({padding:"2px",color:"var(--md-grey-900)",border:"var(--jp-border-width) solid var(--md-grey-700)",borderRadius:"4px",margin:"3px"}),Ya=(0,S.style)({backgroundColor:"var(--md-blue-100)"}),Za=(0,S.style)({backgroundColor:"var(--md-orange-100)"}),Ja=(0,S.style)({backgroundColor:"var(--md-red-100)"}),Qa=(0,S.style)({backgroundColor:"var(--jp-layout-color1)"}),en=(0,S.style)({flex:"auto"}),tn=(0,S.style)({}),sn=(0,S.style)({$nest:{"&:hover":{backgroundColor:"var(--jp-layout-color2)"}}}),an=(0,S.style)({borderLeft:"6px solid var(--jp-git-diff-deleted-color1)"}),nn=(0,S.style)({borderLeft:"6px solid var(--jp-git-diff-added-color1)"});class rn extends m.Component{constructor(e){super(e),this._onCommitClick=(e,t)=>{var s;this.props.children?this.props.toggleCommitExpansion(t):null===(s=this.props.onOpenDiff)||void 0===s||s.call(this,e)}}render(){return m.createElement("li",{id:this.props.commit.commit,ref:e=>this.props.setRef(e),className:(0,S.classes)(Ga,!this.props.children&&this.props.onOpenDiff?sn:this.props.expanded?Qa:null,this.props.isReferenceCommit&&an,this.props.isChallengerCommit&&nn),title:this.props.children?this.props.trans.__("View commit details"):this.props.trans.__("View file changes"),onClick:e=>this._onCommitClick(e,this.props.commit.commit),onContextMenu:this.props.contextMenu&&(e=>{this.props.contextMenu(this.props.commit,e)})},m.createElement("div",{className:Va},m.createElement("span",{className:qa},this.props.commit.author),m.createElement("span",{className:qa},+this.props.commit.commit in ke.Diff.SpecialRef?ke.Diff.SpecialRef[+this.props.commit.commit]:this.props.commit.commit.slice(0,7)),m.createElement("span",{className:qa},this.props.commit.date),!this.props.commit.is_binary&&m.createElement(m.Fragment,null,m.createElement(We,{className:tn,disabled:null===this.props.onSelectForCompare,icon:W,title:this.props.trans.__("Select for compare"),onClick:this.props.onSelectForCompare}),m.createElement(We,{className:tn,disabled:null===this.props.onCompareWithSelected,icon:j,title:this.props.trans.__("Compare with selected"),onClick:this.props.onCompareWithSelected})),this.props.children?this.props.expanded?m.createElement(_.caretUpIcon.react,{className:tn,tag:"span"}):m.createElement(_.caretDownIcon.react,{className:tn,tag:"span"}):m.createElement(I.react,{className:tn,tag:"span"})),m.createElement("div",{className:Ka},this._renderBranches()),m.createElement("div",{className:Ka},this._renderTags()),m.createElement("div",{className:en},this.props.commit.commit_msg,this.props.expanded&&this.props.children))}_renderBranches(){const e=this.props.commit.commit,t=[];for(let s=0;s<this.props.branches.length;s++){const i=this.props.branches[s];i.top_commit&&i.top_commit===e&&t.push(i)}return t.map(this._renderBranch,this)}_renderBranch(e){return m.createElement(m.Fragment,{key:e.name},e.is_current_branch&&m.createElement("span",{className:(0,S.classes)(Xa,Ja)},"working"),m.createElement("span",{className:(0,S.classes)(Xa,e.is_remote_branch?Ya:Za)},e.name))}_renderTags(){const e=this.props.commit.commit,t=[];for(let s=0;s<this.props.tagsList.length;s++){const i=this.props.tagsList[s];i.baseCommitId&&i.baseCommitId===e&&t.push(i)}return t.map(this._renderTag,this)}_renderTag(e){return m.createElement(m.Fragment,{key:e.name},m.createElement("span",{className:(0,S.classes)(Xa,Za)},e.name))}}const on=(0,S.style)({height:"auto",width:"380px",color:"var(--jp-ui-font-color1)!important",borderRadius:"3px!important",backgroundColor:"var(--jp-layout-color1)!important"}),ln=(0,S.style)({position:"absolute",top:"10px",right:"12px",height:"30px",width:"30px",padding:0,border:"none",borderRadius:"50%",backgroundColor:"var(--jp-layout-color1)",$nest:{svg:{fill:"var(--jp-ui-font-color1)"},"&:hover":{backgroundColor:"var(--jp-border-color2)"},"&:active":{backgroundColor:"var(--jp-border-color2)"}}}),cn=(0,S.style)({boxSizing:"border-box",position:"relative",padding:"15px",borderBottom:"var(--jp-border-width) solid var(--jp-border-color2)",$nest:{"& > p":{margin:"0"}}}),dn=(0,S.style)({fontWeight:700}),hn=(0,S.style)({padding:"15px",$nest:{"> p":{marginBottom:"7px"}}}),pn=(0,S.style)({padding:"15px!important",borderTop:"var(--jp-border-width) solid var(--jp-border-color2)"}),mn=(0,S.style)({boxSizing:"border-box",width:"9em",height:"2em",color:"white",fontSize:"var(--jp-ui-font-size1)",cursor:"pointer",border:"0",borderRadius:"3px",$nest:{"&:disabled":{cursor:"default"}}}),un=(0,S.style)({backgroundColor:"var(--md-grey-500)",$nest:{"&:hover":{backgroundColor:"var(--md-grey-600)"},"&:active":{backgroundColor:"var(--md-grey-700)"}}}),gn=(0,S.style)({backgroundColor:"var(--md-blue-500)",$nest:{"&:hover":{backgroundColor:"var(--md-blue-600)"},"&:active":{backgroundColor:"var(--md-blue-700)"},"&:disabled":{color:"var(--jp-ui-inverse-font-color0)",backgroundColor:"var(--jp-layout-color3)"},"&:disabled:hover":{backgroundColor:"var(--jp-layout-color3)"},"&:disabled:active":{backgroundColor:"var(--jp-layout-color3)"}}}),_n=(0,S.style)({display:"flex",flexWrap:"wrap",marginTop:"auto",padding:0,alignItems:"flex-start",backgroundColor:"var(--jp-layout-color1)"});(0,S.style)({width:"100%",height:"1.5em",marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:active":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:focus":{border:"var(--jp-border-width) solid var(--jp-brand-color1)"}}}),(0,S.style)({width:"100%",marginBottom:"1em",padding:"var(--jp-code-padding)",outline:"none",overflowX:"auto",resize:"none",color:"var(--jp-ui-font-color1)",fontSize:"var(--jp-ui-font-size1)",fontWeight:300,backgroundColor:"var(--jp-layout-color1)",border:"var(--jp-border-width) solid var(--jp-border-color2)",borderRadius:"3px",$nest:{"&:focus":{outline:"none",border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&:active":{outline:"none",border:"var(--jp-border-width) solid var(--jp-brand-color1)"},"&::placeholder":{color:"var(--jp-ui-font-color3)"},"&::-webkit-input-placeholder":{color:"var(--jp-ui-font-color3)"},"&::-moz-placeholder":{color:"var(--jp-ui-font-color3)"},"&::-ms-input-placeholder":{color:"var(--jp-ui-font-color3)"}}});class fn extends m.Component{constructor(e){super(e),this._onSummaryChange=e=>{this.setState({summary:e})},this._onDescriptionChange=e=>{this.setState({description:e})},this._onClick=e=>{e.stopPropagation()},this._onClose=e=>{e.stopPropagation(),this.props.onClose(),this._reset()},this._onSubmit=async()=>{this.setState({disabled:!0}),"reset"===this.props.action?this._resetCommit(this.props.commit.commit):this._revertCommit(this.props.commit.commit),this._reset(),this.props.onClose()},this.state={summary:"",description:"",disabled:!1}}render(){const e=this.props.commit.commit.slice(0,7),t="revert"===this.props.action;return m.createElement(w.A,{classes:{paper:on},open:this.props.open,onClick:this._onClick,onClose:this._onClose},m.createElement("div",{className:cn},m.createElement("p",{className:dn},t?this.props.trans.__("Revert Changes"):this.props.trans.__("Reset Changes")),m.createElement("button",{className:ln},m.createElement(E.A,{titleAccess:this.props.trans.__("Close this dialog"),fontSize:"small",onClick:this._onClose}))),m.createElement("div",{className:hn},m.createElement("p",null,t?this.props.trans.__("These changes will be reverted. Only commit if you're sure you're okay losing these changes."):this.props.trans.__("All changes after commit %1 will be gone forever (hard reset). Are you sure?",e)),t&&m.createElement("div",{className:_n},m.createElement(_a,{trans:this.props.trans,summary:this.state.summary,summaryPlaceholder:this._defaultSummary(),description:this.state.description,descriptionPlaceholder:this._defaultDescription(),setSummary:this._onSummaryChange,setDescription:this._onDescriptionChange}))),m.createElement(C.A,{className:pn},m.createElement("input",{disabled:this.state.disabled,className:(0,S.classes)(mn,un),type:"button",title:this.props.trans.__("Cancel changes"),value:"Cancel",onClick:this._onClose}),m.createElement("input",{disabled:this.state.disabled,className:(0,S.classes)(mn,gn),type:"button",title:this.props.trans.__("Submit changes"),value:"Submit",onClick:this._onSubmit})))}async _resetCommit(e){const t=a.Notification.emit(this.props.trans.__("Discarding changes"),"in-progress",{autoClose:!1});try{await this.props.model.resetToCommit(e),a.Notification.update({id:t,message:this.props.trans.__("Successfully discarded changes."),type:"success",autoClose:5e3})}catch(s){a.Notification.update({id:t,message:this.props.trans.__("Failed to discard changes."),type:"error",...es(new Error(`Failed to discard changes after ${e.slice(0,7)}: ${s}`),this.props.trans)})}}async _revertCommit(e){const t=a.Notification.emit(this.props.trans.__("Reverting changes"),"in-progress",{autoClose:!1});try{await this.props.model.revertCommit(this._commitMessage(),e),a.Notification.update({id:t,message:this.props.trans.__("Successfully reverted changes."),type:"success",autoClose:5e3})}catch(s){a.Notification.update({id:t,message:this.props.trans.__("Failed to revert changes."),type:"error",...es(new Error(`Failed to revert ${e.slice(0,7)}: ${s}`),this.props.trans)})}}_defaultSummary(){const e=this.props.commit.commit_msg.split("\n")[0];return this.props.trans.__("Revert '%1'",e)}_defaultDescription(){return this.props.trans.__("This reverts commit %1",this.props.commit.commit)}_commitMessage(){return(this.state.summary||this._defaultSummary())+"\n\n"+(this.state.description||this._defaultDescription())+"\n"}_reset(){this.setState({summary:"",description:"",disabled:!1})}}class bn extends m.Component{constructor(e){super(e),this._onRevertClick=e=>{e.stopPropagation(),this.setState({resetRevertDialog:!0,resetRevertAction:"revert"})},this._onResetClick=e=>{e.stopPropagation(),this.setState({resetRevertDialog:!0,resetRevertAction:"reset"})},this._onResetRevertDialogClose=()=>{this.setState({resetRevertDialog:!1})},this.state={info:"",commitBody:"",numFiles:"",insertions:"",deletions:"",modifiedFiles:[],loadingState:"loading",resetRevertDialog:!1,resetRevertAction:"reset"}}async componentDidMount(){try{const e=await this.props.model.detailedLog(this.props.commit.commit);e&&this.setState({info:e.modified_file_note,commitBody:e.commit_body,numFiles:e.modified_files_count,insertions:e.number_of_insertions,deletions:e.number_of_deletions,modifiedFiles:e.modified_files,loadingState:"success"})}catch(e){return console.error(`Error while getting detailed log for commit ${this.props.commit.commit} and path ${this.props.model.pathRepository}`,e),void this.setState({loadingState:"error"})}}render(){return"loading"===this.state.loadingState?m.createElement("div",null,""):"error"===this.state.loadingState?m.createElement("div",null,this.props.trans.__("Error loading commit data")):m.createElement("div",null,m.createElement("p",{className:Da},this.state.commitBody),m.createElement(ja,{actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Na,icon:A,title:this.props.trans.__("Revert changes introduced by this commit"),onClick:this._onRevertClick}),m.createElement(We,{className:Na,icon:U,title:this.props.trans.__("Discard changes introduced *after* this commit (hard reset)"),onClick:this._onResetClick}),m.createElement(fn,{open:this.state.resetRevertDialog,action:this.state.resetRevertAction,model:this.props.model,commit:this.props.commit,onClose:this._onResetRevertDialogClose,trans:this.props.trans})),numFiles:this.state.numFiles,insertions:this.state.insertions,deletions:this.state.deletions,files:this.state.modifiedFiles,onOpenDiff:this.props.onOpenDiff,trans:this.props.trans}))}}Se.gitTagAdd;const yn=e=>{var t;const s=()=>{e.model.selectedHistoryFile=null},i=m.useMemo((()=>{var t,s,i;return{author:e.trans.__("You"),commit:`${"staged"===(null===(t=e.model.selectedHistoryFile)||void 0===t?void 0:t.status)?ke.Diff.SpecialRef.INDEX:ke.Diff.SpecialRef.WORKING}`,pre_commits:["HEAD"],is_binary:null!==(i=null===(s=e.commits[0])||void 0===s?void 0:s.is_binary)&&void 0!==i&&i,commit_msg:e.trans.__("Uncommitted Changes"),date:e.trans.__("now")}}),[e.model.selectedHistoryFile]),a=e.model.selectedHistoryFile&&"unmodified"!==(null===(t=e.model.selectedHistoryFile)||void 0===t?void 0:t.status)?[i,...e.commits]:e.commits,[n,r]=m.useState([]),[o,l]=m.useState({}),c=m.useRef({});m.useEffect((()=>{const t=new ResizeObserver((e=>{for(const t of e){const e=(Array.isArray(t.borderBoxSize)?t.borderBoxSize[0]:t.borderBoxSize).blockSize,s=t.target.id;l((t=>({...t,[s]:e})))}}));return e.commits.forEach((e=>t.observe(c.current[e.commit],{box:"border-box"}))),()=>t.disconnect()}),[e.commits]);const d=(t,s)=>{s.preventDefault();const i=new y.Menu({commands:e.commands});!function(e,t,s){e.forEach((e=>{t.addItem({command:e,args:{commit:s}})}))}([Se.gitTagAdd],i,t),i.open(s.clientX,s.clientY)};return m.createElement("div",{className:Wa},!e.model.selectedHistoryFile&&m.createElement(Ht,{commits:e.commits.map((e=>({sha:e.commit,parents:e.pre_commits}))),getNodeHeight:e=>{var t;return null!==(t=o[e])&&void 0!==t?t:55}}),m.createElement("ol",{className:Ua},!!e.model.selectedHistoryFile&&m.createElement(ot,{className:Oa,model:e.model,trans:e.trans,actions:m.createElement(We,{className:Oe,icon:_.closeIcon,title:e.trans.__("Discard file history"),onClick:s}),file:e.model.selectedHistoryFile,onDoubleClick:s}),a.length?a.map((t=>{var s,i,a;const o={commit:t,branches:e.branches,tagsList:e.tagsList,model:e.model,commands:e.commands,trans:e.trans},l=e.model.selectedHistoryFile&&!t.is_binary?Ie(e.commands)(t)(null!==(s=t.file_path)&&void 0!==s?s:e.model.selectedHistoryFile.to,!t.is_binary,t.previous_file_path):void 0,h=t.commit===(null===(i=e.referenceCommit)||void 0===i?void 0:i.commit),p=t.commit===(null===(a=e.challengerCommit)||void 0===a?void 0:a.commit);return m.createElement(rn,{key:t.commit,setRef:e=>{c.current[t.commit]=e},...o,isReferenceCommit:h,isChallengerCommit:p,onOpenDiff:l,onSelectForCompare:p?void 0:e.onSelectForCompare(t),onCompareWithSelected:h||null===e.referenceCommit?void 0:e.onCompareWithSelected(t),expanded:n.includes(t.commit),toggleCommitExpansion:e=>r((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e])),contextMenu:d},!e.model.selectedHistoryFile&&m.createElement(bn,{...o,onOpenDiff:Ie(e.commands)(t)}))})):m.createElement("li",{className:za},e.trans.__("No history found."))))},vn=(0,S.style)({padding:"8px"});function wn(e){const[t,s]=u().useState(!1),i=u().useRef(null),n=u().useCallback((()=>{s(!t)}),[]),r=u().useCallback((e=>{var t;(null===(t=i.current)||void 0===t?void 0:t.contains(e.target))||s(!1)}),[]),o=u().useCallback((async()=>{await e.commands.execute(Re.gitResolveRebase,{action:"continue"})}),[]),l=u().useCallback((async()=>{await e.commands.execute(Re.gitResolveRebase,{action:"skip"})}),[]),c=u().useCallback((async()=>{(await(0,a.showDialog)({title:e.trans.__("Abort rebase"),body:e.trans.__("Are you sure you want to abort the rebase?"),buttons:[a.Dialog.cancelButton(),a.Dialog.warnButton({label:e.trans.__("Abort")})]})).button.accept&&await e.commands.execute(Re.gitResolveRebase,{action:"abort"})}),[]);return u().createElement("div",{className:vn},u().createElement($i.A,{ref:i,fullWidth:!0,size:"small"},u().createElement(Hi.A,{classes:{root:ca,disabled:ua},disabled:e.hasConflict,title:e.trans.__("Continue the rebase."),onClick:o},e.trans.__("Continue")),u().createElement(Hi.A,{title:e.trans.__("Pick another rebase action."),classes:{root:(0,S.classes)(ca,da)},onClick:n,size:"small","aria-controls":t?"rebase-split-button-menu":void 0,"aria-expanded":t?"true":void 0},u().createElement(q.react,{tag:"span"}))),u().createElement(Vi.A,{open:t,anchorEl:i.current,transition:!0,disablePortal:!0},(({TransitionProps:t})=>u().createElement(zi.A,{...t},u().createElement(Gi.A,{classes:{root:(0,S.classes)(pa,ha)}},u().createElement(Oi.x,{onClickAway:r},u().createElement(Wi.A,{id:"rebase-split-button-menu"},u().createElement(Ui.A,{key:"skip",classes:{root:pa},onClick:l,title:e.trans.__("Skip the current commit.")},e.trans.__("Skip")),u().createElement(Ui.A,{key:"abort",classes:{root:pa},onClick:c,title:e.trans.__("Abort the rebase.")},e.trans.__("Abort")))))))))}var Cn=s(1108);class xn extends m.Component{constructor(e){super(e),this._renderItem=e=>{const{data:t,index:s,style:i}=e,a=t[s],n=a.name===this.state.base;let r,o;return a.name===this.props.currentBranch?(r=!0,o=this.props.trans.__("The current branch. Pick this if you want to build on work done in this branch.")):["main","main"].includes(a.name)&&(r=!0,o=this.props.trans.__("The default branch. Pick this if you want to start fresh from the default branch.")),m.createElement(x.Ay,{button:!0,title:this.props.trans.__("Create a new branch based on: %1",a.name),className:(0,S.classes)(ne,n?re:null),onClick:this._onBranchClickFactory(a.name),style:i},m.createElement(N.react,{className:ce,tag:"span"}),m.createElement("div",{className:oe},m.createElement("p",{className:(0,S.classes)(de,r?he:null)},a.name),o?m.createElement("p",{className:le},this.props.trans.__(o)):null))},this._onClose=()=>{this.props.onClose(),this.setState({name:"",filter:"",error:""})},this._onFilterChange=e=>{var t;null===(t=this._branchList.current)||void 0===t||t.resetAfterIndex(0),this.setState({filter:e.target.value})},this._resetFilter=()=>{var e;null===(e=this._branchList.current)||void 0===e||e.resetAfterIndex(0),this.setState({filter:""})},this._onNameChange=e=>{this.setState({name:e.target.value,error:""})},this._branchList=m.createRef(),this.state={name:"",base:e.currentBranch||"",filter:"",error:""}}render(){return m.createElement(w.A,{classes:{paper:K},open:this.props.open,onClose:this._onClose},m.createElement("div",{className:Y},m.createElement("p",{className:Z},this.props.trans.__("Create a Branch")),m.createElement("button",{className:X},m.createElement(E.A,{titleAccess:this.props.trans.__("Close this dialog"),fontSize:"small",onClick:this._onClose}))),m.createElement("div",{className:J},this.state.error?m.createElement("p",{className:pe},this.state.error):null,m.createElement("p",null,this.props.trans.__("Name")),m.createElement("input",{className:Q,type:"text",onChange:this._onNameChange,value:this.state.name,placeholder:"",title:this.props.trans.__("Enter a branch name")}),m.createElement("p",null,this.props.trans.__("Create branch based on")),m.createElement("div",{className:ee},m.createElement("div",{className:te},m.createElement("input",{className:se,type:"text",onChange:this._onFilterChange,value:this.state.filter,placeholder:this.props.trans.__("Filter"),title:this.props.trans.__("Filter branch menu")}),this.state.filter?m.createElement("button",{className:ie},m.createElement(E.A,{titleAccess:this.props.trans.__("Clear the current filter"),fontSize:"small",onClick:this._resetFilter})):null)),this._renderItems()),m.createElement(C.A,{className:me},m.createElement("input",{className:(0,S.classes)(ue,ge),type:"button",title:this.props.trans.__("Close this dialog without creating a new branch"),value:this.props.trans.__("Cancel"),onClick:this._onClose}),m.createElement("input",{className:(0,S.classes)(ue,_e),type:"button",title:this.props.trans.__("Create a new branch"),value:this.props.trans.__("Create Branch"),onClick:()=>{this._createBranch()},disabled:""===this.state.name||""!==this.state.error})))}_renderItems(){const e=this.props.currentBranch,t=this.state.filter,s=this.props.branches.filter((e=>!t||e.name.includes(t))).slice().sort((function(t,s){return t.name===e?-1:s.name===e?1:"main"===t.name?-1:"main"===s.name?1:"main"===t.name?-1:"main"===s.name?1:0}));return m.createElement(k.VariableSizeList,{className:ae,height:200,estimatedItemSize:27.5,itemCount:s.length,itemData:s,itemKey:(e,t)=>t[e].name,itemSize:e=>{const t=s[e];return[this.props.currentBranch,"main","main"].includes(t.name)?66.5:27.5},ref:this._branchList,style:{overflowX:"hidden"},width:"auto"},this._renderItem)}_onBranchClickFactory(e){return()=>{this.setState({base:e})}}async _createBranch(){var e;const t={newBranch:!0,branchname:this.state.name,startpoint:this.state.base},s=a.Notification.emit(this.props.trans.__("Creating branch"),"in-progress",{autoClose:!1});try{await this.props.model.checkout(t)}catch(e){return this.setState({error:e.message.replace(/^fatal:/,"")}),void a.Notification.update({id:s,message:this.props.trans.__("Failed to create branch."),type:"error",autoClose:!1})}a.Notification.update({id:s,message:this.props.trans.__("Branch created."),type:"success",autoClose:5e3}),this.props.onClose(),null===(e=this._branchList.current)||void 0===e||e.resetAfterIndex(0),this.setState({name:"",filter:""})}}function En(e){return m.createElement(x.Ay,{key:e},e)}class kn extends m.Component{constructor(e){super(e),this.CHANGES_ERR_MSG=this.props.trans.__("The current branch contains files with uncommitted changes. Please commit or discard these changes before switching to or creating another branch."),this._renderItem=e=>{const{data:t,index:s,style:i}=e,a=t[s],n=a.is_current_branch;return m.createElement(x.Ay,{button:!0,title:n?"":this.props.trans.__("Switch to branch: %1",a.name),className:(0,S.classes)(ea,n?ta:null),onClick:this._onBranchClickFactory(a.name,a.is_remote_branch),role:"listitem",style:i},m.createElement(N.react,{className:sa,tag:"span"}),m.createElement("span",{className:qi},a.name),!a.is_remote_branch&&!n&&m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:V,title:this.props.trans.__("Delete this branch locally"),onClick:async e=>{null==e||e.stopPropagation(),await this._onDeleteBranch(a.name)}}),m.createElement(We,{className:Oe,icon:M,title:this.props.trans.__("Merge this branch into the current one"),onClick:e=>{null==e||e.stopPropagation(),this._onMergeBranch(a.name)}})))},this._onFilterChange=e=>{this.setState({filter:e.target.value})},this._resetFilter=()=>{this.setState({filter:""})},this._onDeleteBranch=async e=>{if((await(0,a.showDialog)({title:this.props.trans.__("Delete branch"),body:m.createElement("p",null,this.props.trans.__("Are you sure you want to permanently delete the branch "),m.createElement("b",null,e),"?",m.createElement("br",null),this.props.trans.__("This action cannot be undone.")),buttons:[a.Dialog.cancelButton({label:this.props.trans.__("Cancel")}),a.Dialog.warnButton({label:this.props.trans.__("Delete")})]})).button.accept)try{await this.props.model.deleteBranch(e),await this.props.model.refreshBranch()}catch(t){console.error(`Failed to delete branch ${e}`,t)}},this._onMergeBranch=async e=>{await this.props.commands.execute(Re.gitMerge,{branch:e})},this._onNewBranchClick=()=>{this.props.branching?this.setState({branchDialog:!0}):(0,a.showErrorMessage)(this.props.trans.__("Creating a new branch is disabled"),this.CHANGES_ERR_MSG)},this._onNewBranchDialogClose=()=>{this.setState({branchDialog:!1})},this.state={filter:"",branchDialog:!1}}render(){return m.createElement("div",{className:Ki},this._renderFilter(),this._renderBranchList(),this._renderNewBranchDialog())}_renderFilter(){return m.createElement("div",{className:Xi},m.createElement("div",{className:Yi},m.createElement("input",{className:Zi,type:"text",onChange:this._onFilterChange,value:this.state.filter,placeholder:this.props.trans.__("Filter"),title:this.props.trans.__("Filter branch menu")}),this.state.filter?m.createElement("button",{className:Ji},m.createElement(E.A,{titleAccess:this.props.trans.__("Clear the current filter"),fontSize:"small",onClick:this._resetFilter})):null),m.createElement("input",{className:Qi,type:"button",title:this.props.trans.__("Create a new branch"),value:this.props.trans.__("New Branch"),onClick:this._onNewBranchClick}))}_renderBranchList(){const e=this.state.filter,t=this.props.branches.filter((t=>(this.props.model.status.state===ke.State.DEFAULT||!t.is_current_branch)&&(!e||t.name.includes(e))));return m.createElement(k.FixedSizeList,{height:Math.min(Math.max(150,24.8*t.length),400),itemCount:t.length,itemData:t,itemKey:(e,t)=>t[e].name,itemSize:24.8,style:{overflowX:"hidden",paddingTop:0,paddingBottom:0},width:"auto"},this._renderItem)}_renderNewBranchDialog(){return m.createElement(xn,{currentBranch:this.props.currentBranch,branches:this.props.branches,open:this.state.branchDialog,model:this.props.model,onClose:this._onNewBranchDialogClose,trans:this.props.trans})}_onBranchClickFactory(e,t){return async()=>{if(!this.props.branching)return void(0,a.showErrorMessage)(this.props.trans.__("Switching branches is disabled"),this.CHANGES_ERR_MSG);let s="Switched branch.",i="success";const n={branchname:e},r=a.Notification.emit(this.props.trans.__("Switching branch"),"in-progress",{autoClose:!1});try{let r=!0;const o=e.split("/").slice(-1)[0],l=this.props.model.branches.find((e=>e.name===o));l&&t&&((await(0,a.showDialog)({title:this.props.trans.__("Confirm Checkout"),body:this.props.trans.__("Checking out this branch will reset your local copy to the remote. Any changes not pushed to the remote will be lost. Are you sure you want to continue?"),buttons:[a.Dialog.cancelButton({label:this.props.trans.__("Cancel")}),a.Dialog.warnButton({label:this.props.trans.__("Continue")})]})).button.accept||(r=!1,s="Checkout cancelled.",i="warning")),r&&await this.props.model.checkout(n)}catch(e){return function(e,t,s){e.message.includes("following files would be overwritten")?(a.Notification.dismiss(t),(0,a.showDialog)({title:s.__("Unable to switch branch"),body:m.createElement(m.Fragment,null,m.createElement("p",null,s.__("Your changes to the following files would be overwritten by switching:")),m.createElement(Cn.A,null,e.message.split("\n").slice(1,-3).map(En)),m.createElement("span",null,s.__("Please commit, stash, or discard your changes before you switch branches."))),buttons:[a.Dialog.okButton({label:s.__("Dismiss")})]})):a.Notification.update({id:t,message:s.__("Failed to switch branch."),type:"error",...es(e,s)})}(e,r,this.props.trans)}a.Notification.update({id:r,message:this.props.trans.__(s),type:i,autoClose:5e3})}}}const Sn=(0,S.style)({padding:"4px 4px 1px",margin:"0 6px",fontWeight:600,letterSpacing:"1px",fontSize:"12px",overflowY:"hidden",borderBottom:"3px solid var(--jp-brand-color1)",height:"16px"});class Rn extends m.Component{constructor(e){super(e),this._renderItem=e=>{const{data:t,index:s,style:i}=e,a=t[s];return m.createElement(x.Ay,{title:this.props.trans.__("Submodule: %1",a.name),className:ea,role:"listitem",style:i},m.createElement(B.react,{className:sa,tag:"span"}),m.createElement("span",{className:qi},a.name))}}render(){return m.createElement("div",{className:Ki},this._renderSubmoduleList())}_renderSubmoduleList(){const e=this.props.submodules;return m.createElement(m.Fragment,null,m.createElement("div",{className:Sn},"Submodules"),m.createElement(k.FixedSizeList,{height:Math.min(Math.max(150,24.8*e.length),400),itemCount:e.length,itemData:e,itemKey:(e,t)=>t[e].name,itemSize:24.8,style:{overflowX:"hidden",paddingTop:0,paddingBottom:0},width:"auto"},this._renderItem))}}function Fn(e){return m.createElement(x.Ay,{key:e},e)}class Nn extends m.Component{constructor(e){super(e),this._renderItem=e=>{const{data:t,index:s,style:i}=e,a=t[s];return m.createElement(x.Ay,{button:!0,title:this.props.trans.__("Checkout to tag: %1",a.name),className:ea,onClick:this._onTagClickFactory(a.name),style:i},m.createElement(G.react,{className:sa,tag:"span"}),m.createElement("span",{className:qi},a.name))},this._onFilterChange=e=>{this.setState({filter:e.target.value})},this._resetFilter=()=>{this.setState({filter:""})},this._onNewTagClick=()=>{this.props.branching?this.setState({tagDialog:!0}):(0,a.showErrorMessage)(this.props.trans.__("Creating a new tag is disabled"),this.props.trans.__("Error in creating new tag"))},this._onNewTagDialogClose=()=>{this.setState({tagDialog:!1})},this.state={filter:"",tagDialog:!1}}render(){return m.createElement("div",{className:Ki},this._renderFilter(),this._renderTagList(),this._renderNewTagDialog())}_renderFilter(){return m.createElement("div",{className:Xi},m.createElement("div",{className:Yi},m.createElement("input",{className:Zi,type:"text",onChange:this._onFilterChange,value:this.state.filter,placeholder:this.props.trans.__("Filter"),title:this.props.trans.__("Filter tag menu")}),this.state.filter?m.createElement("button",{className:Ji},m.createElement(E.A,{titleAccess:this.props.trans.__("Clear the current filter"),fontSize:"small",onClick:this._resetFilter})):null),m.createElement("input",{className:Qi,type:"button",title:this.props.trans.__("Create a new tag"),value:this.props.trans.__("New Tag"),onClick:this._onNewTagClick}))}_renderTagList(){const e=this.state.filter,t=this.props.tagsList.filter((t=>!e||t.name.includes(e)));return m.createElement(k.FixedSizeList,{height:Math.min(Math.max(150,24.8*t.length),400),itemCount:t.length,itemData:t,itemKey:(e,t)=>t[e].name,itemSize:24.8,style:{overflowX:"hidden",paddingTop:0,paddingBottom:0},width:"auto"},this._renderItem)}_renderNewTagDialog(){return m.createElement(zt,{pastCommits:this.props.pastCommits,model:this.props.model,trans:this.props.trans,open:this.state.tagDialog,onClose:this._onNewTagDialogClose,isSingleCommit:!1})}_onTagClickFactory(e){return async()=>{if(!this.props.branching)return void(0,a.showErrorMessage)(this.props.trans.__("Checkout tags is disabled"),this.props.trans.__("The repository contains files with uncommitted changes. Please commit or discard these changes before switching to a tag."));const t=a.Notification.emit(this.props.trans.__("Checking tag out"),"in-progress",{autoClose:!1});try{await this.props.model.checkoutTag(e)}catch(e){return function(e,t,s){e.message.includes("following files would be overwritten")?(a.Notification.dismiss(t),(0,a.showDialog)({title:s.__("Unable to checkout tag"),body:m.createElement(m.Fragment,null,m.createElement("p",null,s.__("Your changes to the following files would be overwritten by switching:")),m.createElement(Cn.A,null,e.message.split("\n").slice(1,-3).map(Fn)),m.createElement("span",null,s.__("Please commit, stash, or discard your changes before you checkout tags."))),buttons:[a.Dialog.okButton({label:s.__("Dismiss")})]})):a.Notification.update({id:t,message:s.__("Failed to checkout tag."),type:"error",...es(e,s)})}(e,t,this.props.trans)}a.Notification.update({id:t,message:this.props.trans.__("Tag checkout."),type:"success",autoClose:5e3})}}}class Dn extends m.Component{constructor(e){super(e),this._onPullClick=async()=>{await this.props.commands.execute(Re.gitPull)},this._onPushClick=async()=>{await this.props.commands.execute(Re.gitPush)},this._onBranchClick=()=>{this.setState({branchMenu:!this.state.branchMenu})},this._onRepoClick=()=>{this.setState({repoMenu:!this.state.repoMenu})},this._onRefreshClick=async()=>{const e=a.Notification.emit(this.props.trans.__("Refreshing"),"in-progress",{autoClose:!1});this.setState({refreshInProgress:!0});try{await this.props.model.refresh(),a.Notification.update({id:e,message:this.props.trans.__("Successfully refreshed."),type:"success",autoClose:5e3})}catch(t){console.error(t),a.Notification.update({id:e,message:this.props.trans.__("Failed to refresh."),type:"error",...es(t,this.props.trans)})}finally{this.setState({refreshInProgress:!1})}},this.state={branchMenu:!1,tab:0,refreshInProgress:!1,hasRemote:!1,repoMenu:!1}}async componentDidMount(){try{const e=(await this.props.model.getRemotes()).length>0;this.setState({hasRemote:e})}catch(e){console.error(e)}}render(){return m.createElement("div",{className:gi},this._renderTopNav(),this._renderRepoMenu(),this._renderBranchMenu())}_renderTopNav(){var e;const t=this.props.branches.filter((e=>e.is_current_branch)),s=this.state.hasRemote,i=null!==(null===(e=t[0])||void 0===e?void 0:e.upstream);return m.createElement("div",{className:_i},m.createElement("span",{className:ki}),m.createElement(li.A,{className:Si,variant:"dot",invisible:!s||0===this.props.nCommitsBehind},m.createElement(We,{className:Ei,disabled:!s,icon:$,onClick:s?this._onPullClick:void 0,title:s?this.props.trans.__("Pull latest changes")+(this.props.nCommitsBehind>0?this.props.trans.__(" (behind by %1 commits)",this.props.nCommitsBehind):""):this.props.trans.__("No remote repository defined")})),m.createElement(li.A,{className:Si,variant:"dot",invisible:!s||0===this.props.nCommitsAhead&&i},m.createElement(We,{className:Ei,disabled:!s,icon:O,onClick:s?this._onPushClick:void 0,title:s?i?this.props.trans.__("Push committed changes")+(this.props.nCommitsAhead>0?this.props.trans.__(" (ahead by %1 commits)",this.props.nCommitsAhead):""):this.props.trans.__("Publish branch"):this.props.trans.__("No remote repository defined")})),m.createElement(We,{className:Ei,icon:_.refreshIcon,onClick:this._onRefreshClick,disabled:this.state.refreshInProgress,title:this.props.trans.__("Refresh the repository to detect local and remote changes")}))}_renderRepoMenu(){const e=!(0===this.props.submodules.length),t=g.PathExt.basename(this.props.repository||g.PageConfig.getOption("serverRoot"))||"Jupyter Server Root";return m.createElement("div",{className:fi},m.createElement("button",{disabled:!e,className:(0,S.classes)(bi,e&&yi),title:this.props.trans.__("Current repository: %1",g.PageConfig.getOption("serverRoot")+"/"+this.props.repository),onClick:this._onRepoClick},m.createElement(B.react,{tag:"span",className:vi}),m.createElement("div",{className:wi},m.createElement("p",{className:Ci},this.props.trans.__("Current Repository")),m.createElement("p",{className:xi},t)),e&&(this.state.repoMenu?m.createElement(_.caretUpIcon.react,{tag:"span",className:vi}):m.createElement(_.caretDownIcon.react,{tag:"span",className:vi}))),this.state.repoMenu?this._renderSubmodules():null)}_renderBranchMenu(){let e="";if(null===this.props.model.pathRepository)return null;switch(this.props.model.status.state){case ke.State.CHERRY_PICKING:e=this.props.trans.__("Cherry picking in");break;case ke.State.DETACHED:e=this.props.trans.__("Detached Head at");break;case ke.State.MERGING:e=this.props.trans.__("Merging in");break;case ke.State.REBASING:e=this.props.trans.__("Rebasing");break;default:e=this.props.trans.__("Current Branch")}return m.createElement("div",{className:fi},m.createElement("button",{className:(0,S.classes)(bi,yi),title:this.props.trans.__("Manage branches and tags"),onClick:this._onBranchClick},m.createElement(N.react,{tag:"span",className:vi}),m.createElement("div",{className:wi},m.createElement("p",{className:Ci},e),m.createElement("p",{className:xi},this.props.currentBranch||"")),this.state.branchMenu?m.createElement(_.caretUpIcon.react,{tag:"span",className:vi}):m.createElement(_.caretDownIcon.react,{tag:"span",className:vi})),this.state.branchMenu?this._renderTabs():null)}_renderTabs(){return m.createElement(m.Fragment,null,m.createElement(gs.A,{classes:{root:Bi,indicator:Ti},value:this.state.tab,onChange:(e,t)=>{this.setState({tab:t})}},m.createElement(us.A,{classes:{root:Ii,selected:Ai},title:this.props.trans.__("View branches"),label:this.props.trans.__("Branches"),disableFocusRipple:!0,disableRipple:!0}),m.createElement(us.A,{classes:{root:Ii,selected:Ai},title:this.props.trans.__("View tags"),label:this.props.trans.__("Tags"),disableFocusRipple:!0,disableRipple:!0})),0===this.state.tab?this._renderBranches():this._renderTags())}_renderBranches(){return m.createElement(kn,{currentBranch:this.props.currentBranch||"",branches:this.props.branches,branching:this.props.branching,commands:this.props.commands,model:this.props.model,trans:this.props.trans})}_renderTags(){return m.createElement(Nn,{pastCommits:this.props.pastCommits,tagsList:this.props.tagsList,model:this.props.model,branching:this.props.branching,trans:this.props.trans})}_renderSubmodules(){return m.createElement(Rn,{model:this.props.model,submodules:this.props.submodules,trans:this.props.trans})}}var jn=s(6693),Pn=s(7648),Bn=s(1267);function In(e){return m.createElement(Pn.A,{classes:{root:(0,S.classes)(pa,aa)},variant:"outlined"},m.createElement(Bn.A,{className:na,avatar:e.headerIcon,title:e.title,disableTypography:!0}),m.createElement(jn.A,{className:ra},e.content))}class An extends m.Component{constructor(e){super(e),this.refreshBranches=async()=>{this.setState({branches:this.props.model.branches})},this.refreshCurrentBranch=async()=>{const{currentBranch:e}=this.props.model;this.setState({currentBranch:e?e.name:"main",referenceCommit:null,challengerCommit:null})},this.refreshTags=async()=>{this.setState({tagsList:this.props.model.tagsList})},this.refreshHistory=async()=>{var e;if(null!==this.props.model.pathRepository){const t=await this.props.model.log(this.props.settings.composite.historyCount);let s=new Array;0===t.code&&(s=null!==(e=t.commits)&&void 0!==e?e:[]),this.setState({pastCommits:s})}},this.refreshSubmodules=async()=>{await this.props.model.listSubmodules(),this.setState({submodules:this.props.model.submodules})},this.refreshView=async()=>{null!==this.props.model.pathRepository&&(await this.refreshBranches(),await this.refreshHistory(),await this.refreshTags())},this.commitFiles=async()=>{let e=this.state.commitSummary;if(this.state.commitDescription&&(e=e+"\n\n"+this.state.commitDescription+"\n"),!e&&!this.state.commitAmend)return;const t=this.props.settings.composite.simpleStaging?this._commitMarkedFiles:this._commitStagedFiles;try{this.state.commitAmend?await t(null):await t(e),this.setState({commitSummary:"",commitDescription:""})}catch(e){console.error(e)}},this._gitStashClear=async()=>{await this.props.model.dropStash()},this._gitStashApplyLatest=async()=>{await this.props.model.applyStash(0)},this._onStashClick=async()=>{await this.props.commands.execute(Re.gitStash)},this._onTabChange=(e,t)=>{1===t&&this.refreshHistory(),this.setState({tab:t})},this._setCommitDescription=e=>{this.setState({commitDescription:e})},this._setCommitSummary=e=>{this.setState({commitSummary:e})},this._setCommitAmend=e=>{this.setState({commitAmend:e})},this._commitMarkedFiles=async e=>{const t=a.Notification.emit(this.props.trans.__("Staging files..."),"in-progress",{autoClose:!1});await this.props.model.reset(),await this.props.model.add(...this._markedFiles.map((e=>e.to))),await this._commitStagedFiles(e,t)},this._commitStagedFiles=async(e=null,t)=>{const s=this.props.trans.__("Failed to commit changes.");let i=null!=t?t:null;try{const t=await this._hasIdentity(this.props.model.pathRepository),s=this.props.trans.__("Committing changes...");null!==i?a.Notification.update({id:i,message:s,autoClose:!1}):i=a.Notification.emit(s,"in-progress",{autoClose:!1}),this.state.commitAmend?await this.props.model.commit(null,!0,t):await this.props.model.commit(e,!1,t),a.Notification.update({id:i,type:"success",message:this.props.trans.__("Committed changes."),autoClose:5e3});const n=this.props.model.branches.some((e=>e.is_remote_branch));this.props.settings.composite.commitAndPush&&n&&await this.props.commands.execute(Re.gitPush)}catch(e){throw null===i?a.Notification.error(s,es(e,this.props.trans)):a.Notification.update({id:i,message:s,...es(e,this.props.trans)}),e}},this._previousRepoPath=null;const{branches:t,currentBranch:s,pathRepository:i,hasDirtyFiles:n,stash:r,tagsList:o,submodules:l}=e.model;this.state={branches:t,currentBranch:s?s.name:"main",files:[],remoteChangedFiles:[],nCommitsAhead:0,nCommitsBehind:0,pastCommits:[],repository:i,tab:0,commitSummary:"",commitDescription:"",commitAmend:!1,hasDirtyFiles:n,referenceCommit:null,challengerCommit:null,stash:r,tagsList:o,submodules:l}}componentDidMount(){const{model:e,settings:t}=this.props;e.stashChanged.connect(((e,t)=>{this.setState({stash:t.newValue})}),this),e.repositoryChanged.connect(((e,t)=>{this.setState({repository:t.newValue,referenceCommit:null,challengerCommit:null}),this.refreshView()}),this),e.statusChanged.connect((async()=>{const t=await e.remoteChangedFiles();this.setState({files:e.status.files,remoteChangedFiles:t,nCommitsAhead:e.status.ahead,nCommitsBehind:e.status.behind})}),this),e.branchesChanged.connect((async()=>{await this.refreshBranches()}),this),e.headChanged.connect((async()=>{await this.refreshCurrentBranch(),1===this.state.tab&&this.refreshHistory()}),this),e.tagsChanged.connect((async()=>{await this.refreshTags()}),this),e.selectedHistoryFileChanged.connect((()=>{this.setState({tab:1}),this.refreshHistory()}),this),e.remoteChanged.connect(((e,t)=>{this.warningDialog(t)}),this),e.repositoryChanged.connect((async()=>{await this.refreshSubmodules()}),this),t.changed.connect(this.refreshView,this),e.dirtyFilesStatusChanged.connect(((e,t)=>{this.setState({hasDirtyFiles:t})}))}componentWillUnmount(){be.Signal.clearData(this)}render(){return m.createElement("div",{className:Di},null!==this.state.repository?m.createElement(m.Fragment,null,this._renderToolbar(),this._renderMain()):this._renderWarning())}_renderToolbar(){const e=Boolean(this.props.settings.composite.disableBranchWithChanges&&(this._hasUnStagedFile()||this._hasStagedFile()));return m.createElement(Dn,{currentBranch:this.state.currentBranch,branches:this.state.branches,tagsList:this.state.tagsList,branching:!e,commands:this.props.commands,pastCommits:this.state.pastCommits,model:this.props.model,nCommitsAhead:this.state.nCommitsAhead,nCommitsBehind:this.state.nCommitsBehind,repository:this.state.repository||"",trans:this.props.trans,submodules:this.state.submodules})}_renderMain(){return m.createElement(m.Fragment,null,this._renderTabs(),1===this.state.tab?this._renderHistory():this._renderChanges())}_renderTabs(){return m.createElement(gs.A,{classes:{root:Bi,indicator:Ti},value:this.state.tab,onChange:this._onTabChange},m.createElement(us.A,{classes:{root:Ii,selected:Ai},title:this.props.trans.__("View changed files"),label:this.props.trans.__("Changes"),disableFocusRipple:!0,disableRipple:!0}),m.createElement(us.A,{classes:{root:Ii,selected:Ai},title:this.props.trans.__("View commit history"),label:this.props.trans.__("History"),disableFocusRipple:!0,disableRipple:!0}))}_renderChanges(){var e,t;const s=this.props.model.branches.some((e=>e.is_remote_branch)),i=this.props.settings.composite.commitAndPush&&s?this.state.commitAmend?this.props.trans.__("Commit (Amend) and Push"):this.props.trans.__("Commit and Push"):this.state.commitAmend?this.props.trans.__("Commit (Amend)"):this.props.trans.__("Commit"),a=this.props.trans.__("Warning"),n=this.props.settings.composite.simpleStaging,r=n?this.props.trans.__("You have unsaved tracked files. You probably want to save all changes before committing."):this.props.trans.__("You have unsaved staged files. You probably want to save and stage all needed changes before committing.");return m.createElement(m.Fragment,null,m.createElement(vt,{files:this._sortedFiles,model:this.props.model,commands:this.props.commands,settings:this.props.settings,trans:this.props.trans}),m.createElement($a,{actions:m.createElement(m.Fragment,null,m.createElement(We,{className:Oe,icon:U,onClick:this._onStashClick,title:this.props.trans.__("Stash latest changes")}),m.createElement(We,{icon:F,className:Oe,disabled:0===(null===(e=this.props.model.stash)||void 0===e?void 0:e.length),title:this.props.trans.__("Apply the latest stash"),onClick:Pe((()=>{this._gitStashApplyLatest()}))}),m.createElement(We,{className:Oe,icon:V,title:this.props.trans.__("Clear the entire stash"),disabled:0===(null===(t=this.props.model.stash)||void 0===t?void 0:t.length),onClick:Pe((()=>{this._gitStashClear()}))})),stash:this.props.model.stash,model:this.props.model,height:100,collapsible:!0,trans:this.props.trans}),this.props.model.status.state!==ke.State.REBASING?m.createElement(fa,{commands:this.props.commands,hasFiles:n?this._markedFiles.length>0:this._hasStagedFile(),trans:this.props.trans,label:i,summary:this.state.commitSummary,description:this.state.commitDescription,amend:this.state.commitAmend,setSummary:this._setCommitSummary,setDescription:this._setCommitDescription,setAmend:this._setCommitAmend,onCommit:this.commitFiles,warning:this.state.hasDirtyFiles?m.createElement(In,{headerIcon:m.createElement(Ni.A,null),title:a,content:r}):null}):m.createElement(wn,{commands:this.props.commands,hasConflict:this.state.files.some((e=>"unmerged"===e.status)),trans:this.props.trans}))}_renderHistory(){return m.createElement(m.Fragment,null,m.createElement(yn,{branches:this.state.branches,tagsList:this.state.tagsList,commits:this.state.pastCommits,model:this.props.model,commands:this.props.commands,trans:this.props.trans,referenceCommit:this.state.referenceCommit,challengerCommit:this.state.challengerCommit,onSelectForCompare:e=>async t=>{null==t||t.stopPropagation(),this.setState({referenceCommit:e},(()=>{this._openSingleFileComparison(t)}))},onCompareWithSelected:e=>async t=>{null==t||t.stopPropagation(),this.setState({challengerCommit:e},(()=>{this._openSingleFileComparison(t)}))}}),null===this.props.model.selectedHistoryFile&&(this.state.referenceCommit||this.state.challengerCommit)&&m.createElement(Pa,{header:this.props.trans.__("Compare %1 and %2",this.state.referenceCommit?this.state.referenceCommit.commit.substring(0,7):"...",this.state.challengerCommit?this.state.challengerCommit.commit.substring(0,7):"..."),referenceCommit:this.state.referenceCommit,challengerCommit:this.state.challengerCommit,commands:this.props.commands,model:this.props.model,trans:this.props.trans,onClose:e=>{null==e||e.stopPropagation(),this.setState({referenceCommit:null,challengerCommit:null})},onOpenDiff:this.state.referenceCommit&&this.state.challengerCommit?Ie(this.props.commands)(this.state.challengerCommit,this.state.referenceCommit):void 0}))}_renderWarning(){const e=this.props.filebrowser.path,{commands:t}=this.props;return m.createElement(m.Fragment,null,m.createElement("div",{className:ji},e?m.createElement(m.Fragment,null,m.createElement("b",{title:e},g.PathExt.basename(e))," ",this.props.trans.__("is not")):this.props.trans.__("You are not currently in"),this.props.trans.__(" a Git repository. To use Git, navigate to a local repository, initialize a repository here, or clone an existing repository.")),m.createElement("button",{className:Pi,onClick:()=>t.execute("filebrowser:toggle-main")},this.props.trans.__("Open the FileBrowser")),m.createElement("button",{className:Pi,onClick:()=>t.execute(Re.gitInit)},this.props.trans.__("Initialize a Repository")),t.hasCommand(Re.gitClone)&&m.createElement("button",{className:Pi,onClick:async()=>{await t.execute(Re.gitClone),await t.execute("filebrowser:toggle-main")}},this.props.trans.__("Clone a Repository")))}async _hasIdentity(e){var t,s;if(null===e)return null;const i=!!(null===(t=this.props.model.lastAuthor)||void 0===t?void 0:t.name)&&!!(null===(s=this.props.model.lastAuthor)||void 0===s?void 0:s.email);if(e!==this._previousRepoPath||this.props.settings.composite.promptUserIdentity||!i)try{let t,s=!1,n=null;if(null!==this.props.model.lastAuthor&&i)t=this.props.model.lastAuthor;else{const e=(await this.props.model.config()).options;t={name:e["user.name"]||"",email:e["user.email"]||""},s=!t.name||!t.email}if(this.props.settings.composite.promptUserIdentity||s){const e=await(0,a.showDialog)({title:this.props.trans.__("Who is committing?"),body:new Li({author:t,trans:this.props.trans})});if(!e.button.accept)throw new Error(this.props.trans.__("User refused to set identity."));t=e.value,s&&await this.props.model.config({"user.name":t.name,"user.email":t.email}),this.props.model.lastAuthor=t,this.props.settings.composite.promptUserIdentity&&(n=`${t.name} <${t.email}>`)}return this._previousRepoPath=e,n}catch(e){if(e instanceof ke.GitResponseError)throw e;throw new Error(this.props.trans.__("Failed to set your identity. %1",e.message))}return null}_hasStagedFile(){return this.state.files.some((e=>"staged"===e.status||"partially-staged"===e.status))}_hasUnStagedFile(){return this.state.files.some((e=>"unstaged"===e.status||"partially-staged"===e.status))}get _markedFiles(){return this._sortedFiles.filter((e=>this.props.model.getMark(e.to)))}get _sortedFiles(){const{files:e,remoteChangedFiles:t}=this.state;let s=e;return t&&(s=s.concat(t)),s.sort(((e,t)=>e.to.localeCompare(t.to))),s}async warningDialog(e){const t=this.props.trans.__("One or more open files are behind %1 head. Do you want to pull the latest remote version?",this.props.model.status.remote),s=new a.Dialog({title:t,body:this._renderBody(e.notNotified,e.notified),buttons:[a.Dialog.cancelButton({label:this.props.trans.__("Continue Without Pulling")}),a.Dialog.warnButton({label:this.props.trans.__("Pull"),caption:this.props.trans.__("Git Pull from Remote Branch")})]});(await s.launch()).button.accept&&await this.props.commands.execute(Re.gitPull,{})}_renderBody(e,t=[]){const s=e.map((e=>{console.log(e.to);const t=this.props.trans.__(e.to);return m.createElement("li",{key:t},t)}));let i=m.createElement("ul",null,s);if(t.length>0){const e=this.props.trans.__("The following open files remain behind:"),s=t.map((e=>{console.log(e.to);const t=this.props.trans.__(e.to);return m.createElement("li",{key:t},t)}));i=m.createElement("div",null,i,e,m.createElement("ul",null,s))}return m.createElement("div",null,i)}_openSingleFileComparison(e){this.props.model.selectedHistoryFile&&this.state.referenceCommit&&this.state.challengerCommit&&Ie(this.props.commands)(this.state.challengerCommit,this.state.referenceCommit)(this.props.model.selectedHistoryFile.to,!this.props.model.selectedHistoryFile.is_binary)(e)}}const Tn=(0,S.style)({display:"flex",flexDirection:"column",minWidth:"300px",color:"var(--jp-ui-font-color1)",background:"var(--jp-layout-color1)",fontSize:"var(--jp-ui-font-size1)"});class Ln extends a.ReactWidget{constructor(e,t,s,i,a,n){super(),this.node.id="GitSession-root",this.addClass(Tn),this._trans=a,this._commands=s,this._fileBrowserModel=i,this._model=e,this._settings=t,e.refreshStandbyCondition=()=>!this._settings.composite.refreshIfHidden&&this.isHidden}onBeforeShow(e){this._model.refresh().catch((e=>{console.error("Fail to refresh model when displaying GitWidget.",e)})),super.onBeforeShow(e)}render(){return m.createElement(An,{commands:this._commands,filebrowser:this._fileBrowserModel,model:this._model,settings:this._settings,trans:this._trans})}}const Mn={id:"@jupyterlab/git:plugin",requires:[i.ILayoutRestorer,Wt.IEditorLanguageRegistry,n.IEditorServices,o.IDefaultFileBrowser,c.IRenderMimeRegistry,d.ISettingRegistry,r.IDocumentManager],optional:[l.IMainMenu,h.IStatusBar,a.ICommandPalette,p.ITranslator],provides:Ee,activate:async function(e,t,s,i,r,o,l,c,d,h,u,v){let w,C;const x=(v=null!=v?v:p.nullTranslator).load("jupyterlab_git");try{w=await l.load(Mn.id)}catch(e){console.error(x.__("Failed to load settings for the Git Extension.\n%1",e))}try{C=await async function(e){try{const e="settings"+g.URLExt.objectToQueryString({version:"0.51.2"});return await Ne(e,"GET")}catch(t){if(t instanceof ke.GitResponseError){const s=t.response;if(404===s.status){const t=e.__("Git server extension is unavailable. Please ensure you have installed the JupyterLab Git server extension by running: pip install --upgrade jupyterlab-git. To confirm that the server extension is installed, run: jupyter server extension list.");throw new xe.ServerConnection.ResponseError(s,t)}{const e=t.message;throw console.error("Failed to get the server extension settings",e),new xe.ServerConnection.ResponseError(s,e)}}throw t}}(x);const{frontendVersion:e,gitVersion:t,serverVersion:s}=C;if(!t)throw new Error(x.__("git command not found - please ensure you have Git > 2 installed"));{const e=t.split(".");if(Number.parseInt(e[0])<2)throw new Error(x.__("git command version must be > 2; got %1.",t))}if(e&&e!==s)throw new Error(x.__("The versions of the JupyterLab Git server frontend and backend do not match. The @jupyterlab/git frontend extension has version: %1 while the python package has version %2. Please install identical version of jupyterlab-git Python package and the @jupyterlab/git extension. Try running: pip install --upgrade jupyterlab-git",e,s))}catch(e){return console.error(x.__("Failed to load the jupyterlab-git server extension settings"),e),(0,a.showErrorMessage)(x.__("Failed to load the jupyterlab-git server extension"),e.message,[a.Dialog.warnButton({label:x.__("Dismiss")})]),null}const E=new Le(c,e.docRegistry,w),k=(t,s)=>{E.pathRepository=e.serviceManager.contents.localPath(s.newValue),E.refreshBranch()};if(Promise.all([e.restored,r.model.restored]).then((()=>{k(r.model,{name:"path",newValue:r.model.path,oldValue:""})})),r.model.pathChanged.connect(k),E.headChanged.connect((()=>{r.model.refresh()})),e.serviceManager.contents.fileChanged.connect((()=>E.refreshStatus())),w){!function(e,t,s,i,r,o,l){const{commands:c,shell:d,serviceManager:h}=e,u=l.load("jupyterlab_git");async function v(e){const i=new n.CodeEditor.Model({}),r=t.getRelativeFilePath(),o=r+"/.git-ignore",l=await t.readGitIgnore();if((0,f.find)(d.widgets(),(e=>e.id===o)))return void d.activateById(o);i.sharedModel.setSource(l||"");const c=new n.CodeEditorWrapper({factory:s.newDocumentEditor.bind(s),model:i}),h=i.sharedModel.changed;c.disposed.connect((()=>{i.dispose()}));const p=new a.MainAreaWidget({content:c});p.title.label=".gitignore",p.id=o,p.title.icon=R,p.title.closable=!0,p.title.caption=r+"/.gitignore";const m=new _.ToolbarButton({icon:_.saveIcon,onClick:async()=>{if(g)return;const e=i.sharedModel.getSource();try{await t.writeGitIgnore(e),p.title.className="",g=!0}catch(e){console.log("Could not save .gitignore")}},tooltip:u.__("Saves .gitignore")});let g=!0;p.toolbar.addItem("save",m),d.add(p),h.connect((()=>{g&&(g=!1,p.title.className="not-saved")}))}async function w(e,t){if(t)return v();const s=await(0,a.showDialog)({title:u.__("Warning: The .gitignore file is a hidden file."),body:m.createElement("div",null,u.__("Hidden files by default cannot be accessed with the regular code editor. In order to open the .gitignore file you must:"),m.createElement("ol",null,m.createElement("li",null,u.__("Print the command below to create a jupyter_server_config.py file with defaults commented out. If you already have the file located in .jupyter, skip this step."),m.createElement("div",{style:{padding:"0.5rem"}},"jupyter server --generate-config")),m.createElement("li",null,u.__("Open jupyter_server_config.py, uncomment out the following line and set it to True:"),m.createElement("div",{style:{padding:"0.5rem"}},"c.ContentsManager.allow_hidden = False")))),buttons:[a.Dialog.cancelButton({label:u.__("Cancel")}),a.Dialog.okButton({label:u.__("Show .gitignore file anyways")})],checkbox:{label:u.__("Do not show this warning again"),checked:!1}});s.button.accept&&(o.set("hideHiddenFileWarning",s.isChecked),v())}function C(e){const t=e.map((e=>m.createElement("li",{key:e.to},m.createElement("b",null,e.to))));return m.createElement("ul",null,t)}c.addCommand(Re.gitSubmitCommand,{label:u.__("Commit from the Commit Box"),caption:u.__("Submit the commit using the summary and description from commit box"),execute:()=>{},isVisible:()=>!1}),c.addCommand(Re.gitTerminalCommand,{label:u.__("Open Git Repository in Terminal"),caption:u.__("Open a New Terminal to the Git Repository"),execute:async e=>{const s=t.pathRepository;return await c.execute("terminal:create-new",{...e,cwd:s})},isEnabled:()=>null!==t.pathRepository&&e.serviceManager.terminals.isAvailable()}),c.addCommand(Re.gitUI,{label:u.__("Git Interface"),caption:u.__("Go to Git user interface"),execute:()=>{try{d.activateById("jp-git-sessions")}catch(e){console.error("Fail to open Git tab.")}}}),c.addCommand(Re.gitInit,{label:u.__("Initialize a Repository"),caption:u.__("Create an empty Git repository or reinitialize an existing one"),execute:async()=>{const s=e.serviceManager.contents.localPath(r.path);if((await(0,a.showDialog)({title:u.__("Initialize a Repository"),body:u.__("Do you really want to make this directory a Git Repo?"),buttons:[a.Dialog.cancelButton({label:u.__("Cancel")}),a.Dialog.warnButton({label:u.__("Yes")})]})).button.accept){const e=a.Notification.emit(u.__("Initializing"),"in-progress",{autoClose:!1});try{await t.init(s),t.pathRepository=s,a.Notification.update({id:e,message:u.__("Git repository initialized."),type:"success",autoClose:5e3})}catch(t){console.error(u.__("Encountered an error when initializing the repository. Error: "),t),a.Notification.update({id:e,message:u.__("Failed to initialize the Git repository"),type:"error",...es(t,u)})}}},isEnabled:()=>null===t.pathRepository}),c.addCommand(Re.gitOpenUrl,{label:e=>u.__(e.text),execute:e=>{const t=e.url;window.open(t)}}),c.addCommand(Re.gitToggleSimpleStaging,{label:u.__("Simple staging"),isToggled:()=>!!o.composite.simpleStaging,execute:e=>{o.set("simpleStaging",!o.composite.simpleStaging)}}),c.addCommand(Re.gitToggleDoubleClickDiff,{label:u.__("Double click opens diff"),isToggled:()=>!!o.composite.doubleClickDiff,execute:e=>{o.set("doubleClickDiff",!o.composite.doubleClickDiff)}}),c.addCommand(Re.gitManageRemote,{label:u.__("Manage Remote Repositories"),caption:u.__("Manage Remote Repositories"),isEnabled:()=>null!==t.pathRepository,execute:()=>{if(null===t.pathRepository)return void console.warn(u.__("Not in a Git repository. Unable to add a remote."));const e="git-dialog-ManageRemote";let s=document.querySelector(`#${e}`);s||(s=document.createElement("div"),s.id=e,document.body.appendChild(s));const i=a.ReactWidget.create(m.createElement(St,{trans:u,model:t,onClose:()=>i.dispose()}));y.Widget.attach(i,s)}}),c.addCommand(Re.gitOpenGitignore,{label:u.__("Open .gitignore"),caption:u.__("Open .gitignore"),isEnabled:()=>null!==t.pathRepository,execute:async()=>{try{await t.ensureGitignore()}catch(e){"hiddenFile"===(null==e?void 0:e.name)&&await w(0,o.composite.hideHiddenFileWarning)}}}),c.addCommand(Re.gitPush,{label:e=>e.advanced?u.__("Push to Remote (Advanced)"):u.__("Push to Remote"),caption:u.__("Push code to remote repository"),isEnabled:()=>null!==t.pathRepository,execute:async e=>{let s=null;try{let i,n;if(e.advanced){const e=await(0,a.showDialog)({title:u.__("Please select push options."),body:new ss(u,t),buttons:[a.Dialog.cancelButton({label:u.__("Cancel")}),a.Dialog.okButton({label:u.__("Proceed")})]});if(!e.button.accept||!e.value)return;i=e.value.remoteName,n=e.value.force}s=a.Notification.emit(u.__("Pushing"),"in-progress",{autoClose:!1});const r=await cs(t,n?ns.ForcePush:ns.Push,u,e={remote:i});a.Notification.update({id:s,message:u.__("Successfully pushed"),type:"success",...ts(r,u)})}catch(e){if("CancelledError"!==e.name){console.error(u.__("Encountered an error when pushing changes. Error: "),e);const t=u.__("Failed to push"),i=es(e,u);s?a.Notification.update({id:s,message:t,type:"error",...i}):a.Notification.error(t,i)}else s&&a.Notification.dismiss(s)}}}),c.addCommand(Re.gitPull,{label:e=>e.force?u.__("Pull from Remote (Force)"):u.__("Pull from Remote"),caption:e=>e.force?u.__("Discard all current changes and pull from remote repository"):u.__("Pull latest code from remote repository"),isEnabled:()=>null!==t.pathRepository,execute:async e=>{let s=null;try{e.force&&await gt(t,u,e.fallback),s=a.Notification.emit(u.__("Pulling"),"in-progress",{autoClose:!1});const i=await cs(t,ns.Pull,u);a.Notification.update({id:s,message:u.__("Successfully pulled"),type:"success",...ts(i,u)})}catch(e){if("CancelledError"!==e.name)if(console.error("Encountered an error when pulling changes. Error: ",e),("string"==typeof e?e:e.message).toLowerCase().includes("your local changes to the following files would be overwritten by merge"))await c.execute(Re.gitPull,{force:!0,fallback:!0});else if(e.cancelled)s&&a.Notification.dismiss(s);else{const t=u.__("Failed to pull"),i=es(e,u);s?a.Notification.update({id:s,message:t,...i}):a.Notification.error(t,i)}else s&&a.Notification.dismiss(s)}}}),c.addCommand(Re.gitResetToRemote,{label:u.__("Reset to Remote"),caption:u.__("Reset Current Branch to Remote State"),isEnabled:()=>null!==t.pathRepository,execute:async()=>{var e,s;const i=await(0,a.showDialog)({title:u.__("Reset to Remote"),body:new as(u.__("To bring the current branch to the state of its corresponding remote tracking branch,             a hard reset will be performed, which may result in some files being permanently deleted             and some changes being permanently discarded. Are you sure you want to proceed?             This action cannot be undone."),u.__("Close all opened files to avoid conflicts")),buttons:[a.Dialog.cancelButton({label:u.__("Cancel")}),a.Dialog.warnButton({label:u.__("Proceed")})]});if(i.button.accept){let n=null;try{(null===(e=i.value)||void 0===e?void 0:e.checked)&&(n=a.Notification.emit(u.__("Closing all opened files..."),"in-progress"),await r.manager.closeAll());const o=u.__("Resetting...");n?a.Notification.update({id:n,message:o}):n=a.Notification.emit(o,"in-progress",{autoClose:!1}),await t.resetToCommit(null!==(s=t.status.remote)&&void 0!==s?s:void 0),a.Notification.update({id:n,message:u.__("Successfully reset"),type:"success",...ts(u.__("Successfully reset the current branch to its remote state"),u)})}catch(e){console.error("Encountered an error when resetting the current branch to its remote state. Error: ",e);const t=u.__("Reset failed"),s=es(e,u);n?a.Notification.update({id:n,type:"error",message:t,...s}):a.Notification.error(t,s)}}}}),c.addCommand(Re.gitShowDiff,{label:u.__("Show Diff"),caption:u.__("Display a file diff."),execute:async n=>{var r,o;const{model:c,isText:m,isPreview:f}=n,v=g.PathExt.join(null!==(r=c.repositoryPath)&&void 0!==r?r:"/",c.filename),w=null!==(o=Te(v))&&void 0!==o?o:m&&(e=>(async({editorFactory:e,languageRegistry:t,model:s,toolbar:i,translator:a})=>{const n=new Xt({model:s,languageRegistry:t,editorFactory:e,trans:(null!=a?a:p.nullTranslator).load("jupyterlab_git")});return await n.ready,n})({...e,editorFactory:s.newInlineEditor.bind(s),languageRegistry:i}));if(w){const s=`git-diff-${v}-${c.reference.label}-${c.challenger.label}`,i=d.widgets("main");let n=null;for(const e of i)if(e.id===s){d.activateById(s),n=e;break}if(!n){const i=new y.Panel,r=new b.PromiseDelegate,o=n=new Jt({content:i,reveal:r.promise,isPreview:f});o.id=s,o.title.label=g.PathExt.basename(c.filename),o.title.caption=v,o.title.icon=I,o.title.closable=!0,o.title.className="jp-git-diff-title",o.addClass("jp-git-diff-parent-widget"),d.add(o,"main"),d.activateById(o.id);const p=e.shell._dockPanel;let m=-1;const C=Array.from(p.tabBars()).find((e=>(m=e.titles.indexOf(o.title),-1!==m)));C&&Jt.pinWidget(m,C,o);try{const e=await w({model:c,toolbar:o.toolbar,translator:l});if(o.toolbar.addItem("spacer",_.Toolbar.createSpacerItem()),c.hasConflict){const s=new _.ToolbarButton({label:u.__("Mark as resolved"),onClick:async()=>{var s;if(e.isFileResolved||(await(0,a.showDialog)({title:u.__("Resolve with conflicts"),body:u.__("Are you sure you want to mark this file as resolved with merge conflicts?")})).button.accept)try{await h.contents.save(v,await e.getResolvedFile()),await t.add(c.filename),await t.refresh()}catch(e){a.Notification.error(null!==(s=e.message)&&void 0!==s?s:e)}finally{o.dispose()}},tooltip:u.__("Mark file as resolved"),className:"jp-git-diff-resolve"});o.toolbar.addItem("resolve",s)}else{const t=new _.ToolbarButton({label:u.__("Refresh"),onClick:async()=>{await e.refresh(),t.hide()},tooltip:u.__("Refresh diff widget"),className:"jp-git-diff-refresh"});t.hide(),o.toolbar.addItem("refresh",t);const s=()=>{t.show()};c.changed.connect(s),e.disposed.connect((()=>c.changed.disconnect(s)))}r.resolve(),i.addWidget(e)}catch(e){console.error(e);const t=`Load Diff Model Error (${e.message||e})`;r.reject(t)}if(c.challenger.source===ke.Diff.SpecialRef.INDEX||c.challenger.source===ke.Diff.SpecialRef.WORKING||c.reference.source===ke.Diff.SpecialRef.INDEX||c.reference.source===ke.Diff.SpecialRef.WORKING){const e=(s,i)=>{const a=i.files.find((e=>c.filename===e.from));a&&"unmodified"!==a.status||(t.statusChanged.disconnect(e),n.dispose())};t.statusChanged.connect(e)}}return n}return await(0,a.showErrorMessage)(u.__("Diff Not Supported"),u.__("Diff is not supported for %1 files.",g.PathExt.extname(c.filename).toLocaleLowerCase())),null},icon:I.bindprops({stylesheet:"menuItem"})}),c.addCommand(Re.gitMerge,{label:u.__("Merge Branch"),caption:u.__("Merge selected branch in the current branch"),execute:async e=>{var s,i,n,r,o;let{branch:l}=null!=e?e:{};if(!l){const e=t.branches.filter((e=>!e.is_current_branch&&!e.is_remote_branch)),r="git-dialog-MergeBranch";let o=document.querySelector(`#${r}`);o||(o=document.createElement("div"),o.id=r,document.body.appendChild(o));const c=new b.PromiseDelegate,d=a.ReactWidget.create(m.createElement(fe,{action:"merge",currentBranch:null!==(i=null===(s=t.currentBranch)||void 0===s?void 0:s.name)&&void 0!==i?i:"",branches:e,onClose:e=>{d.dispose(),c.resolve(null!=e?e:null)},trans:u}));y.Widget.attach(d,o),l=null!==(n=await c.promise)&&void 0!==n?n:void 0}if(l){const e=a.Notification.emit(u.__("Merging branch '%1'",l),"in-progress");try{await t.merge(l)}catch(s){return void a.Notification.update({id:e,type:"error",message:u.__("Failed to merge branch '%1' into '%2'.",l,null===(r=t.currentBranch)||void 0===r?void 0:r.name),...es(s,u)})}a.Notification.update({id:e,type:"success",message:u.__("Branch '%1' merged into '%2'.",l,null===(o=t.currentBranch)||void 0===o?void 0:o.name)})}},isEnabled:()=>t.branches.some((e=>!e.is_current_branch&&!e.is_remote_branch))}),c.addCommand(Re.gitRebase,{label:u.__("Rebase branch"),caption:u.__("Rebase current branch onto the selected branch"),execute:async e=>{var s,i,n,r,o;let{branch:l}=null!=e?e:{};if(!l){const e=t.branches.filter((e=>!e.is_current_branch&&!e.is_remote_branch)),r="git-dialog-MergeBranch";let o=document.querySelector(`#${r}`);o||(o=document.createElement("div"),o.id=r,document.body.appendChild(o));const c=new b.PromiseDelegate,d=a.ReactWidget.create(m.createElement(fe,{action:"rebase",currentBranch:null!==(i=null===(s=t.currentBranch)||void 0===s?void 0:s.name)&&void 0!==i?i:"",branches:e,onClose:e=>{d.dispose(),c.resolve(null!=e?e:null)},trans:u}));y.Widget.attach(d,o),l=null!==(n=await c.promise)&&void 0!==n?n:void 0}if(l){const e=a.Notification.emit(u.__("Rebasing current branch onto '%1'",l),"in-progress");try{await t.rebase(l)}catch(s){return void a.Notification.update({id:e,type:"error",message:u.__("Failed to rebase branch '%1' onto '%2'.",null===(r=t.currentBranch)||void 0===r?void 0:r.name,l),...es(s,u)})}a.Notification.update({id:e,type:"success",message:u.__("Branch '%1' rebase onto '%2'.",null===(o=t.currentBranch)||void 0===o?void 0:o.name,l)})}},isEnabled:()=>t.branches.some((e=>!e.is_current_branch&&!e.is_remote_branch))}),c.addCommand(Re.gitResolveRebase,{label:(e={})=>{switch(e.action){case"continue":return u.__("Continue rebase");case"skip":return u.__("Skip current commit");case"abort":return u.__("Abort rebase");default:return u.__("Resolve rebase")}},caption:(e={})=>{switch(e.action){case"continue":return u.__("Continue the rebase by committing the current state.");case"skip":return u.__("Skip current commit and continue the rebase.");case"abort":return u.__("Abort the rebase");default:return u.__("Resolve rebase")}},execute:async(e={})=>{var s,i,n;const{action:r}=e;if(["continue","abort","skip"].includes(null!=r?r:"")){const e=null!==(s=(e=>{switch(e){case"continue":return u.__("Continue the rebase");case"skip":return u.__("Skip current commit");case"abort":return u.__("Abort the rebase")}})(r))&&void 0!==s?s:"",o=a.Notification.emit(e,"in-progress",{autoClose:!1});try{await t.resolveRebase(r)}catch(e){const t=null!==(i=(e=>{switch(e){case"continue":return u.__("Fail to continue rebasing.");case"skip":return u.__("Fail to skip current commit when rebasing.");case"abort":return u.__("Fail to abort the rebase.")}})(r))&&void 0!==i?i:"";return void a.Notification.update({id:o,type:"error",message:t,...es(e,u)})}const l=null!==(n=(e=>{switch(e){case"continue":return u.__("Commit submitted continuing rebase.");case"skip":return u.__("Current commit skipped.");case"abort":return u.__("Rebase aborted.")}})(r))&&void 0!==n?n:"";a.Notification.update({id:o,type:"success",message:l,autoClose:5e3})}},isEnabled:()=>t.status.state===ke.State.REBASING}),c.addCommand(Re.gitStash,{label:u.__("Stash Changes"),caption:u.__("Stash all current changes"),isEnabled:()=>null!==t.pathRepository,execute:async e=>{var s;const i=await a.InputDialog.getText({title:u.__("Do you want to stash your changes? "),placeholder:u.__("Stash message (optional)"),okLabel:u.__("Stash")}),n=null!==(s=i.value)&&void 0!==s?s:"";if(i.button.accept){const e=a.Notification.emit(u.__("Stashing changes"),"in-progress",{autoClose:!1});try{await t.stashChanges(n),a.Notification.update({id:e,message:u.__("Successfully stashed"),type:"success",autoClose:5e3})}catch(t){console.error("Encountered an error when pulling changes. Error: ",t),a.Notification.update({id:e,message:u.__("Failed to stash"),type:"error",...es(t,u)})}}}}),c.addCommand(Re.gitStashList,{label:u.__("Stash List"),caption:u.__("Get all the stashed changes"),isEnabled:()=>null!==t.pathRepository,execute:async e=>{try{await t.refreshStash(),a.Notification.info(u.__("Got the stash list"))}catch(e){a.Notification.error(u.__("Failed to get the stash"),es(e,u))}}}),c.addCommand(Se.gitFileOpen,{label:u.__("Open"),caption:rs(u.__("Open selected file"),u.__("Open selected files")),execute:async e=>{const{files:s}=e;for(const e of s){const{x:s,y:i,to:n}=e;if("D"===s||"D"===i)return void await(0,a.showErrorMessage)(u.__("Open File Failed"),u.__("This file has been deleted!"));try{"/"!==n[n.length-1]?c.execute("docmanager:open",{path:t.getRelativeFilePath(n)}):console.log("Cannot open a folder here")}catch(e){console.error(`Fail to open ${n}.`)}}},icon:H.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.openFileFromDiff,{label:u.__("Open File"),caption:u.__("Open file from its diff view"),execute:async s=>{const i=e.contextMenuHitTest((e=>{var t;const s=e.dataset.id;return null!==(t="git-diff"===(null==s?void 0:s.substring(0,8)))&&void 0!==t&&t}));if(!i)return;const a=Array.from(d.widgets("main")).filter((e=>e.id===i.dataset.id));if(0===a.length)return;const n=a[0].content.widgets[0].model,r=n.filename;if(n.reference.source===ke.Diff.SpecialRef.INDEX||n.reference.source===ke.Diff.SpecialRef.WORKING||n.challenger.source===ke.Diff.SpecialRef.INDEX||n.challenger.source===ke.Diff.SpecialRef.WORKING){const e=t.status.files.find((e=>e.from===r));e&&c.execute(Se.gitFileOpen,{files:[e]})}else c.execute("docmanager:open",{path:t.getRelativeFilePath(r)})}}),c.addCommand(Se.gitFileDiff,{label:u.__("Diff"),caption:rs(u.__("Diff selected file"),u.__("Diff selected files")),execute:async s=>{const{files:i}=s;if(null!==t.pathRepository)for(const s of i){const{context:i,filePath:a,previousFilePath:n,isText:r,status:o,isPreview:l}=s;if("untracked"===o)continue;const d=t.pathRepository,h=a,p=g.PathExt.join(d,h),m={currentRef:"",previousRef:"HEAD",...i};"unmerged"===o?(m.baseRef=ke.Diff.SpecialRef.BASE,m.currentRef=t.status.state!==ke.State.MERGING?t.status.state===ke.State.REBASING?"REBASE_HEAD":"CHERRY_PICK_HEAD":"MERGE_HEAD"):m.currentRef||(m.currentRef="staged"===o?ke.Diff.SpecialRef.INDEX:ke.Diff.SpecialRef.WORKING);const _=ke.Diff.SpecialRef[m.currentRef]?{special:ke.Diff.SpecialRef[m.currentRef]}:{git:m.currentRef},f={challenger:{content:async()=>Ne(g.URLExt.join(d,"content"),"POST",{filename:h,reference:_}).then((e=>e.content)),label:ke.Diff.SpecialRef[m.currentRef]||m.currentRef,source:m.currentRef,updateAt:Date.now()},filename:h,reference:{content:async()=>Ne(g.URLExt.join(d,"content"),"POST",{filename:null!=n?n:h,reference:{git:m.previousRef}}).then((e=>e.content)),label:ke.Diff.SpecialRef[m.previousRef]||m.previousRef,source:m.previousRef,updateAt:Date.now()},repositoryPath:d};n&&(f.reference.label=`${n} (${f.reference.label.slice(0,7)})`,f.challenger.label=`${a} (${f.challenger.label.slice(0,7)})`),m.baseRef&&(f.reference.label=u.__("Current"),f.challenger.label=u.__("Incoming"),f.base={content:async()=>Ne(g.URLExt.join(d,"content"),"POST",{filename:h,reference:{special:ke.Diff.SpecialRef[m.baseRef]}}).then((e=>e.content)),label:u.__("Result"),source:m.baseRef,updateAt:Date.now()});const b=new Qt(f),y=await c.execute(Re.gitShowDiff,{model:b,isText:r,isPreview:l});if(y){if("HEAD"===m.previousRef){const e=()=>{b.reference={...b.reference,updateAt:Date.now()}};t.headChanged.connect(e),y.disposed.connect((()=>{t.headChanged.disconnect(e)}))}if(m.currentRef===ke.Diff.SpecialRef.WORKING){const t=(t,s)=>{var i,a,n,r;const o=new Date(null!==(a=null===(i=s.newValue)||void 0===i?void 0:i.last_modified)&&void 0!==a?a:0).valueOf();e.serviceManager.contents.localPath(null!==(r=null===(n=s.newValue)||void 0===n?void 0:n.path)&&void 0!==r?r:"")===p&&b.challenger.updateAt!==o&&(b.challenger={...b.challenger,updateAt:o})};e.serviceManager.contents.fileChanged.connect(t),y.disposed.connect((()=>{e.serviceManager.contents.fileChanged.disconnect(t)}))}}}},icon:I.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitFileAdd,{label:u.__("Add"),caption:rs(u.__("Stage or track the changes to selected file"),u.__("Stage or track the changes of selected files")),execute:async e=>{const{files:s}=e;for(const e of s)await t.add(e.to)},icon:F.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitFileStage,{label:u.__("Stage"),caption:rs(u.__("Stage the changes of selected file"),u.__("Stage the changes of selected files")),execute:async e=>{const{files:s}=e;for(const e of s)await t.add(e.to)},icon:F.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitFileTrack,{label:u.__("Track"),caption:rs(u.__("Start tracking selected file"),u.__("Start tracking selected files")),execute:async e=>{const{files:s}=e;for(const e of s)await t.add(e.to)},icon:F.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitFileUnstage,{label:u.__("Unstage"),caption:rs(u.__("Unstage the changes of selected file"),u.__("Unstage the changes of selected files")),execute:async e=>{const{files:s}=e;for(const e of s)"D"!==e.x&&await t.reset(e.to)},icon:z.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitFileDelete,{label:u.__("Delete"),caption:rs(u.__("Delete this file"),u.__("Delete these files")),execute:async s=>{const{files:i}=s,n=C(i);if((await(0,a.showDialog)({title:u.__("Delete Files"),body:m.createElement("span",null,u.__("Are you sure you want to permanently delete the following files?               This action cannot be undone."),n),buttons:[a.Dialog.cancelButton({label:u.__("Cancel")}),a.Dialog.warnButton({label:u.__("Delete")})]})).button.accept)for(const s of i)try{await e.commands.execute("docmanager:delete-file",{path:t.getRelativeFilePath(s.to)})}catch(e){(0,a.showErrorMessage)(u.__("Deleting %1 failed.",s.to),e,[a.Dialog.warnButton({label:u.__("Dismiss")})])}},icon:_.closeIcon.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitFileDiscard,{label:u.__("Discard"),caption:rs(u.__("Discard recent changes of selected file"),u.__("Discard recent changes of selected files")),execute:async e=>{const{files:s}=e,i=C(s);if((await(0,a.showDialog)({title:u.__("Discard changes"),body:m.createElement("span",null,u.__("Are you sure you want to permanently discard changes to the following files?               This action cannot be undone."),i),buttons:[a.Dialog.cancelButton({label:u.__("Cancel")}),a.Dialog.warnButton({label:u.__("Discard")})]})).button.accept)for(const e of s)try{"staged"!==e.status&&"partially-staged"!==e.status||await t.reset(e.to),("unstaged"===e.status||"partially-staged"===e.status&&"A"!==e.x)&&await t.checkout({filename:e.to})}catch(t){(0,a.showErrorMessage)(u.__("Discard changes for %1 failed.",e.to),t,[a.Dialog.warnButton({label:u.__("Dismiss")})])}},icon:A.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitIgnore,{label:rs(u.__("Ignore this file (add to .gitignore)"),u.__("Ignore these files (add to .gitignore)")),caption:rs(u.__("Ignore this file (add to .gitignore)"),u.__("Ignore these files (add to .gitignore)")),execute:async e=>{const{files:s}=e;for(const e of s)if(e)try{await t.ignore(e.to,!1)}catch(e){"hiddenFile"===(null==e?void 0:e.name)&&await w(0,o.composite.hideHiddenFileWarning)}}}),c.addCommand(Se.gitIgnoreExtension,{label:e=>{const{files:t}=e,s=t.map((e=>g.PathExt.extname(e.to))).filter((e=>e.length>0)).filter(((e,t,s)=>s.indexOf(e)===t));return u._n("Ignore %2 extension (add to .gitignore)","Ignore %2 extensions (add to .gitignore)",s.length,s.join(", "))},caption:rs(u.__("Ignore this file extension (add to .gitignore)"),u.__("Ignore these files extension (add to .gitignore)")),execute:async e=>{const{files:s}=e;for(const e of s)if(e){const s=g.PathExt.extname(e.to);s.length>0&&(await(0,a.showDialog)({title:u.__("Ignore file extension"),body:u.__("Are you sure you want to ignore all %1 files within this git repository?",s),buttons:[a.Dialog.cancelButton(),a.Dialog.okButton({label:u.__("Ignore")})]})).button.label===u.__("Ignore")&&await t.ignore(e.to,!0)}},isVisible:e=>{const{files:t}=e;return t.some((e=>g.PathExt.extname(e.to).length>0))}}),c.addCommand(Se.gitFileHistory,{label:u.__("History"),caption:u.__("View the history of this file"),execute:e=>{const{files:s}=e,i=s[0];i&&(t.selectedHistoryFile=i,d.activateById("jp-git-sessions"))},isEnabled:e=>{const{files:t}=e;return 1===t.length},icon:L.bindprops({stylesheet:"menuItem"})}),c.addCommand(Se.gitNoAction,{label:u.__("No actions available"),isEnabled:()=>!1,execute:()=>{}}),c.addCommand(Se.gitTagAdd,{label:u.__("Add Tag"),caption:u.__("Add tag pointing to selected commit"),execute:async e=>{const s=e,i="git-dialog-AddTag";let n=document.querySelector(`#${i}`);n||(n=document.createElement("div"),n.id=i,document.body.appendChild(n));const r=new b.PromiseDelegate,o=a.ReactWidget.create(m.createElement(zt,{pastCommits:[s.commit],model:t,trans:u,open:!0,onClose:e=>{o.dispose(),r.resolve(null!=e?e:null)},isSingleCommit:!0}));y.Widget.attach(o,n);const l=await r.promise;if(l){const e=a.Notification.emit(u.__("Create tag pointing to '%1'...",s.commit.commit_msg),"in-progress");try{await t.setTag(l,s.commit.commit)}catch(t){return void a.Notification.update({id:e,message:u.__("Failed to create tag '%1' poining to '%2'.",l,s),type:"error",...es(t,u)})}a.Notification.update({id:e,message:u.__("Created tag '%1' pointing to '%2'.",l,s),type:"success"})}},icon:G.bindprops({stylesheet:"menuItem"})})}(e,E,i.factoryService,s,r.model,w,v);const o=new Ln(E,w,e.commands,r.model,x);if(o.id="jp-git-sessions",o.title.icon=R,o.title.caption="Git",u){const e="Git Operations";[Re.gitToggleSimpleStaging,Re.gitToggleDoubleClickDiff,Re.gitOpenGitignore,Re.gitInit,Re.gitMerge,Re.gitRebase,Re.gitPush,Re.gitPull,Re.gitResetToRemote,Re.gitManageRemote,Re.gitTerminalCommand].forEach((t=>u.addItem({command:t,category:e})))}t.add(o,"git-sessions"),e.shell.add(o,"left",{rank:200}),d&&e.version.split(".").slice(0,2).join(".")<"3.1"&&d.addMenu(function(e,t){const s=[{text:t.__("Set Up Remotes"),url:"https://www.atlassian.com/git/tutorials/setting-up-a-repository"},{text:t.__("Git Documentation"),url:"https://git-scm.com/doc"}],i=new y.Menu({commands:e});i.title.label=t.__("Git"),[Re.gitInit,Re.gitClone,Re.gitMerge,Re.gitPush,Re.gitPull,Re.gitResetToRemote,Re.gitManageRemote,Re.gitTerminalCommand,Re.gitStash].forEach((e=>{i.addItem({command:e}),e===Re.gitPush&&i.addItem({command:e,args:{advanced:!0}}),e===Re.gitPull&&i.addItem({command:e,args:{force:!0}})})),i.addItem({type:"separator"}),i.addItem({command:Re.gitToggleSimpleStaging}),i.addItem({command:Re.gitToggleDoubleClickDiff}),i.addItem({type:"separator"}),i.addItem({command:Re.gitOpenGitignore}),i.addItem({type:"separator"});const a=new y.Menu({commands:e});return a.title.label=t.__(" Help "),s.map((e=>{a.addItem({args:e,command:Re.gitOpenUrl})})),i.addItem({type:"submenu",submenu:a}),i}(e.commands,x)),h&&function(e,t,s,i){const a=new Ri(t,i);e.registerStatusItem("git-status",{align:"left",item:a,isActive:Fi.isStatusWidgetActive(s),activeStateChanged:s&&s.changed});const n=Fi.createEventCallback(a);t.taskChanged.connect(n),a.disposed.connect((()=>{t.taskChanged.disconnect(n)}))}(h,E,w,x),ls(E,r,e.serviceManager.contents,e.contextMenu,x)}return E.registerDiffProvider("Nbdime",[".ipynb"],(e=>(async({model:e,renderMime:t,toolbar:s,translator:i})=>{const a=(null!=i?i:p.nullTranslator).load("jupyterlab_git"),n=new ri(e,t,a);if(n.addClass("jp-git-diff-root"),await n.ready,s){const t=document.createElement("input"),i=document.createElement("label");t.className="nbdime-hide-unchanged",t.type="checkbox",t.checked=!0,i.appendChild(t),i.appendChild(document.createElement("span")).textContent=a.__("Hide unchanged cells"),s.addItem("hideUnchanged",new y.Widget({node:i})),e.hasConflict&&s.addItem("clear-outputs",n.nbdimeWidget.widgets[0]),n.areUnchangedCellsHidden=t.checked,t.onchange=()=>{n.areUnchangedCellsHidden=t.checked}}return n})({...e,renderMime:o}))),E.registerDiffProvider("ImageDiff",[".jpeg",".jpg",".png"],Us),E},autoStart:!0},Hn=[Mn,hs]}}]);